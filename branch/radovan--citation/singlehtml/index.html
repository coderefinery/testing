

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Automated testing documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx_lesson.css" />
      <link rel="stylesheet" type="text/css" href="_static/term_role_formatting.css" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx_rtd_theme_ext_color_contrast.css" />
      <link rel="stylesheet" type="text/css" href="_static/tabs.css" />

  
    <link rel="shortcut icon" href="_static/coderefinery.ico"/>
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js"></script>
      <script src="_static/doctools.js"></script>
      <script src="_static/sphinx_highlight.js"></script>
      <script src="_static/clipboard.min.js"></script>
      <script src="_static/copybutton.js"></script>
      <script src="_static/minipres.js"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="_static/togglebutton.js"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script src="_static/tabs.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            Automated testing
          </a>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The lesson</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-motivation">Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-locally">Testing locally</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-continuous-integration">Automated testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-test-design">Test design</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-conclusions">Conclusions and recommendations</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-full-cycle-ci">(Optional) Full-cycle collaborative workflow</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://youtu.be/xbTTDLA3txI">Shell crash course</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-exercises">List of exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-quick-reference">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-guide">Instructor guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://coderefinery.org/lessons/core/">All lessons</a></li>
<li class="toctree-l1"><a class="reference external" href="https://coderefinery.org/">CodeRefinery</a></li>
<li class="toctree-l1"><a class="reference external" href="https://coderefinery.org/lessons/reusing/">Reusing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">Automated testing</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Automated testing  documentation</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/coderefinery/testing/blob/main/content/index" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="automated-testing-preventing-yourself-and-others-from-breaking-your-functioning-code">
<h1>Automated testing - Preventing yourself and others from breaking your functioning code<a class="headerlink" href="#automated-testing-preventing-yourself-and-others-from-breaking-your-functioning-code" title="Link to this heading"></a></h1>
<p>Have you ever had some of these problems?:</p>
<ul class="simple">
<li><p>You change B and C, and suddenly A doesn’t work anymore.  Time
wasted trying to figure out what changed.</p></li>
<li><p>There was some simple problem, systematically testing could have
found it.</p></li>
<li><p>You get someone else’s code and are afraid to touch it because who
knows what might break.  Plot twist: it’s your own code!</p></li>
</ul>
<p>People have learned that some automatic way to check problems makes
software development much easier.  This lesson will talk about the
places it’s useful for research code, and how easy it can be.
We will discuss why testing often needs to be part of the
software development cycle and how such a cycle can be implemented. We will
see how automated testing works and practice designing and writing tests.</p>
<div class="admonition-prerequisites prerequisites admonition" id="prerequisites-0">
<p class="admonition-title">Prerequisites</p>
<ol class="arabic simple">
<li><p>You need <a class="reference external" href="http://doc.pytest.org">pytest</a> (as part of Anaconda or Miniconda or Virtual Environment).</p></li>
<li><p>(Optional) To work on exercises in other languages than Python,
please follow the instructions under “Language-specific
instructions” in the <a class="reference external" href="https://coderefinery.github.io/testing/test-design/">Test design episode</a>
to install the recommended testing frameworks.</p></li>
<li><p>Basic understanding of Git.</p></li>
<li><p>You need a <a class="reference external" href="https://github.com">GitHub</a> or a <a class="reference external" href="https://gitlab.com/">Gitlab</a> account for the “automated testing” and
“full-cycle collaborative workflow” (but the rest works fine
just locally).</p></li>
<li><p>If you wish to follow in the terminal and are new to the command line, we
recorded a <a class="reference external" href="https://youtu.be/xbTTDLA3txI">short shell crash course</a>.</p></li>
</ol>
</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>15 min</p></td>
<td><p><a class="reference internal" href="#document-motivation"><span class="doc">Motivation</span></a></p></td>
</tr>
<tr class="row-even"><td><p>25 min</p></td>
<td><p><a class="reference internal" href="#document-locally"><span class="doc">Testing locally</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>30 min</p></td>
<td><p><a class="reference internal" href="#document-continuous-integration"><span class="doc">Automated testing</span></a></p></td>
</tr>
<tr class="row-even"><td><p>30 min</p></td>
<td><p><a class="reference internal" href="#document-test-design"><span class="doc">Test design</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>5 min</p></td>
<td><p><a class="reference internal" href="#document-conclusions"><span class="doc">Conclusions and recommendations</span></a></p></td>
</tr>
</tbody>
</table>
<div class="toctree-wrapper compound">
<span id="document-motivation"></span><section id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Link to this heading"></a></h2>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Appreciate the importance of testing software</p></li>
<li><p>Understand various benefits of testing</p></li>
</ul>
</div>
<section id="untested-software-can-be-compared-to-uncalibrated-detectors">
<h3>Untested software can be compared to uncalibrated detectors<a class="headerlink" href="#untested-software-can-be-compared-to-uncalibrated-detectors" title="Link to this heading"></a></h3>
<p><em>“Before relying on a new experimental device, an experimental scientist always
establishes its accuracy. A new detector is calibrated when the scientist
observes its responses to known input signals. The results of this
calibration are compared against the expected response.”</em></p>
<blockquote>
<div><p>[From <a class="reference external" href="https://carpentries-incubator.github.io/python-testing/">Testing and Continuous Integration with Python</a>, created by K. Huff]</p>
</div></blockquote>
<p>With testing, simulations and analysis using software <em>can</em> be held to the same standards as experimental measurement devices!</p>
<p>What can go wrong when research software has bugs?  Look no further:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://science.sciencemag.org/content/314/5807/1856.summary">A Scientist’s Nightmare: Software Problem Leads to Five Retractions</a></p></li>
<li><p><a class="reference external" href="https://arstechnica.com/information-technology/2019/10/chemists-discover-cross-platform-python-scripts-not-so-cross-platform/">Researchers find bug in Python script may have affected hundreds of studies</a></p></li>
</ul>
</section>
<hr class="docutils" />
<section id="testing-in-a-nutshell">
<h3>Testing in a nutshell<a class="headerlink" href="#testing-in-a-nutshell" title="Link to this heading"></a></h3>
<p>In software tests, expected results are compared with observed results
in order to establish accuracy.  Why are we not comparing directly all
digits with the expected result?:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-0-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button><button aria-controls="panel-0-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-0-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button><button aria-controls="panel-0-Rm9ydHJhbg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tab" tabindex="-1">Fortran</button></div><div aria-labelledby="tab-0-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-0-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">fahrenheit_to_celsius</span><span class="p">(</span><span class="n">temp_f</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts temperature in Fahrenheit</span>
<span class="sd">    to Celsius.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">temp_c</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp_f</span> <span class="o">-</span> <span class="mf">32.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">5.0</span><span class="o">/</span><span class="mf">9.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">temp_c</span>

<span class="c1"># This is the test function: `assert` raises an error if something</span>
<span class="c1"># is wrong.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_fahrenheit_to_celsius</span><span class="p">():</span>
    <span class="n">temp_c</span> <span class="o">=</span> <span class="n">fahrenheit_to_celsius</span><span class="p">(</span><span class="n">temp_f</span><span class="o">=</span><span class="mf">100.0</span><span class="p">)</span>
    <span class="n">expected_result</span> <span class="o">=</span> <span class="mf">37.777777</span>
    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">temp_c</span> <span class="o">-</span> <span class="n">expected_result</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0e-6</span>
    
</pre></div>
</div>
</div><div aria-labelledby="tab-0-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cmath&gt;</span><span class="c1">  // std::abs</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdlib&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="cm">/* Converts temperature in Fahrenheit to Celsius. */</span>
<span class="kt">double</span><span class="w"> </span><span class="nf">fahrenheit_to_celsius</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">temp_f</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">temp_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">temp_f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">32.0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">5.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">9.0</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">temp_c</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* This is the test function: `throws` raises an error if something is wrong. */</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">test_fahrenheit_to_celsius</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">temp_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fahrenheit_to_celsius</span><span class="p">(</span><span class="mf">100.0</span><span class="p">);</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">expected_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">37.777777</span><span class="p">;</span>
<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">temp_c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">expected_result</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1.0e-6</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="s">&quot;Error&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="k">const</span><span class="o">*</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">err</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">fahrenheit_to_celsius</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
<span class="w">  </span><span class="n">test_fahrenheit_to_celsius</span><span class="p">();</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-Ug==" name="Ug==" role="tabpanel" tabindex="0"><div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># Converts temperature in Fahrenheit to Celsius.</span>
<span class="n">fahrenheit_to_celsius</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">temp_f</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">temp_c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">temp_f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">32.0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">5.0</span><span class="o">/</span><span class="m">9.0</span><span class="p">)</span>
<span class="w">  </span><span class="n">temp_c</span>
<span class="p">}</span>

<span class="c1"># This is the test function: `assertive::is_true` raises an error if something</span>
<span class="c1"># is wrong.</span>
<span class="n">test_fahrenheit_to_celsius</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">temp_c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">fahrenheit_to_celsius</span><span class="p">(</span><span class="n">temp_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100.0</span><span class="p">)</span>
<span class="w">  </span><span class="n">expected_result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">37.777777</span>
<span class="w">  </span><span class="n">assertive</span><span class="o">::</span><span class="nf">is_true</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">temp_c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">expected_result</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">1.0e-6</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><div class="highlight-Julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Test</span>

<span class="s">&quot;&quot;&quot;</span>
<span class="s">    fahrenheit_to_celsius(temp_f::Float)</span>

<span class="s">Converts temperature in Fahrenheit to Celsius.</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="k">function</span><span class="w"> </span><span class="n">fahrenheit_to_celsius</span><span class="p">(</span><span class="n">temp_f</span><span class="p">)</span>
<span class="w">    </span><span class="n">temp_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">temp_f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">32.0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">5.0</span><span class="o">/</span><span class="mf">9.0</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">temp_c</span>
<span class="k">end</span>


<span class="c"># This is the test section</span>
<span class="nd">@testset</span><span class="w"> </span><span class="s">&quot;Test fahrenheit_to_celsius&quot;</span><span class="w"> </span><span class="k">begin</span>
<span class="w">    </span><span class="n">temp_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fahrenheit_to_celsius</span><span class="p">(</span><span class="mf">100.0</span><span class="p">)</span>
<span class="w">    </span><span class="n">expected_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">37.777777</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">temp_c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">expected_result</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1.0e-6</span>
<span class="k">end</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-Rm9ydHJhbg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tabpanel" tabindex="0"><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">program </span><span class="n">temperature_conversion</span>

<span class="k">implicit none</span>
<span class="k">call </span><span class="n">test_fahrenheit_to_celsius</span><span class="p">()</span>

<span class="k">contains</span>

<span class="k">function </span><span class="n">fahrenheit_to_celsius</span><span class="p">(</span><span class="n">temp_f</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">temp_c</span><span class="p">)</span>
<span class="w">   </span><span class="k">implicit none</span>
<span class="k">   </span><span class="kt">real </span><span class="n">temp_f</span>
<span class="w">   </span><span class="kt">real </span><span class="n">temp_c</span>
<span class="w">   </span><span class="n">temp_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">temp_f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="mf">2.0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">5.0</span><span class="o">/</span><span class="mf">9.0</span><span class="p">)</span>
<span class="k">end function </span><span class="n">fahrenheit_to_celsius</span>

<span class="k">subroutine </span><span class="n">test_fahrenheit_to_celsius</span><span class="p">()</span>
<span class="w">   </span><span class="k">implicit none</span>
<span class="k">   </span><span class="kt">real </span><span class="n">temp_c</span>
<span class="w">   </span><span class="kt">real </span><span class="n">expected_result</span>
<span class="w">   </span><span class="n">temp_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fahrenheit_to_celsius</span><span class="p">(</span><span class="mi">10</span><span class="mf">0.0</span><span class="p">)</span>
<span class="w">   </span><span class="n">expected_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="mf">7.777777</span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">temp_c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">expected_result</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1.0e-6</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">      write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Error&#39;</span>
<span class="w">   </span><span class="k">else</span>
<span class="k">      write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Pass&#39;</span>
<span class="w">   </span><span class="k">end if</span>
<span class="k">end subroutine </span><span class="n">test_fahrenheit_to_celsius</span>

<span class="k">end program </span><span class="n">temperature_conversion</span>
</pre></div>
</div>
</div></div>
<p>Or you can test whole programs:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python3<span class="w"> </span>run-test.py

<span class="go">running: sample_data/set1.csv --output=tests/set1.txt</span>
<span class="go">CORRECT</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="what-can-tests-help-you-do">
<h3>What can tests help you do?<a class="headerlink" href="#what-can-tests-help-you-do" title="Link to this heading"></a></h3>
<p><strong>Preserving expected functionality</strong></p>
<ul class="simple">
<li><p>Check old things when you add new ones</p></li>
</ul>
<p><strong>Help users of your code</strong></p>
<ul class="simple">
<li><p>Verify it’s installed correctly and works.</p></li>
<li><p>See examples of what it should do.</p></li>
</ul>
<p><strong>Help other developers modify it</strong></p>
<ul class="simple">
<li><p>Change things with confidence that nothing is breaking.</p></li>
<li><p>Warning if documentation/examples go out of date.</p></li>
</ul>
<p><strong>Manage complexity</strong></p>
<ul class="simple">
<li><p>If code is easy to test, it’s probably easier to maintain.</p></li>
<li><p>The next lesson <a class="reference external" href="https://coderefinery.github.io/modular-type-along/">Modular code development</a>
demonstrates this.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="discussion-when-is-it-ok-not-to-add-tests">
<h3>Discussion: When is it OK not to add tests?<a class="headerlink" href="#discussion-when-is-it-ok-not-to-add-tests" title="Link to this heading"></a></h3>
<div class="admonition-discussion-when-is-it-ok-not-to-add-tests discussion important admonition" id="discussion-0">
<p class="admonition-title">Discussion: When is it OK not to add tests?</p>
<p>Vote in the notes and we’ll discuss soon.  <strong>It is always a balance: there is no “always”/”never”</strong>.</p>
<ol class="arabic simple">
<li><p>Jupyter or R Markdown notebook which produces a plot and you know by
looking at the plot whether it worked?</p></li>
<li><p>A short, “obviously correct” Python or R script which you never intend to reuse?</p></li>
<li><p>A simple short, “obviously correct” shell script?</p></li>
<li><p>Can you give other examples?</p></li>
</ol>
</div>
</section>
<hr class="docutils" />
<section id="discussion-what-s-easy-and-hard-to-test">
<h3>Discussion: What’s easy and hard to test?<a class="headerlink" href="#discussion-what-s-easy-and-hard-to-test" title="Link to this heading"></a></h3>
<div class="admonition-discussion-testing-in-practice discussion important admonition" id="discussion-1">
<p class="admonition-title">Discussion: Testing in practice</p>
<p>Use the collaborative notes to answer these questions:</p>
<ol class="arabic simple">
<li><p>Give examples of things (from your work) that are easy to test.</p></li>
<li><p>Give examples of things (from your work) that are hard to test.</p></li>
</ol>
</div>
</section>
<hr class="docutils" />
<section id="types-of-tests">
<h3>Types of tests<a class="headerlink" href="#types-of-tests" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Test functions one at a time - <strong>Unit tests</strong></p></li>
<li><p>Test how parts work together - <strong>Integration tests</strong></p></li>
<li><p>Test the whole thing running - <strong>End-to-end tests</strong></p>
<ul>
<li><p>For example, running on sample data.</p></li>
</ul>
</li>
<li><p>Check same results as before - <strong>Regression tests</strong></p></li>
<li><p>Write test first (the output), then write code to make test pass -
<strong>Test-driven development</strong></p></li>
<li><p>GitHub or GitLab runs tests automatically - <strong>Continuous
integration</strong></p></li>
<li><p>Report that tells you which lines were/were not run by tests -
<strong>Code coverage</strong></p></li>
<li><p>Framework that runs test for you - <strong>Testing framework</strong></p>
<ul>
<li><p>See <a class="reference internal" href="#document-quick-reference"><span class="doc std std-doc">Quick Reference</span></a> for some examples.</p></li>
</ul>
</li>
</ul>
</section>
<hr class="docutils" />
<section id="what-should-you-do">
<h3>What should you do?<a class="headerlink" href="#what-should-you-do" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Not every code needs perfect test coverage.</p></li>
<li><p>If code is interactive-only (Jupyter Notebook), it’s usually hard to
test.</p>
<ul>
<li><p>But also hard to run: the next lesson will discuss!</p></li>
</ul>
</li>
<li><p>At least end-to-end is often easy to add.</p></li>
<li><p>Add tests of tricky functions.</p>
<ul>
<li><p>If you’d have to run it over and over to test while writing, why
not make it a property test?</p></li>
</ul>
</li>
<li><p>It’s easy to have Gitlab/Github run the tests.</p>
<ul>
<li><p>It’s nice to push without thinking, and the system tells you when
it’s broke.</p></li>
</ul>
</li>
<li><p><strong>Learning how to test well make the rest of your code better, too.</strong></p></li>
</ul>
</section>
<hr class="docutils" />
<section id="where-to-start">
<h3>Where to start<a class="headerlink" href="#where-to-start" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>A simple script or notebook probably does not need an automated test.</p></li>
</ul>
<p><strong>If you have nothing yet</strong></p>
<ul class="simple">
<li><p>Start with an end-to-end test.</p></li>
<li><p>Describe in words how <em>you</em> check whether the code still works.</p></li>
<li><p>Translate the words into a script.</p></li>
<li><p>Run the script automatically on every code change.</p></li>
</ul>
<p><strong>If you want to start with unit-testing</strong></p>
<ul class="simple">
<li><p>You want to rewrite a function? Start adding a unit test right there first.</p></li>
</ul>
</section>
</section>
<span id="document-locally"></span><section id="testing-locally">
<h2>Testing locally<a class="headerlink" href="#testing-locally" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>How hard is it to set up a test suite for a first unit test?</p></li>
</ul>
</div>
<section id="exercise">
<h3>Exercise<a class="headerlink" href="#exercise" title="Link to this heading"></a></h3>
<p>In this exercise we will make a simple function and use
one of the language specific test frameworks to test it.</p>
<ul class="simple">
<li><p>This is easy to use by almost any project and doesn’t rely on any
other servers or services.</p></li>
<li><p>The downside is that you have to remember to run it yourself.</p></li>
</ul>
<div class="admonition-local-1-create-a-minimal-example-15-min exercise important admonition" id="exercise-0">
<p class="admonition-title">Local-1: Create a minimal example (15 min)</p>
<p>In this exercise, we will create a minimal example using
the <a class="reference external" href="http://doc.pytest.org">pytest</a>, run the test, and show what
happens when a test breaks.</p>
<ol class="arabic">
<li><p>Create a new directory and change into it:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mkdir<span class="w"> </span>local-testing-example
<span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>local-testing-example
</pre></div>
</div>
</li>
<li><p>Create an example file and paste the following code into it</p></li>
</ol>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-0-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-0-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button><button aria-controls="panel-0-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button></div><div aria-labelledby="tab-0-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-0-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><p>Create <code class="docutils literal notranslate"><span class="pre">example.py</span></code> with content</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_add</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
    <span class="k">assert</span> <span class="n">add</span><span class="p">(</span><span class="s1">&#39;space&#39;</span><span class="p">,</span> <span class="s1">&#39;ship&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;spaceship&#39;</span>
</pre></div>
</div>
<p>This code contains one genuine function and a test function.
<code class="docutils literal notranslate"><span class="pre">pytest</span></code> finds any functions beginning with <code class="docutils literal notranslate"><span class="pre">test_</span></code> and treats them
as tests.</p>
</div><div aria-labelledby="tab-0-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-Ug==" name="Ug==" role="tabpanel" tabindex="0"><p>Create <code class="docutils literal notranslate"><span class="pre">example.R</span></code> with content</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">require</span><span class="p">(</span><span class="n">testthat</span><span class="p">))</span><span class="w"> </span><span class="nf">install.packages</span><span class="p">(</span><span class="n">testthat</span><span class="p">)</span>
<span class="n">add</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">return</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">test_that</span><span class="p">(</span><span class="s">&quot;Adding integers works&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># Test that the result has the correct value</span>
<span class="w">    </span><span class="nf">expect_identical</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># Test that the result is numeric</span>
<span class="w">    </span><span class="nf">expect_true</span><span class="p">(</span><span class="nf">is.numeric</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
<span class="p">})</span>
</pre></div>
</div>
<p>A test with <code class="docutils literal notranslate"><span class="pre">testthat</span></code> is created by calling
<code class="docutils literal notranslate"><span class="pre">test_that()</span></code> with a test name and code as arguments.</p>
</div><div aria-labelledby="tab-0-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><p>Create <code class="docutils literal notranslate"><span class="pre">example.jl</span></code> with content</p>
<div class="highlight-Julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">myadd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="o">+</span><span class="n">b</span>
<span class="k">end</span>

<span class="k">using</span><span class="w"> </span><span class="n">Test</span>
<span class="nd">@testset</span><span class="w"> </span><span class="s">&quot;myadd&quot;</span><span class="w"> </span><span class="k">begin</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">myadd</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The package <code class="docutils literal notranslate"><span class="pre">Test.jl</span></code> handles all testing.
A test(set) is added with <code class="docutils literal notranslate"><span class="pre">&#64;testset</span></code>
and a test itself with <code class="docutils literal notranslate"><span class="pre">&#64;test</span></code>.</p>
</div><div aria-labelledby="tab-0-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-Q2F0Y2gy" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-Q2F0Y2gy" name="Q2F0Y2gy" role="tab" tabindex="0">Catch2</button><button aria-controls="panel-1-R29vZ2xlVGVzdA==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-R29vZ2xlVGVzdA==" name="R29vZ2xlVGVzdA==" role="tab" tabindex="-1">GoogleTest</button></div><div aria-labelledby="tab-1-Q2F0Y2gy" class="sphinx-tabs-panel group-tab" id="panel-1-Q2F0Y2gy" name="Q2F0Y2gy" role="tabpanel" tabindex="0"><p>Create <code class="docutils literal notranslate"><span class="pre">example.cc</span></code> with content</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;catch2/catch_test_macros.hpp&gt;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">Number</span><span class="o">&gt;</span>
<span class="n">Number</span>
<span class="n">add</span><span class="p">(</span><span class="n">Number</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">Number</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span><span class="w">    </span>

<span class="n">TEST_CASE</span><span class="p">(</span><span class="s">&quot;IntTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[add]&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">5</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> with content</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.14</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">test_example</span><span class="w"> </span><span class="s">CXX</span><span class="p">)</span>

<span class="nb">cmake_policy</span><span class="p">(</span><span class="s">SET</span><span class="w"> </span><span class="s">CMP0135</span><span class="w"> </span><span class="s">OLD</span><span class="p">)</span>

<span class="c">#Tell CMake to Download Catch2 library</span>
<span class="nb">include</span><span class="p">(</span><span class="s">FetchContent</span><span class="p">)</span>
<span class="nb">FetchContent_Declare</span><span class="p">(</span>
<span class="w">    </span><span class="s">Catch2</span>
<span class="w">    </span><span class="s">GIT_REPOSITORY</span><span class="w"> </span><span class="s">https://github.com/catchorg/Catch2.git</span>
<span class="w">    </span><span class="s">GIT_TAG</span><span class="w">        </span><span class="s">v3.4.0</span><span class="w"> </span><span class="c"># or a later release</span>
<span class="p">)</span>
<span class="nb">FetchContent_MakeAvailable</span><span class="p">(</span><span class="s">Catch2</span><span class="p">)</span>

<span class="c">#Setup testing</span>
<span class="nb">enable_testing</span><span class="p">()</span>
<span class="c">#add test executable</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">example</span><span class="w"> </span><span class="s">example.cc</span><span class="p">)</span>
<span class="c">#link Catch2 to example</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">example</span><span class="w"> </span><span class="s">PRIVATE</span><span class="w"> </span><span class="s">Catch2::Catch2WithMain</span><span class="p">)</span>
<span class="c">#Make Catch2 look for tests</span>
<span class="nb">include</span><span class="p">(</span><span class="s">Catch</span><span class="p">)</span>
<span class="nb">catch_discover_tests</span><span class="p">(</span><span class="s">example</span><span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-R29vZ2xlVGVzdA==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-R29vZ2xlVGVzdA==" name="R29vZ2xlVGVzdA==" role="tabpanel" tabindex="0"><p>Create <code class="docutils literal notranslate"><span class="pre">example.cc</span></code> with content</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gtest/gtest.h&gt;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">Number</span><span class="o">&gt;</span>
<span class="n">Number</span>
<span class="n">add</span><span class="p">(</span><span class="n">Number</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">Number</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span><span class="w">    </span>

<span class="n">TEST</span><span class="p">(</span><span class="n">AddTests</span><span class="p">,</span><span class="w"> </span><span class="n">IntTest</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="mi">5</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> with content</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.14</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">test_example</span><span class="w"> </span><span class="s">CXX</span><span class="p">)</span>

<span class="nb">cmake_policy</span><span class="p">(</span><span class="s">SET</span><span class="w"> </span><span class="s">CMP0135</span><span class="w"> </span><span class="s">OLD</span><span class="p">)</span>

<span class="c">#Tell CMake to Download Googletest library</span>
<span class="nb">include</span><span class="p">(</span><span class="s">FetchContent</span><span class="p">)</span>
<span class="nb">FetchContent_Declare</span><span class="p">(</span>
<span class="w">    </span><span class="s">googletest</span>
<span class="w">    </span><span class="s">URL</span><span class="w"> </span><span class="s">https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip</span>
<span class="p">)</span>
<span class="c"># For Windows: Prevent overriding the parent project&#39;s compiler/linker settings</span>
<span class="nb">set</span><span class="p">(</span><span class="s">gtest_force_shared_crt</span><span class="w"> </span><span class="s">ON</span><span class="w"> </span><span class="s">CACHE</span><span class="w"> </span><span class="s">BOOL</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="s">FORCE</span><span class="p">)</span>
<span class="nb">FetchContent_MakeAvailable</span><span class="p">(</span><span class="s">googletest</span><span class="p">)</span>

<span class="c">#Setup testing</span>
<span class="nb">enable_testing</span><span class="p">()</span>
<span class="c">#add test executable</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">example</span><span class="w"> </span><span class="s">example.cc</span><span class="p">)</span>
<span class="c">#link Googletest to example</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">example</span><span class="w"> </span><span class="s">GTest::gtest_main</span><span class="p">)</span>
<span class="c">#Make googletest look for tests</span>
<span class="nb">include</span><span class="p">(</span><span class="s">GoogleTest</span><span class="p">)</span>
<span class="nb">gtest_discover_tests</span><span class="p">(</span><span class="s">example</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
</div></div>
<ol class="arabic simple" start="3">
<li><p>Run the test</p></li>
</ol>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-2-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-2-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-2-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button><button aria-controls="panel-2-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button></div><div aria-labelledby="tab-2-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-2-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pytest<span class="w"> </span>-v<span class="w"> </span>example.py

<span class="go">============================================================ test session starts =================================</span>
<span class="go">platform linux -- Python 3.7.2, pytest-4.3.1, py-1.8.0, pluggy-0.9.0 -- /home/user/pytest-example/venv/bin/python3</span>
<span class="go">cachedir: .pytest_cache</span>
<span class="go">rootdir: /home/user/pytest-example, inifile:</span>
<span class="go">collected 1 item</span>

<span class="go">example.py::test_add PASSED</span>

<span class="go">========================================================= 1 passed in 0.01 seconds ===============================</span>
</pre></div>
</div>
<p>Yay! The test passed!</p>
<p>Hint for participants trying this inside Spyder or IPython: try <code class="docutils literal notranslate"><span class="pre">!pytest</span> <span class="pre">-v</span> <span class="pre">example.py</span></code>.</p>
</div><div aria-labelledby="tab-2-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-Ug==" name="Ug==" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>Rscript<span class="w"> </span>example.R<span class="w"> </span>

<span class="go">Loading required package: testthat</span>
<span class="go">Test passed 🎉 </span>
</pre></div>
</div>
<p>Yay! The test passed!</p>
<p>Note that the emoji is random and might be different for you.</p>
</div><div aria-labelledby="tab-2-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>julia<span class="w"> </span>example.jl<span class="w"> </span>

<span class="go">Test Summary: | Pass  Total  Time</span>
<span class="go">myadd         |    1      1  0.0s</span>
</pre></div>
</div>
<p>Yay! The test passed!</p>
</div><div aria-labelledby="tab-2-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-Qysr" name="Qysr" role="tabpanel" tabindex="0"><p>As this is the only compiled language in the examples we have to do a few more steps.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-Q2F0Y2gy" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-3-Q2F0Y2gy" name="Q2F0Y2gy" role="tab" tabindex="0">Catch2</button><button aria-controls="panel-3-R29vZ2xlVGVzdA==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-3-R29vZ2xlVGVzdA==" name="R29vZ2xlVGVzdA==" role="tab" tabindex="-1">GoogleTest</button></div><div aria-labelledby="tab-3-Q2F0Y2gy" class="sphinx-tabs-panel group-tab" id="panel-3-Q2F0Y2gy" name="Q2F0Y2gy" role="tabpanel" tabindex="0"><p>Starting with the configure step of CMake
(Note that <code class="docutils literal notranslate"><span class="pre">&lt;path&gt;</span></code> will be different for everyone)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cmake<span class="w"> </span>-S.<span class="w"> </span>-Bbuild
<span class="go">-- The CXX compiler identification is GNU 13.2.0</span>
<span class="go">-- Detecting CXX compiler ABI info</span>
<span class="go">-- Detecting CXX compiler ABI info - done</span>
<span class="go">-- Check for working CXX compiler: /usr/bin/c++ - skipped</span>
<span class="go">-- Detecting CXX compile features</span>
<span class="go">-- Detecting CXX compile features - done</span>
<span class="go">-- Performing Test HAVE_FLAG__ffile_prefix_map__&lt;path&gt;_build__deps_catch2_src__</span>
<span class="go">-- Performing Test HAVE_FLAG__ffile_prefix_map__&lt;path&gt;_build__deps_catch2_src__ - Success</span>
<span class="go">-- Configuring done (4.1s)</span>
<span class="go">-- Generating done (0.0s)</span>
<span class="go">-- Build files have been written to: &lt;path&gt;/build</span>
</pre></div>
</div>
<p>and the build step which will also download Catch2 on the first run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cmake<span class="w"> </span>--build<span class="w"> </span>build
<span class="go">[  0%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/benchmark/catch_chronometer.cpp.o</span>
<span class="go">[  1%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/benchmark/detail/catch_benchmark_function.cpp.o</span>
<span class="go">[  2%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/benchmark/detail/catch_run_for_at_least.cpp.o</span>
<span class="go">[  3%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/benchmark/detail/catch_stats.cpp.o</span>
<span class="go">[  4%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/generators/catch_generator_exception.cpp.o</span>
<span class="go">[  5%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/generators/catch_generators.cpp.o</span>
<span class="go">[  6%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/generators/catch_generators_random.cpp.o</span>
<span class="go">[  7%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/reporters/catch_reporter_automake.cpp.o</span>
<span class="go">[  8%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/reporters/catch_reporter_common_base.cpp.o</span>
<span class="go">[  9%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/reporters/catch_reporter_compact.cpp.o</span>
<span class="go">[ 10%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/reporters/catch_reporter_console.cpp.o</span>
<span class="go">[ 11%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/reporters/catch_reporter_cumulative_base.cpp.o</span>
<span class="go">[ 12%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/reporters/catch_reporter_event_listener.cpp.o</span>
<span class="go">[ 12%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/reporters/catch_reporter_helpers.cpp.o</span>
<span class="go">[ 13%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/reporters/catch_reporter_junit.cpp.o</span>
<span class="go">[ 14%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/reporters/catch_reporter_multi.cpp.o</span>
<span class="go">[ 15%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/reporters/catch_reporter_registrars.cpp.o</span>
<span class="go">[ 16%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/reporters/catch_reporter_sonarqube.cpp.o</span>
<span class="go">[ 17%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/reporters/catch_reporter_streaming_base.cpp.o</span>
<span class="go">[ 18%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/reporters/catch_reporter_tap.cpp.o</span>
<span class="go">[ 19%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/reporters/catch_reporter_teamcity.cpp.o</span>
<span class="go">[ 20%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/reporters/catch_reporter_xml.cpp.o</span>
<span class="go">[ 21%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/interfaces/catch_interfaces_capture.cpp.o</span>
<span class="go">[ 22%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/interfaces/catch_interfaces_config.cpp.o</span>
<span class="go">[ 23%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/interfaces/catch_interfaces_exception.cpp.o</span>
<span class="go">[ 24%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/interfaces/catch_interfaces_generatortracker.cpp.o</span>
<span class="go">[ 25%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/interfaces/catch_interfaces_registry_hub.cpp.o</span>
<span class="go">[ 25%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/interfaces/catch_interfaces_reporter.cpp.o</span>
<span class="go">[ 26%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/interfaces/catch_interfaces_reporter_factory.cpp.o</span>
<span class="go">[ 27%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/interfaces/catch_interfaces_testcase.cpp.o</span>
<span class="go">[ 28%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/catch_approx.cpp.o</span>
<span class="go">[ 29%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/catch_assertion_result.cpp.o</span>
<span class="go">[ 30%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/catch_config.cpp.o</span>
<span class="go">[ 31%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/catch_get_random_seed.cpp.o</span>
<span class="go">[ 32%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/catch_message.cpp.o</span>
<span class="go">[ 33%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/catch_registry_hub.cpp.o</span>
<span class="go">[ 34%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/catch_session.cpp.o</span>
<span class="go">[ 35%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/catch_tag_alias_autoregistrar.cpp.o</span>
<span class="go">[ 36%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/catch_test_case_info.cpp.o</span>
<span class="go">[ 37%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/catch_test_spec.cpp.o</span>
<span class="go">[ 37%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/catch_timer.cpp.o</span>
<span class="go">[ 38%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/catch_tostring.cpp.o</span>
<span class="go">[ 39%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/catch_totals.cpp.o</span>
<span class="go">[ 40%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/catch_translate_exception.cpp.o</span>
<span class="go">[ 41%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/catch_version.cpp.o</span>
<span class="go">[ 42%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_assertion_handler.cpp.o</span>
<span class="go">[ 43%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_case_insensitive_comparisons.cpp.o</span>
<span class="go">[ 44%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_clara.cpp.o</span>
<span class="go">[ 45%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_commandline.cpp.o</span>
<span class="go">[ 46%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_console_colour.cpp.o</span>
<span class="go">[ 47%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_context.cpp.o</span>
<span class="go">[ 48%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_debug_console.cpp.o</span>
<span class="go">[ 49%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_debugger.cpp.o</span>
<span class="go">[ 50%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_decomposer.cpp.o</span>
<span class="go">[ 50%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_enforce.cpp.o</span>
<span class="go">[ 51%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_enum_values_registry.cpp.o</span>
<span class="go">[ 52%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_errno_guard.cpp.o</span>
<span class="go">[ 53%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_exception_translator_registry.cpp.o</span>
<span class="go">[ 54%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_fatal_condition_handler.cpp.o</span>
<span class="go">[ 55%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_floating_point_helpers.cpp.o</span>
<span class="go">[ 56%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_getenv.cpp.o</span>
<span class="go">[ 57%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_istream.cpp.o</span>
<span class="go">[ 58%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_lazy_expr.cpp.o</span>
<span class="go">[ 59%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_leak_detector.cpp.o</span>
<span class="go">[ 60%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_list.cpp.o</span>
<span class="go">[ 61%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_message_info.cpp.o</span>
<span class="go">[ 62%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_output_redirect.cpp.o</span>
<span class="go">[ 62%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_parse_numbers.cpp.o</span>
<span class="go">[ 63%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_polyfills.cpp.o</span>
<span class="go">[ 64%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_random_number_generator.cpp.o</span>
<span class="go">[ 65%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_random_seed_generation.cpp.o</span>
<span class="go">[ 66%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_reporter_registry.cpp.o</span>
<span class="go">[ 67%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_reporter_spec_parser.cpp.o</span>
<span class="go">[ 68%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_result_type.cpp.o</span>
<span class="go">[ 69%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_reusable_string_stream.cpp.o</span>
<span class="go">[ 70%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_run_context.cpp.o</span>
<span class="go">[ 71%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_section.cpp.o</span>
<span class="go">[ 72%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_singletons.cpp.o</span>
<span class="go">[ 73%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_source_line_info.cpp.o</span>
<span class="go">[ 74%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_startup_exception_registry.cpp.o</span>
<span class="go">[ 75%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_stdstreams.cpp.o</span>
<span class="go">[ 75%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_string_manip.cpp.o</span>
<span class="go">[ 76%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_stringref.cpp.o</span>
<span class="go">[ 77%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_tag_alias_registry.cpp.o</span>
<span class="go">[ 78%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_test_case_info_hasher.cpp.o</span>
<span class="go">[ 79%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_test_case_registry_impl.cpp.o</span>
<span class="go">[ 80%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_test_case_tracker.cpp.o</span>
<span class="go">[ 81%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_test_failure_exception.cpp.o</span>
<span class="go">[ 82%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_test_registry.cpp.o</span>
<span class="go">[ 83%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_test_spec_parser.cpp.o</span>
<span class="go">[ 84%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_textflow.cpp.o</span>
<span class="go">[ 85%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_uncaught_exceptions.cpp.o</span>
<span class="go">[ 86%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_wildcard_pattern.cpp.o</span>
<span class="go">[ 87%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/internal/catch_xmlwriter.cpp.o</span>
<span class="go">[ 87%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/matchers/catch_matchers.cpp.o</span>
<span class="go">[ 88%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/matchers/catch_matchers_container_properties.cpp.o</span>
<span class="go">[ 89%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/matchers/catch_matchers_exception.cpp.o</span>
<span class="go">[ 90%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/matchers/catch_matchers_floating_point.cpp.o</span>
<span class="go">[ 91%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/matchers/catch_matchers_predicate.cpp.o</span>
<span class="go">[ 92%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/matchers/catch_matchers_quantifiers.cpp.o</span>
<span class="go">[ 93%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/matchers/catch_matchers_string.cpp.o</span>
<span class="go">[ 94%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/matchers/catch_matchers_templated.cpp.o</span>
<span class="go">[ 95%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2.dir/catch2/matchers/internal/catch_matchers_impl.cpp.o</span>
<span class="go">[ 96%] Linking CXX static library libCatch2.a</span>
<span class="go">[ 96%] Built target Catch2</span>
<span class="go">[ 97%] Building CXX object _deps/catch2-build/src/CMakeFiles/Catch2WithMain.dir/catch2/internal/catch_main.cpp.o</span>
<span class="go">[ 98%] Linking CXX static library libCatch2Main.a</span>
<span class="go">[ 98%] Built target Catch2WithMain</span>
<span class="go">[ 99%] Building CXX object CMakeFiles/example.dir/example.cc.o</span>
<span class="go">[100%] Linking CXX executable example</span>
<span class="go">[100%] Built target example</span>
</pre></div>
</div>
<p>Finally, we change into the <code class="docutils literal notranslate"><span class="pre">build</span></code> directory
and run CTest</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>build
<span class="gp">$ </span>ctest
<span class="go">Test project &lt;path&gt;/build</span>
<span class="go">    Start 1: IntTest</span>
<span class="go">1/1 Test #1: IntTest ..........................   Passed    0.01 sec</span>

<span class="go">100% tests passed, 0 tests failed out of 1</span>

<span class="go">Total Test time (real) =   0.01 sec</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-3-R29vZ2xlVGVzdA==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-3-R29vZ2xlVGVzdA==" name="R29vZ2xlVGVzdA==" role="tabpanel" tabindex="0"><p>Starting with the configure step of CMake
(Note that <code class="docutils literal notranslate"><span class="pre">&lt;path&gt;</span></code> will be different for everyone)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cmake<span class="w"> </span>-S.<span class="w"> </span>-Bbuild
<span class="go">-- The CXX compiler identification is GNU 13.2.0</span>
<span class="go">-- Detecting CXX compiler ABI info</span>
<span class="go">-- Detecting CXX compiler ABI info - done</span>
<span class="go">-- Check for working CXX compiler: /usr/bin/c++ - skipped</span>
<span class="go">-- Detecting CXX compile features</span>
<span class="go">-- Detecting CXX compile features - done</span>
<span class="go">-- The C compiler identification is GNU 13.2.0</span>
<span class="go">-- Detecting C compiler ABI info</span>
<span class="go">-- Detecting C compiler ABI info - done</span>
<span class="go">-- Check for working C compiler: /usr/bin/cc - skipped</span>
<span class="go">-- Detecting C compile features</span>
<span class="go">-- Detecting C compile features - done</span>
<span class="go">-- Performing Test CMAKE_HAVE_LIBC_PTHREAD</span>
<span class="go">-- Performing Test CMAKE_HAVE_LIBC_PTHREAD - Success</span>
<span class="go">-- Found Threads: TRUE  </span>
<span class="go">-- Configuring done (2.1s)</span>
<span class="go">-- Generating done (0.0s)</span>
<span class="go">-- Build files have been written to: &lt;path&gt;/build</span>
</pre></div>
</div>
<p>and the build step which will also download GoogleTest on the first run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cmake<span class="w"> </span>--build<span class="w"> </span>build
<span class="go">[ 10%] Building CXX object _deps/googletest-build/googletest/CMakeFiles/gtest.dir/src/gtest-all.cc.o</span>
<span class="go">[ 20%] Linking CXX static library ../../../lib/libgtest.a</span>
<span class="go">[ 20%] Built target gtest</span>
<span class="go">[ 30%] Building CXX object _deps/googletest-build/googletest/CMakeFiles/gtest_main.dir/src/gtest_main.cc.o</span>
<span class="go">[ 40%] Linking CXX static library ../../../lib/libgtest_main.a</span>
<span class="go">[ 40%] Built target gtest_main</span>
<span class="go">[ 50%] Building CXX object CMakeFiles/example.dir/example.cc.o</span>
<span class="go">[ 60%] Linking CXX executable example</span>
<span class="go">[ 60%] Built target example</span>
<span class="go">[ 70%] Building CXX object _deps/googletest-build/googlemock/CMakeFiles/gmock.dir/src/gmock-all.cc.o</span>
<span class="go">[ 80%] Linking CXX static library ../../../lib/libgmock.a</span>
<span class="go">[ 80%] Built target gmock</span>
<span class="go">[ 90%] Building CXX object _deps/googletest-build/googlemock/CMakeFiles/gmock_main.dir/src/gmock_main.cc.o</span>
<span class="go">[100%] Linking CXX static library ../../../lib/libgmock_main.a</span>
<span class="go">[100%] Built target gmock_main</span>
</pre></div>
</div>
<p>Finally, we change into the <code class="docutils literal notranslate"><span class="pre">build</span></code> directory
and run CTest</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>build
<span class="gp">$ </span>ctest
<span class="go">Test project &lt;path&gt;/build</span>
<span class="go">    Start 1: AddTests.IntTest</span>
<span class="go">1/1 Test #1: AddTests.IntTest .................   Passed    0.00 sec</span>

<span class="go">100% tests passed, 0 tests failed out of 1</span>

<span class="go">Total Test time (real) =   0.01 sec</span>
</pre></div>
</div>
</div></div>
</div></div>
<ol class="arabic simple" start="4">
<li><p>Let us break the test!</p></li>
</ol>
<p>Introduce a code change which breaks the code (e.g. <code class="docutils literal notranslate"><span class="pre">-</span></code> instead of <code class="docutils literal notranslate"><span class="pre">+</span></code>) and check
whether our test detects the change:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-4-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-4-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-4-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button><button aria-controls="panel-4-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button></div><div aria-labelledby="tab-4-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-4-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pytest<span class="w"> </span>-v<span class="w"> </span>example.py

<span class="go">============================================================ test session starts =================================</span>
<span class="go">platform linux -- Python 3.7.2, pytest-4.3.1, py-1.8.0, pluggy-0.9.0 -- /home/user/pytest-example/venv/bin/python3</span>
<span class="go">cachedir: .pytest_cache</span>
<span class="go">rootdir: /home/user/pytest-example, inifile:</span>
<span class="go">collected 1 item</span>

<span class="go">example.py::test_add FAILED</span>

<span class="go">================================================================= FAILURES =======================================</span>
<span class="go">_________________________________________________________________ test_add _______________________________________</span>

<span class="go">    def test_add():</span>
<span class="go">&gt;       assert add(2, 3) == 5</span>
<span class="go">E       assert -1 == 5</span>
<span class="go">E         --1</span>
<span class="go">E         +5</span>

<span class="go">example.py:6: AssertionError</span>
<span class="go">========================================================= 1 failed in 0.05 seconds ==============</span>
</pre></div>
</div>
<p>Notice how pytest is smart and includes context: lines that failed,
values of the relevant variables.</p>
</div><div aria-labelledby="tab-4-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-Ug==" name="Ug==" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>Rscript<span class="w"> </span>example.R<span class="w"> </span>

<span class="go">── Failure: Adding integers works ──────────────────────────────</span>
<span class="go">`res` not identical to 5.</span>
<span class="go">1/1 mismatches</span>
<span class="go">[1] -1 - 5 == -6</span>

<span class="go">Error: Test failed</span>
<span class="go">Execution halted</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">testthat</span></code> tells us exactly which test failed and how
but does not include more context.</p>
</div><div aria-labelledby="tab-4-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>julia<span class="w"> </span>example.jl

<span class="go">myadd: Test Failed at /home/user/local-testing-example/example.jl:7</span>
<span class="go">Expression: myadd(2, 3) == 5</span>
<span class="go">Evaluated: -1 == 5</span>

<span class="go">Stacktrace:</span>
<span class="go">[1] macro expansion</span>
<span class="go">@ ~/opt/julia-1.10.0/share/julia/stdlib/v1.10/Test/src/Test.jl:672 [inlined]</span>
<span class="go">[2] macro expansion</span>
<span class="go">@ ~/local-testing-example/example.jl:7 [inlined]</span>
<span class="go">[3] macro expansion</span>
<span class="go">@ ~/opt/julia-1.10.0/share/julia/stdlib/v1.10/Test/src/Test.jl:1577 [inlined]</span>
<span class="go">[4] top-level scope</span>
<span class="go">@ ~/local-testing-example/example.jl:7</span>
<span class="go">Test Summary: | Fail  Total  Time</span>
<span class="go">myadd         |    1      1  0.6s</span>
<span class="go">ERROR: LoadError: Some tests did not pass: 0 passed, 1 failed, 0 errored, 0 broken.</span>
<span class="go">in expression starting at /home/user/local-testing-example/example.jl:6</span>
</pre></div>
</div>
<p>Notice how <code class="docutils literal notranslate"><span class="pre">Test.jl</span></code> is smart and includes context:
Lines that failed, evaluated and expected results.</p>
</div><div aria-labelledby="tab-4-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-Qysr" name="Qysr" role="tabpanel" tabindex="0"><p>Since we introduced a change we have to call <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">--build</span> <span class="pre">build</span></code> again
(from the top directory)</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-5-Q2F0Y2gy" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-5-Q2F0Y2gy" name="Q2F0Y2gy" role="tab" tabindex="0">Catch2</button><button aria-controls="panel-5-R29vZ2xlVGVzdA==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-5-R29vZ2xlVGVzdA==" name="R29vZ2xlVGVzdA==" role="tab" tabindex="-1">GoogleTest</button></div><div aria-labelledby="tab-5-Q2F0Y2gy" class="sphinx-tabs-panel group-tab" id="panel-5-Q2F0Y2gy" name="Q2F0Y2gy" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ctest
<span class="go">Test project &lt;path&gt;/build</span>
<span class="go">    Start 1: IntTest</span>
<span class="go">1/1 Test #1: IntTest ..........................***Failed    0.01 sec</span>

<span class="go">0% tests passed, 1 tests failed out of 1</span>

<span class="go">Total Test time (real) =   0.01 sec</span>

<span class="go">The following tests FAILED:</span>
<span class="go">	  1 - IntTest (Failed)</span>
<span class="go">Output from these tests are in: &lt;path&gt;/build/Testing/Temporary/LastTest.log</span>
<span class="go">Use &quot;--rerun-failed --output-on-failure&quot; to re-run the failed cases verbosely.</span>
</pre></div>
</div>
<p>following the recommendation, we run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ctest<span class="w"> </span>--output-on-failure
<span class="go">Test project &lt;path&gt;/build</span>
<span class="go">    Start 1: IntTest</span>
<span class="go">1/1 Test #1: IntTest ..........................***Failed    0.01 sec</span>
<span class="go">Filters: &quot;IntTest&quot;</span>
<span class="go">Randomness seeded to: 2865819826</span>

<span class="go">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="go">example is a Catch2 v3.4.0 host application.</span>
<span class="go">Run with -? for options</span>

<span class="go">-------------------------------------------------------------------------------</span>
<span class="go">IntTest</span>
<span class="go">-------------------------------------------------------------------------------</span>
<span class="go">&lt;path&gt;/example.cc:10</span>
<span class="go">...............................................................................</span>

<span class="go">&lt;path&gt;/example.cc:12: FAILED:</span>
<span class="go">  REQUIRE( add(2,3)==5 )</span>
<span class="go">with expansion:</span>
<span class="go">  -1 == 5</span>

<span class="go">===============================================================================</span>
<span class="go">test cases: 1 | 1 failed</span>
<span class="go">assertions: 1 | 1 failed</span>



<span class="go">0% tests passed, 1 tests failed out of 1</span>

<span class="go">Total Test time (real) =   0.01 sec</span>

<span class="go">The following tests FAILED:</span>
<span class="go">	  1 - IntTest (Failed)</span>
<span class="go">Errors while running CTest</span>
</pre></div>
</div>
<p>This output is very verbose, but notice how it includes context: lines that failed, values of the relevant variables</p>
</div><div aria-labelledby="tab-5-R29vZ2xlVGVzdA==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-5-R29vZ2xlVGVzdA==" name="R29vZ2xlVGVzdA==" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ctest
<span class="go">Test project &lt;path&gt;/build</span>
<span class="go">    Start 1: AddTests.IntTest</span>
<span class="go">1/1 Test #1: AddTests.IntTest .................***Failed    0.00 sec</span>

<span class="go">0% tests passed, 1 tests failed out of 1</span>

<span class="go">Total Test time (real) =   0.01 sec</span>

<span class="go">The following tests FAILED:</span>
<span class="go">	  1 - AddTests.IntTest (Failed)</span>
<span class="go">Errors while running CTest</span>
<span class="go">Output from these tests are in: &lt;path&gt;/build/Testing/Temporary/LastTest.log</span>
<span class="go">Use &quot;--rerun-failed --output-on-failure&quot; to re-run the failed cases verbosely.</span>
</pre></div>
</div>
<p>following the recommendation, we run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ctest<span class="w"> </span>--output-on-failure
<span class="go">Test project &lt;path&gt;/build</span>
<span class="go">    Start 1: AddTests.IntTest</span>
<span class="go">1/1 Test #1: AddTests.IntTest .................***Failed    0.00 sec</span>
<span class="go">Running main() from &lt;path&gt;/build/_deps/googletest-src/googletest/src/gtest_main.cc</span>
<span class="go">Note: Google Test filter = AddTests.IntTest</span>
<span class="go">[==========] Running 1 test from 1 test suite.</span>
<span class="go">[----------] Global test environment set-up.</span>
<span class="go">[----------] 1 test from AddTests</span>
<span class="go">[ RUN      ] AddTests.IntTest</span>
<span class="go">&lt;path&gt;/example.cc:12: Failure</span>
<span class="go">Expected equality of these values:</span>
<span class="go">  add(2,3)</span>
<span class="go">    Which is: -1</span>
<span class="go">  5</span>
<span class="go">[  FAILED  ] AddTests.IntTest (0 ms)</span>
<span class="go">[----------] 1 test from AddTests (0 ms total)</span>

<span class="go">[----------] Global test environment tear-down</span>
<span class="go">[==========] 1 test from 1 test suite ran. (0 ms total)</span>
<span class="go">[  PASSED  ] 0 tests.</span>
<span class="go">[  FAILED  ] 1 test, listed below:</span>
<span class="go">[  FAILED  ] AddTests.IntTest</span>

<span class="go"> 1 FAILED TEST</span>


<span class="go">0% tests passed, 1 tests failed out of 1</span>

<span class="go">Total Test time (real) =   0.01 sec</span>

<span class="go">The following tests FAILED:</span>
<span class="go">	  1 - AddTests.IntTest (Failed)</span>
<span class="go">Errors while running CTest</span>
</pre></div>
</div>
<p>This output is very verbose, but notice how it includes context: lines that failed, values of the relevant variables</p>
</div></div>
</div></div>
</div>
<div class="admonition-optional-local-2-create-a-test-that-considers-numerical-tolerance-10-min exercise important admonition" id="exercise-1">
<p class="admonition-title">(optional) Local-2: Create a test that considers numerical tolerance (10 min)</p>
<p>Let’s see an example where the test has to be more clever in order to
avoid false negative.</p>
<p>In the above exercise we have compared integers.  In this optional exercise we
want to learn how to compare floating point numbers since they are more tricky
(see also <a class="reference external" href="https://floating-point-gui.de/">“What Every Programmer Should Know About Floating-Point Arithmetic”</a>).</p>
<p>The following test will fail and this might be surprising. Try it out:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-6-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-6-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-6-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-6-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-6-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-6-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button><button aria-controls="panel-6-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-6-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button></div><div aria-labelledby="tab-6-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-6-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_add</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">add</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span> <span class="o">==</span> <span class="mf">0.3</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-6-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-6-Ug==" name="Ug==" role="tabpanel" tabindex="0"><div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">add</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">){</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span>
<span class="p">}</span>

<span class="nf">test_that</span><span class="p">(</span><span class="s">&quot;Adding floats works&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="nf">expect_identical</span><span class="p">(</span><span class="nf">add</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.2</span><span class="p">),</span><span class="m">0.3</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-6-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-6-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><div class="highlight-Julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">myadd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span>
<span class="w"> </span><span class="k">end</span>

<span class="k">using</span><span class="w"> </span><span class="n">Test</span>
<span class="nd">@testset</span><span class="w"> </span><span class="s">&quot;myadd&quot;</span><span class="w"> </span><span class="k">begin</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">myadd</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.3</span>
<span class="k">end</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-6-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-6-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-7-Q2F0Y2gy" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-7-Q2F0Y2gy" name="Q2F0Y2gy" role="tab" tabindex="0">Catch2</button><button aria-controls="panel-7-R29vZ2xlVGVzdA==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-7-R29vZ2xlVGVzdA==" name="R29vZ2xlVGVzdA==" role="tab" tabindex="-1">GoogleTest</button></div><div aria-labelledby="tab-7-Q2F0Y2gy" class="sphinx-tabs-panel group-tab" id="panel-7-Q2F0Y2gy" name="Q2F0Y2gy" role="tabpanel" tabindex="0"><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;catch2/catch_test_macros.hpp&gt;</span>

<span class="w">  </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">Number</span><span class="o">&gt;</span>
<span class="w">  </span><span class="n">Number</span>
<span class="w">  </span><span class="n">add</span><span class="p">(</span><span class="n">Number</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">Number</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w">    </span>
<span class="w">  </span>
<span class="w">  </span><span class="n">TEST_CASE</span><span class="p">(</span><span class="s">&quot;AddTests&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DoubleTest&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">      </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">==</span><span class="mf">0.3</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-7-R29vZ2xlVGVzdA==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-7-R29vZ2xlVGVzdA==" name="R29vZ2xlVGVzdA==" role="tabpanel" tabindex="0"><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gtest/gtest.h&gt;</span>

<span class="w">  </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">Number</span><span class="o">&gt;</span>
<span class="w">  </span><span class="n">Number</span>
<span class="w">  </span><span class="n">add</span><span class="p">(</span><span class="n">Number</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">Number</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w">    </span>
<span class="w">  </span>
<span class="w">  </span><span class="n">TEST</span><span class="p">(</span><span class="n">AddTests</span><span class="p">,</span><span class="w"> </span><span class="n">DoubleTest</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">      </span><span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="mf">0.3</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
</div></div>
</div></div>
<p>Your goal: find a more robust way to test this addition.</p>
</div>
<div class="admonition-solution-local-2 solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution: Local-2</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-8-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-8-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-8-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-8-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-8-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-8-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button><button aria-controls="panel-8-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-8-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button></div><div aria-labelledby="tab-8-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-8-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><p>One solution is to use
<a class="reference external" href="https://docs.pytest.org/en/4.6.x/reference.html#pytest-approx">pytest.approx</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pytest</span><span class="w"> </span><span class="kn">import</span> <span class="n">approx</span>

<span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_add</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">add</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>
</pre></div>
</div>
<p>But maybe you didn’t know about
<a class="reference external" href="https://docs.pytest.org/en/4.6.x/reference.html#pytest-approx">pytest.approx</a>:
and did this instead:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_add</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">result</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0e-7</span>
</pre></div>
</div>
<p>This is OK but the <code class="docutils literal notranslate"><span class="pre">1.0e-7</span></code> can be a bit arbitrary.</p>
</div><div aria-labelledby="tab-8-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-8-Ug==" name="Ug==" role="tabpanel" tabindex="0"><p>One solution is to use
<a class="reference external" href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a> which allows for roundoff errors:</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">test_that</span><span class="p">(</span><span class="s">&quot;Adding floats works with equal&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span>
<span class="w">    </span><span class="nf">expect_equal</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="m">0.3</span><span class="p">)</span>
<span class="w">    </span><span class="nf">expect_true</span><span class="p">(</span><span class="nf">is.numeric</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
<span class="p">})</span>
</pre></div>
</div>
<p>But maybe you didn’t know about it and used the ‘less than’ comparison of <a class="reference external" href="https://testthat.r-lib.org/reference/comparison-expectations.html">expect_lt</a> instead:</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">test_that</span><span class="p">(</span><span class="s">&quot;Adding floats works with lt&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.2</span><span class="p">)</span>
<span class="w">    </span><span class="nf">expect_lt</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">res</span><span class="m">-0.3</span><span class="p">),</span><span class="m">1.0e-7</span><span class="p">)</span>
<span class="w">    </span><span class="nf">expect_true</span><span class="p">(</span><span class="nf">is.numeric</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
<span class="p">})</span>
</pre></div>
</div>
<p>This is OK but the <code class="docutils literal notranslate"><span class="pre">1.0e-7</span></code> can be a bit arbitrary.</p>
</div><div aria-labelledby="tab-8-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-8-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><p>One solution is to use <code class="docutils literal notranslate"><span class="pre">\approx</span></code>:</p>
<div class="highlight-Julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@testset</span><span class="w"> </span><span class="s">&quot;Add floats with approx&quot;</span><span class="w"> </span><span class="k">begin</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">myadd</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="w"> </span><span class="o">≈</span><span class="w"> </span><span class="mf">0.3</span>
<span class="w">    </span><span class="c">#Variant with specifying a tolerance</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">myadd</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="w"> </span><span class="o">≈</span><span class="w"> </span><span class="mf">0.3</span><span class="w"> </span><span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-7</span>
<span class="k">end</span>
</pre></div>
</div>
<p>But maybe you didn’t know about <code class="docutils literal notranslate"><span class="pre">\approx</span></code>
and did this instead:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="nd">@test</span> <span class="nb">abs</span><span class="p">(</span><span class="n">myadd</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">-</span><span class="mf">0.3</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0e-7</span>
</pre></div>
</div>
<p>This is OK but the <code class="docutils literal notranslate"><span class="pre">1.0e-7</span></code> can be a bit arbitrary.</p>
</div><div aria-labelledby="tab-8-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-8-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-9-Q2F0Y2gy" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-9-Q2F0Y2gy" name="Q2F0Y2gy" role="tab" tabindex="0">Catch2</button><button aria-controls="panel-9-R29vZ2xlVGVzdA==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-9-R29vZ2xlVGVzdA==" name="R29vZ2xlVGVzdA==" role="tab" tabindex="-1">GoogleTest</button></div><div aria-labelledby="tab-9-Q2F0Y2gy" class="sphinx-tabs-panel group-tab" id="panel-9-Q2F0Y2gy" name="Q2F0Y2gy" role="tabpanel" tabindex="0"><p>Catch2 offers a very sophisticated way to test equality of two floating point numbers based on ‘units in the last place (ULP)’.
Matching the settings of GoogleTest we consider decimals equals to within <code class="docutils literal notranslate"><span class="pre">4</span></code> ULP.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;catch2/matchers/catch_matchers_floating_point.hpp&gt;</span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">Catch</span><span class="o">::</span><span class="n">Matchers</span><span class="o">::</span><span class="n">WithinULP</span><span class="p">;</span>
<span class="w">  </span><span class="n">TEST_CASE</span><span class="p">(</span><span class="s">&quot;DoubleTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[add]&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">REQUIRE_THAT</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">WithinULP</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span><span class="mi">4</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
<p>But maybe you didn’t know about
<a class="reference external" href="https://github.com/catchorg/Catch2/blob/devel/docs/comparing-floating-point-numbers.md#top">Catch2 floating point matchers</a>
and did this instead:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cmath&gt;</span>
<span class="w">  </span><span class="n">TEST_CASE</span><span class="p">(</span><span class="s">&quot;DoubleTest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[add]&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="mf">-0.3</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1.0e-7</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
<p>This is OK but the <code class="docutils literal notranslate"><span class="pre">1.0e-7</span></code> can be a bit arbitrary. The first option is certainly more robust and recommended in the C++ case.</p>
</div><div aria-labelledby="tab-9-R29vZ2xlVGVzdA==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-9-R29vZ2xlVGVzdA==" name="R29vZ2xlVGVzdA==" role="tabpanel" tabindex="0"><p>GoogleTest offers a very sophisticated way to test equality of two double numbers based on ‘units in the last place (ULP)’,
see <a class="reference external" href="http://google.github.io/googletest/reference/assertions.html#floating-point">the documentation</a> for more details.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">TEST</span><span class="p">(</span><span class="n">AddTests</span><span class="p">,</span><span class="w"> </span><span class="n">DoubleTest</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">ASSERT_DOUBLE_EQ</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="mf">0.3</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
<p>But maybe you found the ‘less than’ assertion first and did this instead:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="cp">#include</span><span class="cpf">&lt;cmath&gt;</span>
<span class="w">  </span><span class="n">TEST</span><span class="p">(</span><span class="n">AddTests</span><span class="p">,</span><span class="w"> </span><span class="n">DoubleTest</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//assert that add(0.1,0.2)-0.3 &lt; 1.0e-7 holds</span>
<span class="w">    </span><span class="n">ASSERT_LT</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="mf">-0.3</span><span class="p">),</span><span class="mf">1.0e-7</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
<p>This is OK but the <code class="docutils literal notranslate"><span class="pre">1.0e-7</span></code> can be a bit arbitrary. The first option is certainly more robust and recommended in the C++ case.</p>
</div></div>
</div></div>
</div>
<hr class="docutils" />
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>Each test framework has its way of collecting and running all test functions, e.g. functions beginning with <code class="docutils literal notranslate"><span class="pre">test_</span></code> for <code class="docutils literal notranslate"><span class="pre">pytest</span></code>.</p></li>
<li><p>Python, Julia and C/C++ have better tooling for automated tests than Fortran and you can use those also for Fortran projects (via <code class="docutils literal notranslate"><span class="pre">iso_c_binding</span></code>).</p></li>
</ul>
</div>
</section>
</section>
<span id="document-continuous-integration"></span><section id="automated-testing">
<h2>Automated testing<a class="headerlink" href="#automated-testing" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>How can we implement automatic testing each time we push changes to the repository?</p></li>
<li><p>Why is it good to autoclose issues with commit messages?</p></li>
</ul>
</div>
<section id="continuous-integration">
<h3>Continuous integration<a class="headerlink" href="#continuous-integration" title="Link to this heading"></a></h3>
<p>We will now learn to set up automatic tests using either GitHub Actions or
GitLab CI - you can choose which one to use and instructions are provided for both.</p>
<p>This exercise can be run in “collaborative mode” by following instead the instructions
in <a class="reference internal" href="#document-full-cycle-ci"><span class="doc std std-doc">Full-cycle collaborative workflow</span></a>. In the collaborative version steps
C-D below are performed by a collaborator.</p>
<div class="admonition-exercise-ci-1-create-and-use-a-continuous-integration-workflow-on-github-or-gitlab exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise CI-1: Create and use a continuous integration workflow on GitHub or GitLab</p>
<p>In this exercise, we will:</p>
<ul class="simple">
<li><p><strong>A.</strong> Create and add code to a repository on GitHub/GitLab (or, alternatively, fork and clone an existing example repository)</p></li>
<li><p><strong>B.</strong> Set up tests with GitHub Actions/ GitLab CI</p></li>
<li><p><strong>C.</strong> Find a bug in our repository and open an issue to report it</p></li>
<li><p><strong>D.</strong> Fix the bug on a bugfix branch and open a pull request (GitHub)/ merge request (GitLab)</p></li>
<li><p><strong>E.</strong> Merge the pull/merge request and see how the issue is automatically closed.</p></li>
<li><p><strong>F.</strong> Create a test to increase the code coverage of our tests.</p></li>
</ul>
</div>
<section id="prerequisites">
<h4>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading"></a></h4>
<p>If you are new to Git, you can find a step-by-step guide to
setting up repositories and making commits in
<a class="reference external" href="https://coderefinery.github.io/git-refresher/">this git-refresher material</a>.
If you are new to pull requests / merge requests, you can learn all about them
in the <a class="reference external" href="https://coderefinery.github.io/git-collaborative/">Collaborative Git lesson</a>.</p>
</section>
<section id="step-1-create-a-new-repository-on-github-gitlab-or-fork-from-the-example-repo">
<h4>Step 1: Create a new repository on GitHub/GitLab OR fork from the example repo<a class="headerlink" href="#step-1-create-a-new-repository-on-github-gitlab-or-fork-from-the-example-repo" title="Link to this heading"></a></h4>
<section id="create-a-new-repository">
<h5>Create a new repository<a class="headerlink" href="#create-a-new-repository" title="Link to this heading"></a></h5>
<ul class="simple">
<li><p>Begin by creating a repository called (for example) <em>example-ci</em>.</p></li>
<li><p><strong>Before</strong> you create the repository, select <strong>“Initialize this repository
with a README”</strong> (otherwise you try to clone an empty repo).</p></li>
<li><p>Clone the repository (<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">git&#64;github.com:&lt;yourGitID&gt;/example-ci.git</span></code>).</p></li>
<li><p>Add the following files and code</p></li>
</ul>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-0-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-Ug==" name="Ug==" role="tab" tabindex="-1">R</button></div><div aria-labelledby="tab-0-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-0-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><p>Add a file <code class="docutils literal notranslate"><span class="pre">functions.py</span></code> containing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="k">def</span><span class="w"> </span><span class="nf">subtract</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>  <span class="c1"># &lt;--- fix this in step 7</span>

<span class="k">def</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

<span class="k">def</span><span class="w"> </span><span class="nf">convert_fahrenheit_to_celsius</span><span class="p">(</span><span class="n">fahrenheit</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">multiply</span><span class="p">(</span><span class="n">subtract</span><span class="p">(</span><span class="n">fahrenheit</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="mi">9</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span> <span class="c1"># &lt;-- Fix this in step 7</span>
</pre></div>
</div>
<p>and a file <code class="docutils literal notranslate"><span class="pre">test_functions.py</span></code> containing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">add</span><span class="p">,</span> <span class="n">subtract</span><span class="p">,</span> <span class="n">multiply</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">convert_fahrenheit_to_celsius</span> <span class="k">as</span> <span class="n">f2c</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_add</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
    <span class="k">assert</span> <span class="n">add</span><span class="p">(</span><span class="s1">&#39;space&#39;</span><span class="p">,</span> <span class="s1">&#39;ship&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;spaceship&#39;</span>

<span class="c1"># uncomment the following test in step 5</span>
<span class="c1">#def test_subtract():</span>
<span class="c1">#    assert subtract(2, 3) == -1</span>

<span class="c1"># uncomment the following test in step 11</span>
<span class="c1"># def test_convert_fahrenheit_to_celsius():</span>
<span class="c1">#    assert f2c(32) == 0</span>
<span class="c1">#    assert f2c(122) == pytest.approx(50)</span>
<span class="c1">#    with pytest.raises(AssertionError):</span>
<span class="c1">#        f2c(-600)</span>

</pre></div>
</div>
<p>Finally, stage the files (<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">&lt;filename&gt;</span></code>), commit (<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">-m</span> <span class="pre">&quot;some</span> <span class="pre">commit</span> <span class="pre">message&quot;</span></code>),
and push the changes (<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span> <span class="pre">origin</span> <span class="pre">main</span></code>).</p>
</div><div aria-labelledby="tab-0-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-Ug==" name="Ug==" role="tabpanel" tabindex="0"><ul>
<li><p>Make a folder <code class="docutils literal notranslate"><span class="pre">rtestingexample</span></code></p></li>
<li><p>In that folder create a file <code class="docutils literal notranslate"><span class="pre">DESCRIPTION</span></code> with the following contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Package</span><span class="p">:</span> <span class="n">rtestingexample</span>
<span class="n">Title</span><span class="p">:</span> <span class="n">Testing</span> <span class="n">package</span> <span class="k">for</span> <span class="n">R</span> <span class="ow">and</span> <span class="n">github</span> <span class="n">actions</span>
<span class="n">Version</span><span class="p">:</span> <span class="mf">0.0.0.9000</span>
<span class="n">Authors</span><span class="nd">@R</span><span class="p">:</span>
    <span class="n">person</span><span class="p">(</span><span class="s2">&quot;Your&quot;</span><span class="p">,</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="p">,</span> <span class="s2">&quot;none@example.com&quot;</span><span class="p">,</span> <span class="n">role</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">&quot;aut&quot;</span><span class="p">,</span> <span class="s2">&quot;cre&quot;</span><span class="p">),</span>
          <span class="p">)</span>
<span class="n">Author</span><span class="p">:</span> <span class="n">Your</span> <span class="n">Name</span>
<span class="n">Maintainer</span><span class="p">:</span> <span class="n">Your</span> <span class="n">Name</span> <span class="o">&lt;</span><span class="n">none</span><span class="nd">@example</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="n">Description</span><span class="p">:</span> <span class="n">Just</span> <span class="n">a</span> <span class="n">few</span> <span class="n">functions</span> <span class="n">that</span> <span class="n">are</span> <span class="n">being</span> <span class="n">tested</span><span class="o">.</span>
<span class="n">License</span><span class="p">:</span> <span class="n">MIT</span>
<span class="n">Encoding</span><span class="p">:</span> <span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
<span class="n">Depends</span><span class="p">:</span> <span class="n">testthat</span>
<span class="n">Roxygen</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">markdown</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>
<span class="n">RoxygenNote</span><span class="p">:</span> <span class="mf">7.2.3</span>
</pre></div>
</div>
</li>
<li><p>In that folder create a file <code class="docutils literal notranslate"><span class="pre">NAMESPACE</span></code> with the following content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Default NAMESPACE created by R</span>
<span class="c1"># Remove the previous line if you edit this file</span>

<span class="c1"># Export all names</span>
<span class="n">exportPattern</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

<span class="c1"># Import all packages listed as Imports or Depends</span>
<span class="n">import</span><span class="p">(</span>
<span class="n">testthat</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>create a subfolder <code class="docutils literal notranslate"><span class="pre">R</span></code> (this will contain all functions of the package)</p></li>
<li><p>in the <code class="docutils literal notranslate"><span class="pre">R</span></code> folder create a file <code class="docutils literal notranslate"><span class="pre">functions.R</span></code>with the following content:</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">add</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">){</span>
<span class="w">    </span><span class="kr">return</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">subtract</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">){</span>
<span class="w">    </span><span class="kr">return</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">multiply</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">){</span>
<span class="w">    </span><span class="kr">return</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">convert_fahrenheit_to_celsius</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">fahrenheit</span><span class="p">){</span>
<span class="w">    </span><span class="n">C_temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="nf">subtract</span><span class="p">(</span><span class="n">fahrenheit</span><span class="p">,</span><span class="m">32</span><span class="p">),</span><span class="m">5</span><span class="o">/</span><span class="m">9</span><span class="p">);</span>
<span class="w">    </span><span class="kr">return</span><span class="p">(</span><span class="n">C_temp</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>create a subfolder <code class="docutils literal notranslate"><span class="pre">tests</span></code></p></li>
<li><p>in <code class="docutils literal notranslate"><span class="pre">tests</span></code> create a folder <code class="docutils literal notranslate"><span class="pre">testthat</span></code> and a file <code class="docutils literal notranslate"><span class="pre">testthat.R</span></code> with the following content:</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># This file is part of the standard setup for testthat.</span>
<span class="c1"># It is recommended that you do not modify it.</span>
<span class="c1">#</span>
<span class="c1"># Where should you do additional test configuration?</span>
<span class="c1"># Learn more about the roles of various files in:</span>
<span class="c1"># * https://r-pkgs.org/tests.html</span>
<span class="c1"># * https://testthat.r-lib.org/reference/test_package.html#special-files</span>

<span class="nf">library</span><span class="p">(</span><span class="n">testthat</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">rtestingexample</span><span class="p">)</span>

<span class="nf">test_check</span><span class="p">(</span><span class="s">&quot;rtestingexample&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>in the <code class="docutils literal notranslate"><span class="pre">testthat</span></code> folder create a file <code class="docutils literal notranslate"><span class="pre">test-functions.R</span></code> with the following content:</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">test_that</span><span class="p">(</span><span class="n">desc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Add&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">);</span><span class="w">   </span><span class="c1"># Runs the function</span>

<span class="w">  </span><span class="c1"># Test that the result is the correct value</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="m">5</span><span class="p">);</span>

<span class="w">  </span><span class="c1"># Test that the result is numeric</span>
<span class="w">  </span><span class="nf">expect_true</span><span class="p">(</span><span class="nf">is.numeric</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
<span class="p">})</span>

<span class="c1"># uncomment the following test in step 11</span>
<span class="c1">#test_that(desc = &quot;Fahrenheit to Celsius&quot;, code = {</span>
<span class="c1">#</span>
<span class="c1">#  temp_C &lt;- convert_fahrenheit_to_celsius(50);</span>
<span class="c1">#  expect_equal(temp_C,10);</span>
<span class="c1">#  expect_true(is.numeric(temp_C));</span>
<span class="c1">#})</span>

<span class="c1"># uncomment the following test in step 5</span>
<span class="c1">#test_that(desc = &quot;Subtract&quot;, code = {</span>
<span class="c1">#  c &lt;- subtract(3,2);</span>
<span class="c1">#  expect_equal(c,1);</span>
<span class="c1">#  expect_true(is.numeric(c));</span>
<span class="c1">#})</span>
</pre></div>
</div>
</li>
</ul>
</div></div>
</section>
<section id="fork-and-clone-an-existing-example-repository">
<h5>Fork and clone an existing example repository<a class="headerlink" href="#fork-and-clone-an-existing-example-repository" title="Link to this heading"></a></h5>
<ul class="simple">
<li><p>Fork the example repo. There are two options one for <a class="reference external" href="https://github.com/AaltoRSE/PyTestingExample">Python</a> and one for <a class="reference external" href="https://github.com/AaltoRSE/RTestingExample">R</a>.</p></li>
<li><p>Clone your fork (<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">git&#64;github.com:&lt;yourGitID&gt;/&lt;Py/R&gt;TestingExample.git</span></code>).</p></li>
</ul>
</section>
</section>
<section id="step-2-run-tests-locally">
<h4>Step 2: Run tests locally<a class="headerlink" href="#step-2-run-tests-locally" title="Link to this heading"></a></h4>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-1-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-Ug==" name="Ug==" role="tab" tabindex="-1">R</button></div><div aria-labelledby="tab-1-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-1-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><p>You can now run your tests locally with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-Ug==" name="Ug==" role="tabpanel" tabindex="0"><p>You can now run your tests (and a complete check of this package) locally by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Rscript -e &#39;testthat::test_local()&#39;`
</pre></div>
</div>
<blockquote>
<div><p><strong><em>NOTE:</em></strong> You might need to install the testthat package before you can run the command above ( in R <code class="docutils literal notranslate"><span class="pre">install.packages(&quot;testthat&quot;)</span></code>)</p>
</div></blockquote>
</div></div>
</section>
<section id="step-3-enable-automated-testing">
<h4>Step 3: Enable automated testing<a class="headerlink" href="#step-3-enable-automated-testing" title="Link to this heading"></a></h4>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-R2l0SHViLVB5dGhvbg==" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-2-R2l0SHViLVB5dGhvbg==" name="R2l0SHViLVB5dGhvbg==" role="tab" tabindex="0">GitHub-Python</button><button aria-controls="panel-2-R2l0TGFiLVB5dGhvbg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-R2l0TGFiLVB5dGhvbg==" name="R2l0TGFiLVB5dGhvbg==" role="tab" tabindex="-1">GitLab-Python</button><button aria-controls="panel-2-R2l0SHViLVI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-R2l0SHViLVI=" name="R2l0SHViLVI=" role="tab" tabindex="-1">GitHub-R</button></div><div aria-labelledby="tab-2-R2l0SHViLVB5dGhvbg==" class="sphinx-tabs-panel group-tab" id="panel-2-R2l0SHViLVB5dGhvbg==" name="R2l0SHViLVB5dGhvbg==" role="tabpanel" tabindex="0"><p>In this step we will enable GitHub Actions.
Select “Actions” from your GitHub repository page. You get to a page
“Get started with GitHub Actions”. Select the button for “Configure”
under Python Application:</p>
<figure class="align-default" id="id1">
<img alt="Selecting a Python workflow" src="_images/python_application.png" />
<figcaption>
<p><span class="caption-text">Select “Python application” as the starter workflow.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>GitHub creates the following file for you in the subfolder <code class="docutils literal notranslate"><span class="pre">.github/workflows</span></code>.
Modify the highlighted lines according to the action below. This will add a code coverage
report to new pull requests. The if clause restricts this to pull requests, as otherwise
this action would not have a target to write the reports to. On pushes only the unittesting is run.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># This workflow will install Python dependencies, run tests and lint with a single version of Python</span>
<span class="c1"># For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-python</span>

<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;main&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;main&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>

<span class="nt">permissions</span><span class="p">:</span>
<span class="w">  </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
<span class="hll"><span class="w">  </span><span class="nt">pull-requests</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
</span>
<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span>

<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python 3.10</span>
<span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v3</span>
<span class="w">      </span><span class="nt">with</span><span class="p">:</span>
<span class="w">        </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.10&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">python -m pip install --upgrade pip</span>
<span class="hll"><span class="w">        </span><span class="no">pip install flake8 pytest pytest-cov</span>
</span><span class="w">        </span><span class="no">if [ -f requirements.txt ]; then pip install -r requirements.txt; fi</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Lint with flake8</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no"># stop the build if there are Python syntax errors or undefined names</span>
<span class="w">        </span><span class="no">flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics</span>
<span class="w">        </span><span class="no"># exit-zero treats all errors as warnings. The GitHub editor is 127 chars wide</span>
<span class="w">        </span><span class="no">flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test with pytest</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="hll"><span class="w">        </span><span class="no">pytest --cov-report &quot;xml:coverage.xml&quot; --cov=.</span>
</span><span class="hll"><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create Coverage</span>
</span><span class="hll"><span class="w">      </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ github.event_name == &#39;pull_request&#39; }}</span>
</span><span class="hll"><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">orgoro/coverage@v3</span>
</span><span class="hll"><span class="w">      </span><span class="nt">with</span><span class="p">:</span>
</span><span class="hll"><span class="w">          </span><span class="nt">coverageFile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">coverage.xml</span>
</span><span class="hll"><span class="w">          </span><span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>
</span></pre></div>
</div>
<p>Commit the change by pressing the “Start Commit” button:</p>
<figure class="align-default" id="id2">
<img alt="Committing the change" src="_images/gh_action_commit.png" />
<figcaption>
<p><span class="caption-text">Committing the file via the GitHub web interface: follow the flow, give it some commit name. You can commit directly to master.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
</div><div aria-labelledby="tab-2-R2l0TGFiLVB5dGhvbg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-R2l0TGFiLVB5dGhvbg==" name="R2l0TGFiLVB5dGhvbg==" role="tabpanel" tabindex="0"><p>In this step we will enable GitLab CI.
Select “CI/CD” from your Gitlab sidebar of the project. You get to a page
“Editor”. (Instead you can also click on “Add CI/CD” on the main page or just add a <code class="docutils literal notranslate"><span class="pre">.gitlab-ci.yml</span></code> file the result is identical.</p>
<p>Copy the following code snippet into the file. Gitlab will save it as <code class="docutils literal notranslate"><span class="pre">.gitlab-ci.yml</span></code>.
Add <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">test_functions.py</span></code> to the last line (highlighted):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># This workflow will install Python dependencies, run tests and lint with a single version of Python</span>
<span class="c1"># For more information see: https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Python.gitlab-ci.yml</span>

<span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python:latest</span>
<span class="nt">stages</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linting</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="nt">before_script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /proc/version</span><span class="w"> </span><span class="c1">#print out operations system</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python -V</span><span class="w">  </span><span class="c1"># Print out Python version for debugging</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install pytest flake8</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">if [ -f requirements.txt ]; then pip install -r requirements.txt;fi</span>

<span class="nt">linting</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linting</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics</span>

<span class="nt">test</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="hll"><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pytest</span>
</pre></div>
</div>
<p>Commit the change by pressing the “Commit changes” button:</p>
<figure class="align-default" id="id3">
<a class="reference internal image-reference" href="_images/gl_action_commit.png"><img alt="Committing the change" src="_images/gl_action_commit.png" style="width: 400px;" />
</a>
<figcaption>
<p><span class="caption-text">Committing the file via the GitLab web interface: follow the flow, give it some commit name. You can commit directly to master.</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
</div><div aria-labelledby="tab-2-R2l0SHViLVI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-R2l0SHViLVI=" name="R2l0SHViLVI=" role="tabpanel" tabindex="0"><p>In this step we will enable GitHub Actions.
Select “Actions” from your GitHub repository page. You get to a page
“Get started with GitHub Actions”. Unfortunately, as of the creation of this lecture, the default “R package action”
that is suggested by github is quite complex and not really fit for our purpose. Instead we will create our own
workflow as detailed below.
So first click on the “ set up a workflow yourself” link above the “Search workflows” field.</p>
<p>GitHub creates a “main.yml” file that we can now modify as needed.</p>
<ul>
<li><p>First, replace the name by a more descriptive one (e.g. r_testing.yml)</p></li>
<li><p>Then add the following code to the file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Workflow derived from https://github.com/r-lib/actions/tree/v2/examples</span>
<span class="c1"># Need help debugging build failures? Start at https://github.com/r-lib/actions#where-to-find-help</span>
<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">]</span>

<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-coverage</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">test-coverage</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">env</span><span class="p">:</span>
<span class="w">      </span><span class="nt">GITHUB_PAT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">R</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup R</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">r-lib/actions/setup-r@v2</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">use-public-rspm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">r-lib/actions/setup-r-dependencies@v2</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="hll"><span class="w">          </span><span class="nt">extra-packages</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span class="hll"><span class="w">            </span><span class="no">any::covr</span>
</span><span class="hll"><span class="w">            </span><span class="no">any::rcmdcheck</span>
</span><span class="hll"><span class="w">          </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span class="hll"><span class="w">            </span><span class="no">coverage</span>
</span><span class="hll"><span class="w">            </span><span class="no">check</span>
</span><span class="hll"><span class="w">          </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;rtestingexample&#39;</span>
</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test coverage</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">covr::codecov(</span>
<span class="w">            </span><span class="no">quiet = FALSE,</span>
<span class="w">            </span><span class="no">clean = FALSE,</span>
<span class="hll"><span class="w">            </span><span class="no">path = &quot;rtestingexample&quot;,</span>
</span><span class="w">            </span><span class="no">install_path = file.path(Sys.getenv(&quot;RUNNER_TEMP&quot;), &quot;package&quot;)</span>
<span class="w">          </span><span class="no">)</span>
<span class="w">        </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Rscript {0}</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Show testthat output</span>
<span class="w">        </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always()</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">## --------------------------------------------------------------------</span>
<span class="w">          </span><span class="no">find ${{ runner.temp }}/package -name &#39;testthat.Rout*&#39; -exec cat &#39;{}&#39; \; || true</span>
<span class="w">        </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bash</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Upload test results</span>
<span class="w">        </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">failure()</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/upload-artifact@v3</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">coverage-test-failures</span>
<span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ runner.temp }}/package</span>
</pre></div>
</div>
<p>The action is a modified version of the action generated by <a class="reference external" href="https://covr.r-lib.org/">covr</a> using the <code class="docutils literal notranslate"><span class="pre">usethis::use_github_action(&quot;test-coverage&quot;)</span></code> command.
It is built up from several actions provided by the <a class="reference external" href="https://github.com/r-lib/actions">r-lib project</a>, along with the test/coverage commands.</p>
</li>
</ul>
<p>Commit the change by pressing the “Start Commit” button:</p>
<figure class="align-default" id="id4">
<img alt="Committing the change" src="_images/gh_action_commit.png" />
<figcaption>
<p><span class="caption-text">Committing the file via the GitHub web interface: follow the flow, give it some commit name. You can commit directly to master.</span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
</div></div>
</section>
<section id="step-4-verify-that-tests-have-been-automatically-run">
<h4>Step 4: Verify that tests have been automatically run<a class="headerlink" href="#step-4-verify-that-tests-have-been-automatically-run" title="Link to this heading"></a></h4>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-R2l0SHViLVB5dGhvbg==" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-3-R2l0SHViLVB5dGhvbg==" name="R2l0SHViLVB5dGhvbg==" role="tab" tabindex="0">GitHub-Python</button><button aria-controls="panel-3-R2l0TGFiLVB5dGhvbg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-3-R2l0TGFiLVB5dGhvbg==" name="R2l0TGFiLVB5dGhvbg==" role="tab" tabindex="-1">GitLab-Python</button><button aria-controls="panel-3-R2l0SHViLVI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-3-R2l0SHViLVI=" name="R2l0SHViLVI=" role="tab" tabindex="-1">GitHub-R</button></div><div aria-labelledby="tab-3-R2l0SHViLVB5dGhvbg==" class="sphinx-tabs-panel group-tab" id="panel-3-R2l0SHViLVB5dGhvbg==" name="R2l0SHViLVB5dGhvbg==" role="tabpanel" tabindex="0"><p>Observe in the repository how the test succeeds. While the test is
executing, the repository has a yellow marker. This is replaced with a green
check mark, once the test succeeds:</p>
<figure class="align-default" id="id5">
<img alt="Verify that the test passed" src="_images/green_check_mark.png" />
<figcaption>
<p><span class="caption-text">Green check means passed.</span><a class="headerlink" href="#id5" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Also browse the “Actions” tab and look at the steps there and their output.</p>
</div><div aria-labelledby="tab-3-R2l0TGFiLVB5dGhvbg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-3-R2l0TGFiLVB5dGhvbg==" name="R2l0TGFiLVB5dGhvbg==" role="tabpanel" tabindex="0"><p>Observe in the repository how the test succeeds. While the test is
executing, the repository has a blue marker. This is replaced with a green
check mark, once the test succeeds:</p>
<figure class="align-default" id="id6">
<img alt="Verify that the test passed" src="_images/gl_green_check_mark.png" />
<figcaption>
<p><span class="caption-text">Green check means passed.</span><a class="headerlink" href="#id6" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Also browse the “Pipelines” tab and look at the steps there and their output.</p>
</div><div aria-labelledby="tab-3-R2l0SHViLVI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-3-R2l0SHViLVI=" name="R2l0SHViLVI=" role="tabpanel" tabindex="0"><p>Observe in the repository how the test succeeds. While the test is
executing, the repository has a yellow marker. This is replaced with a green
check mark, once the test succeeds:</p>
<figure class="align-default" id="id7">
<img alt="Verify that the test passed" src="_images/green_check_mark.png" />
<figcaption>
<p><span class="caption-text">Green check means passed.</span><a class="headerlink" href="#id7" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Also browse the “Actions” tab and look at the steps there and their output.</p>
</div></div>
</section>
<section id="step-5-add-a-test-which-reveals-a-problem">
<h4>Step 5: Add a test which reveals a problem<a class="headerlink" href="#step-5-add-a-test-which-reveals-a-problem" title="Link to this heading"></a></h4>
<p>After you committed the workflow file, your GitHub/GitLab repository will be ahead of
your local cloned repository.  Update your local cloned repository:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git<span class="w"> </span>pull<span class="w"> </span>origin<span class="w"> </span>main
</pre></div>
</div>
<p>Hint: if the above command fails, check whether the branch name on the GitHub/GitLab
repository is called <code class="docutils literal notranslate"><span class="pre">main</span></code> and not perhaps <code class="docutils literal notranslate"><span class="pre">master</span></code>.</p>
<p>Next uncomment the code in <code class="docutils literal notranslate"><span class="pre">test_functions.py</span></code> under “step 5”, commit, and push.
Verify that the test suite now fails on the “Actions” tab (GitHub)
or the “CI/CD-&gt;Pipelines” tab (GitLab).</p>
</section>
<section id="step-6-open-an-issue-on-github-gitlab">
<h4>Step 6: Open an issue on GitHub/GitLab<a class="headerlink" href="#step-6-open-an-issue-on-github-gitlab" title="Link to this heading"></a></h4>
<p>Open a new issue in your repository about the broken test (click the
“Issues” button on GitHub or GitLab and write a title for the issue).
The plan is that we will fix the issue through a pull/merge request.</p>
</section>
<section id="step-7-fix-the-broken-test">
<h4>Step 7: Fix the broken test<a class="headerlink" href="#step-7-fix-the-broken-test" title="Link to this heading"></a></h4>
<p>Now fix the code <strong>on a new branch</strong>, you can call it <code class="docutils literal notranslate"><span class="pre">yourname/bugfix</span></code>.
After you have fixed the code on the new branch, commit the following
commit message <code class="docutils literal notranslate"><span class="pre">&quot;restore</span> <span class="pre">function</span> <span class="pre">subtract;</span> <span class="pre">fixes</span> <span class="pre">#1&quot;</span></code> (assuming that
you try to fix issue number 1).</p>
<div class="admonition-shortcut callout admonition" id="callout-0">
<p class="admonition-title">Shortcut</p>
<p>Here it’s perfectly possible to take a shortcut and commit and push
directly to the main branch. If you do this, steps 8-9 below are skipped.</p>
<ul class="simple">
<li><p>When would you push directly to the main branch, and when would you send a
pull/merge request?</p></li>
</ul>
</div>
<p>Then push to your repository.</p>
</section>
<section id="step-8-open-a-pull-request-github-merge-request-gitlab">
<h4>Step 8: Open a pull request (GitHub)/ merge request (GitLab)<a class="headerlink" href="#step-8-open-a-pull-request-github-merge-request-gitlab" title="Link to this heading"></a></h4>
<p>Go back to the repository on GitHub or GitLab and open a pull/merge
request. <strong>In a collaborative setting, you could request a code
review from collaborators at this stage.</strong> Before accepting the
pull/merge request, observe how GitHub Actions/ Gitlab CI
automatically tested the code.</p>
<p>If you forgot to reference the issue number in the commit message, you
can still add it to the pull/merge request: <code class="docutils literal notranslate"><span class="pre">my</span> <span class="pre">pull/merge</span> <span class="pre">request</span> <span class="pre">title,</span> <span class="pre">closes</span> <span class="pre">#1</span></code>.</p>
</section>
<section id="step-9-accept-the-pull-merge-request">
<h4>Step 9: Accept the pull/merge request<a class="headerlink" href="#step-9-accept-the-pull-merge-request" title="Link to this heading"></a></h4>
<p>Observe how accepting the pull/merge request automatically closes the issue (provided
the commit message or the pull/merge request contained the correct issue number).</p>
<p>See also:</p>
<ul class="simple">
<li><p>GitHub: <a class="reference external" href="https://help.github.com/articles/closing-issues-using-keywords/">closing issues using keywords</a></p></li>
<li><p>GitLab: <a class="reference external" href="https://docs.gitlab.com/user/project/issues/managing_issues/#closing-issues-automatically">closing issues using keywords</a></p></li>
</ul>
<p>Discuss whether this is a useful feature. And if it is, why do you think is it useful?</p>
</section>
<section id="step-10-increase-your-code-coverage">
<h4>Step 10: Increase your code coverage<a class="headerlink" href="#step-10-increase-your-code-coverage" title="Link to this heading"></a></h4>
<p>We are currently missing several functions in our tests. Write a test for the <code class="docutils literal notranslate"><span class="pre">multiply</span></code> function in a new branch and create a pull request.
On Python you can directly observe the increase in code coverage.
On R you can have a look at the action (<code class="docutils literal notranslate"><span class="pre">Actions</span> <span class="pre">-&gt;</span> <span class="pre">last</span> <span class="pre">run</span> <span class="pre">of</span> <span class="pre">your</span> <span class="pre">action</span> <span class="pre">-&gt;</span> <span class="pre">Select</span> <span class="pre">a</span> <span class="pre">job</span> <span class="pre">-&gt;</span> <span class="pre">Test</span> <span class="pre">coverage</span></code>). If you compare this with the
previous run, you should see an increase once the update is in.</p>
</section>
<section id="step-11-optional-repeat-steps-5-9-for-the-convert-fahrenheit-to-celsius-function">
<h4>Step 11 (optional): Repeat steps 5-9 for the <code class="docutils literal notranslate"><span class="pre">convert_fahrenheit_to_celsius</span></code> function:<a class="headerlink" href="#step-11-optional-repeat-steps-5-9-for-the-convert-fahrenheit-to-celsius-function" title="Link to this heading"></a></h4>
<p>Repetition helps learning, so let’s do the testing again for our <code class="docutils literal notranslate"><span class="pre">convert_fahrenheit_to_celsius</span></code> function.
Uncomment the test for the <code class="docutils literal notranslate"><span class="pre">convert_fahrenheit_to_celsius</span></code> function and repeat steps 5 to 9 fixing the bug this test exposes.</p>
</section>
<section id="discussion">
<h4>Discussion<a class="headerlink" href="#discussion" title="Link to this heading"></a></h4>
<p>Finally, we discuss together about our experiences with this exercise.</p>
</section>
</section>
<hr class="docutils" />
<section id="where-to-go-from-here">
<h3>Where to go from here<a class="headerlink" href="#where-to-go-from-here" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>This example was using Python but you can achieve the same automation for R or Fortran or C/C++ or other languages</p></li>
<li><p>This workflow is very useful for collaborators who work on the same code and it works both for
<a class="reference external" href="https://coderefinery.github.io/git-collaborative/02-centralized/">centralized</a> and
<a class="reference external" href="https://coderefinery.github.io/git-collaborative/03-distributed/">forking</a> workflows - have a look at this
<a class="reference internal" href="#document-full-cycle-ci"><span class="doc std std-doc">alternative exercise</span></a> to see how that works.</p></li>
<li><p>GitHub Actions has a <a class="reference external" href="https://github.com/marketplace?type=actions">Marketplace</a> which offer wide range of automatic workflows</p></li>
<li><p>On GitLab use <a class="reference external" href="https://about.gitlab.com/product/continuous-integration/">GitLab CI</a></p></li>
<li><p>For Windows builds you can also use <a class="reference external" href="https://www.appveyor.com">Appveyor</a></p></li>
</ul>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>When fixing bugs or other problems reported in issues, use the issue
autoclosing mechanism when you send the pull/merge request.</p></li>
</ul>
</div>
</section>
</section>
<span id="document-test-design"></span><section id="test-design">
<h2>Test design<a class="headerlink" href="#test-design" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>How can different types of functions and classes be tested?</p></li>
<li><p>How can the integrity of a complete program be monitored over time?</p></li>
<li><p>How can functions that involve random numbers be tested?</p></li>
</ul>
</div>
<p>In this episode we will consider how functions and programs can be tested in programs developed in different programming languages.</p>
<div class="admonition-exercise-instructions discussion important admonition" id="discussion-0">
<p class="admonition-title">Exercise instructions</p>
<p><strong>For the instructor</strong></p>
<ul class="simple">
<li><p>First motivate and give a quick tour of all exercises below (10 minutes).</p></li>
<li><p>Emphasize that the focus of this episode is <em>design</em>. It is OK to only discuss in groups and not write code.</p></li>
</ul>
<p><strong>During exercise session</strong></p>
<ul class="simple">
<li><p>Choose the exercise which interests you most. There are many more exercises than we would have time for.</p></li>
<li><p>Discuss what testing framework can be used to implement the test.</p></li>
<li><p>Keep notes, questions, and answers in the collaborative document.</p></li>
</ul>
<p><strong>Once we return to stream</strong></p>
<ul class="simple">
<li><p>Discussion about experiences learned.</p></li>
</ul>
</div>
<div class="admonition-language-specific-instructions callout admonition" id="callout-0">
<p class="admonition-title">Language-specific instructions</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-0-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button><button aria-controls="panel-0-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-0-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button><button aria-controls="panel-0-Rm9ydHJhbg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tab" tabindex="-1">Fortran</button></div><div aria-labelledby="tab-0-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-0-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><p>The suggested solutions below use pytest. Further information can
be found in the <a class="reference internal" href="index.html#pytest-ref"><span class="std std-ref">Quick Reference</span></a>.</p>
</div><div aria-labelledby="tab-0-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-Qysr" name="Qysr" role="tabpanel" tabindex="0"><p>The suggested solutions below use Catch2. Further information can
be found in the <a class="reference internal" href="index.html#catch2"><span class="std std-ref">Quick Reference</span></a>.</p>
</div><div aria-labelledby="tab-0-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-Ug==" name="Ug==" role="tabpanel" tabindex="0"><p>The suggested solutions below use testthat. Further information can
be found in the <a class="reference internal" href="index.html#testthat"><span class="std std-ref">Quick Reference</span></a>.</p>
</div><div aria-labelledby="tab-0-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><p>The suggested solutions below use Test. Further information can
be found in the <a class="reference internal" href="index.html#test"><span class="std std-ref">Quick Reference</span></a>.</p>
</div><div aria-labelledby="tab-0-Rm9ydHJhbg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tabpanel" tabindex="0"><p>The suggested solutions below use pFUnit. Further information on how to install
pFUnit and set up tests can
be found in the <a class="reference internal" href="index.html#pfunit"><span class="std std-ref">Quick Reference</span></a>.</p>
</div></div>
</div>
<section id="pure-and-impure-functions">
<h3>Pure and impure functions<a class="headerlink" href="#pure-and-impure-functions" title="Link to this heading"></a></h3>
<p>Start by discussing how you would design tests for the
following five functions, and then try to write the tests.
Also discuss why some are easier to test than others.</p>
<div class="admonition-design-1-design-a-test-for-a-function-that-receives-a-number-and-returns-a-number exercise important admonition" id="exercise-0">
<p class="admonition-title">Design-1: Design a test for a function that receives a number and returns a number</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-1-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button><button aria-controls="panel-1-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-1-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button><button aria-controls="panel-1-Rm9ydHJhbg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tab" tabindex="-1">Fortran</button></div><div aria-labelledby="tab-1-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-1-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the factorial of n.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;received negative input&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">*=</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Computes the factorial of n recursively. */</span>
<span class="k">constexpr</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">factorial</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-Ug==" name="Ug==" role="tabpanel" tabindex="0"><div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1">#&#39; Computes the factorial of n</span>
<span class="c1">#&#39;</span>
<span class="c1">#&#39; @param n The number to compute the factorial of.</span>
<span class="c1">#&#39; @return The factorial of n</span>
<span class="n">factorial</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
<span class="w">    </span><span class="nf">stop</span><span class="p">(</span><span class="s">&#39;received negative input&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
<span class="w">    </span><span class="kr">return</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>

<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span>
<span class="w">  </span><span class="kr">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">)</span>
<span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span>
<span class="w">  </span><span class="n">result</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    factorial(n::Int)</span>

<span class="s">Compute the factorial of n.</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="k">function</span><span class="w"> </span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="o">::</span><span class="kt">Int</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="n">throw</span><span class="p">(</span><span class="kt">DomainError</span><span class="p">(</span><span class="s">&quot;n must be non-negative&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">n</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">i</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span>
<span class="k">end</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-Rm9ydHJhbg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tabpanel" tabindex="0"><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">module </span><span class="n">factorial_mod</span>
<span class="k">contains</span>
<span class="w">   </span><span class="c">! computes the factorial of n</span>
<span class="w">   </span><span class="kt">integer </span><span class="k">function </span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="w">      </span><span class="k">implicit none</span>
<span class="k">      </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">n</span>
<span class="w">      </span><span class="kt">integer </span><span class="n">r</span>
<span class="w">      </span><span class="kt">integer </span><span class="n">i</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;Received negative input&#39;</span>
<span class="w">         </span><span class="k">stop</span>
<span class="k">      end if</span>
<span class="k">      </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">      </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">n</span>
<span class="w">         </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="o">*</span><span class="n">i</span>
<span class="w">      </span><span class="k">end do</span>
<span class="k">      </span><span class="n">factorial</span><span class="o">=</span><span class="n">r</span>
<span class="w">   </span><span class="k">end function </span><span class="n">factorial</span>
<span class="k">end module </span><span class="n">factorial_mod</span>
</pre></div>
</div>
</div><p>Discussion point: The factorial grows very rapidly. What happens if you
pass a large number as argument to the function?</p>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<p>This is a <strong>pure function</strong> so is easy to test: inputs go to
outputs.  For example, start with the below, then think of some
what extreme cases/boundary cases there might be.  This example shows
all of the tests as one function, but you might want to make each test
function more fine-grained and test only one concept.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-2-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-2-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button><button aria-controls="panel-2-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-2-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button><button aria-controls="panel-2-Rm9ydHJhbg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tab" tabindex="-1">Fortran</button></div><div aria-labelledby="tab-2-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-2-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_factorial</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">factorial</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="n">factorial</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="n">factorial</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
       
</pre></div>
</div>
</div><div aria-labelledby="tab-2-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;catch2/catch.hpp&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;factorial.hpp&quot;</span>

<span class="n">TEST_CASE</span><span class="p">(</span><span class="s">&quot;Compute the factorial&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[factorial]&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-2-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-Ug==" name="Ug==" role="tabpanel" tabindex="0"><div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">test_that</span><span class="p">(</span><span class="s">&quot;Test factorial&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">factorial</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">factorial</span><span class="p">(</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">factorial</span><span class="p">(</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">factorial</span><span class="p">(</span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="m">6</span><span class="p">)</span>
<span class="w">  </span><span class="c1"># also try negatives (check that it raises an error), non-integers, etc.</span>

<span class="w">  </span><span class="c1"># Raise an error if factorial does *not* raise an error:</span>
<span class="w">  </span><span class="nf">expect_error</span><span class="p">(</span><span class="nf">factorial</span><span class="p">(</span><span class="m">-1</span><span class="p">))</span>
<span class="p">})</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-2-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@testset</span><span class="w"> </span><span class="s">&quot;Test factorial function&quot;</span><span class="w"> </span><span class="k">begin</span>
<span class="w">    </span><span class="nd">@test_throws</span><span class="w"> </span><span class="kt">DomainError</span><span class="w"> </span><span class="n">factorial</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">factorial</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">6</span>
<span class="k">end</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-2-Rm9ydHJhbg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tabpanel" tabindex="0"><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@test</span>
<span class="n">subroutine</span> <span class="n">test_factorial</span><span class="p">()</span>
   <span class="n">use</span> <span class="n">factorial_mod</span>
   <span class="n">use</span> <span class="n">funit</span>
   <span class="nd">@assertEqual</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="n">factorial</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="s1">&#39;factorial(5)&#39;</span><span class="p">)</span>
<span class="n">end</span> <span class="n">subroutine</span> <span class="n">test_factorial</span>
</pre></div>
</div>
</div></div>
<p>Notes on the discussion point: Programming languages differ in the way they deal with integer
overflow. Python automatically converts to the necessary <code class="docutils literal notranslate"><span class="pre">long</span></code> type, in Julia you would
observe a “wrap-around”, in C/C++ you get undefined behaviour for signed integers.
Testing for overflow likewise depends on the language.</p>
</div>
</div>
<div class="admonition-design-2-design-a-test-for-a-function-that-receives-two-strings-and-returns-a-number exercise important admonition" id="exercise-1">
<p class="admonition-title">Design-2: Design a test for a function that receives two strings and returns a number</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-3-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-3-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-3-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button><button aria-controls="panel-3-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-3-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-3-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-3-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button><button aria-controls="panel-3-Rm9ydHJhbg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-3-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tab" tabindex="-1">Fortran</button></div><div aria-labelledby="tab-3-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-3-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">count_word_occurrence_in_string</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Counts how often word appears in text.</span>
<span class="sd">    Example: if text is &quot;one two one two three four&quot;</span>
<span class="sd">             and word is &quot;one&quot;, then this function returns 2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">words</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-3-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-3-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>

<span class="cm">/* Counts how often word appears in text.</span>
<span class="cm"> * Example: if text is &quot;one two one two three four&quot;</span>
<span class="cm"> *          and word is &quot;one&quot;, then this function returns 2</span>
<span class="cm"> */</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">count_word_occurrence_in_string</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">word_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">word</span><span class="p">[</span><span class="n">word_count</span><span class="p">])</span><span class="w"> </span><span class="o">++</span><span class="n">word_count</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="n">word_count</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">word_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="o">++</span><span class="n">count</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-3-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-3-Ug==" name="Ug==" role="tabpanel" tabindex="0"><div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1">#&#39; Counts how often a given word appears in text</span>
<span class="c1">#&#39;</span>
<span class="c1">#&#39; @param text The text to search in.</span>
<span class="c1">#&#39; @param word The word to search for.</span>
<span class="c1">#&#39; @return The number of times the word occurs in the text.</span>
<span class="n">count_word_occurrence_in_string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">words</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">strsplit</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="s">&#39; &#39;</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span>
<span class="w">  </span><span class="nf">sum</span><span class="p">(</span><span class="n">words</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">word</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-3-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-3-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    count_word_occurrence_in_string(text::String, word::String)</span>

<span class="s">Count how often word appears in text.</span>
<span class="s">Example: if `text` is &quot;one two one two three four&quot;</span>
<span class="s">and `word` is &quot;one&quot;, then this function returns 2</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="k">function</span><span class="w"> </span><span class="n">count_word_occurrence_in_string</span><span class="p">(</span><span class="n">text</span><span class="o">::</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="o">::</span><span class="kt">String</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="p">)</span>

<span class="k">end</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-3-Rm9ydHJhbg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-3-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tabpanel" tabindex="0"><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! missing - please submit an example</span>
</pre></div>
</div>
</div></div>
<div class="admonition-solution solution important dropdown admonition" id="solution-1">
<p class="admonition-title">Solution</p>
<p>This is again a <strong>pure function</strong> but uses strings.  Use a similar strategy
to the above.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-4-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-4-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button><button aria-controls="panel-4-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-4-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button><button aria-controls="panel-4-Rm9ydHJhbg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tab" tabindex="-1">Fortran</button></div><div aria-labelledby="tab-4-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-4-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_count_word_occurrence_in_string</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">count_word_occurrence_in_string</span><span class="p">(</span><span class="s1">&#39;AAA BBB&#39;</span><span class="p">,</span> <span class="s1">&#39;AAA&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="n">count_word_occurrence_in_string</span><span class="p">(</span><span class="s1">&#39;AAA AAA&#39;</span><span class="p">,</span> <span class="s1">&#39;AAA&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="c1"># What does this last test tell us?</span>
    <span class="k">assert</span> <span class="n">count_word_occurrence_in_string</span><span class="p">(</span><span class="s1">&#39;AAAAA&#39;</span><span class="p">,</span> <span class="s1">&#39;AAA&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-4-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;catch2/catch.hpp&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;word_count.hpp&quot;</span>

<span class="n">TEST_CASE</span><span class="p">(</span><span class="s">&quot;Count occurrences of substring in string&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[count_word_occurrence_in_string]&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">count_word_occurrence_in_string</span><span class="p">(</span><span class="s">&quot;AAA BBB&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;AAA&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">count_word_occurrence_in_string</span><span class="p">(</span><span class="s">&quot;AAA AAA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;AAA&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">count_word_occurrence_in_string</span><span class="p">(</span><span class="s">&quot;AAAA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;AAA&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-4-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-Ug==" name="Ug==" role="tabpanel" tabindex="0"><div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">test_that</span><span class="p">(</span><span class="s">&quot;Test count word occurrence in string&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">count_word_occurrence_in_string</span><span class="p">(</span><span class="s">&quot;AAA BBB&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;AAA&quot;</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">count_word_occurrence_in_string</span><span class="p">(</span><span class="s">&quot;AAA AAA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;AAA&quot;</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">count_word_occurrence_in_string</span><span class="p">(</span><span class="s">&quot;AAAAA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;AAA&quot;</span><span class="p">),</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-4-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@testset</span><span class="w"> </span><span class="s">&quot;Test count word occurrence in string&quot;</span><span class="w"> </span><span class="k">begin</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">count_word_occurrence_in_string</span><span class="p">(</span><span class="s">&quot;AAA BBB&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;AAA&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">count_word_occurrence_in_string</span><span class="p">(</span><span class="s">&quot;AAA AAA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;AAA&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">count_word_occurrence_in_string</span><span class="p">(</span><span class="s">&quot;AAAAA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;AAA&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span>
<span class="k">end</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-4-Rm9ydHJhbg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tabpanel" tabindex="0"><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! missing - please submit an example</span>
</pre></div>
</div>
</div></div>
</div>
</div>
<div class="admonition-design-3-design-a-test-for-a-function-which-reads-a-file-and-returns-a-number exercise important admonition" id="exercise-2">
<p class="admonition-title">Design-3: Design a test for a function which reads a file and returns a number</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-5-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-5-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-5-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-5-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button><button aria-controls="panel-5-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-5-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-5-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-5-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button><button aria-controls="panel-5-Rm9ydHJhbg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-5-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tab" tabindex="-1">Fortran</button></div><div aria-labelledby="tab-5-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-5-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">count_word_occurrence_in_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Counts how often word appears in file file_name.</span>
<span class="sd">    Example: if file contains &quot;one two one two three four&quot;</span>
<span class="sd">             and word is &quot;one&quot;, then this function returns 2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="n">words</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">count</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-5-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-5-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;streambuf&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>

<span class="cm">/* Counts how often word appears in file fname.</span>
<span class="cm"> * Example: if file contains &quot;one two one two three four&quot;</span>
<span class="cm"> *          and word is &quot;one&quot;, then this function returns 2</span>
<span class="cm"> */</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">count_word_occurrence_in_file</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">fname</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">ifstream</span><span class="w"> </span><span class="n">fh</span><span class="p">(</span><span class="n">fname</span><span class="p">);</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">text</span><span class="p">((</span><span class="n">std</span><span class="o">::</span><span class="n">istreambuf_iterator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="n">fh</span><span class="p">)),</span>
<span class="w">		   </span><span class="n">std</span><span class="o">::</span><span class="n">istreambuf_iterator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">());</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">word_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0l</span><span class="n">u</span><span class="p">;</span><span class="w"> </span><span class="c1">// will be used for indexing and therefore it has to be *long unsigned* int for the safe conversion to &#39;std::__cxx11::basic_string&lt;char&gt;::size_type&#39;.</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">word</span><span class="p">[</span><span class="n">word_count</span><span class="p">])</span><span class="w"> </span><span class="o">++</span><span class="n">word_count</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="n">word_count</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">word_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="o">++</span><span class="n">count</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-5-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-5-Ug==" name="Ug==" role="tabpanel" tabindex="0"><div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1">#&#39; Counts how often a given word appears in a file.</span>
<span class="c1">#&#39;</span>
<span class="c1">#&#39; @param file_name The name of the file to search in.</span>
<span class="c1">#&#39; @param word The word to search for in the file.</span>
<span class="c1">#&#39; @return The number of times the word appeared in the file.</span>
<span class="n">count_word_occurrence_in_file</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">count</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span>
<span class="w">  </span><span class="kr">for</span><span class="w"> </span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nf">readLines</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">words</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">strsplit</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="w"> </span><span class="s">&#39; &#39;</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span>
<span class="w">    </span><span class="n">count</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">words</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">word</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">count</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-5-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-5-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    count_word_occurrence_in_file(file_name::String, word::String)</span>

<span class="s">Counts how often word appears in file file_name.</span>
<span class="s">Example: if file contains &quot;one two one two three four&quot;</span>
<span class="s">         And word is &quot;one&quot;, then this function returns 2</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="k">function</span><span class="w"> </span><span class="n">count_word_occurrence_in_file</span><span class="p">(</span><span class="n">file_name</span><span class="o">::</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="o">::</span><span class="kt">String</span><span class="p">)</span>
<span class="w">    </span><span class="n">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">file</span>
<span class="w">        </span><span class="n">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">readlines</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-5-Rm9ydHJhbg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-5-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tabpanel" tabindex="0"><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! missing - please submit an example</span>
</pre></div>
</div>
</div></div>
<div class="admonition-solution solution important dropdown admonition" id="solution-2">
<p class="admonition-title">Solution</p>
<p>In this example we test a function which is not pure, because the output
depends on the value of a file. We can generate a temporary file for testing
and remove it afterwards.  Even better could be to split file reading from the
calculation, so that testing the calculation part becomes easy (see above).</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-6-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-6-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-6-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-6-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button><button aria-controls="panel-6-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-6-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-6-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-6-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button><button aria-controls="panel-6-Rm9ydHJhbg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-6-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tab" tabindex="-1">Fortran</button></div><div aria-labelledby="tab-6-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-6-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_count_word_occurrence_in_file</span><span class="p">():</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">temporary_file_name</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temporary_file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;one two one two three four&quot;</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">count_word_occurrence_in_file</span><span class="p">(</span><span class="n">temporary_file_name</span><span class="p">,</span> <span class="s2">&quot;one&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">temporary_file_name</span><span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-6-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-6-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;filesystem&gt;</span><span class="c1"> // for temp_directory_path(), requires C++17.</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;catch2/catch.hpp&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;word_count.hpp&quot;</span>

<span class="n">TEST_CASE</span><span class="p">(</span><span class="s">&quot;Count occurrences of substring in file&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[count_word_occurrence_in_file]&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">namespace</span><span class="w"> </span><span class="nn">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">std</span><span class="o">::</span><span class="nn">filesystem</span><span class="p">;</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">tmp_dir</span><span class="p">{</span><span class="w"> </span><span class="n">fs</span><span class="o">::</span><span class="n">temp_directory_path</span><span class="p">()</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">fpath</span><span class="p">{</span><span class="w"> </span><span class="n">fs</span><span class="o">::</span><span class="n">temp_directory_path</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s">&quot;temp_file&quot;</span><span class="w"> </span><span class="p">};</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">ofstream</span><span class="w"> </span><span class="nf">s</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">out</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">trunc</span><span class="p">);</span>
<span class="w">  </span><span class="n">s</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;one two one two three four&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">  </span><span class="n">s</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>

<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">count_word_occurrence_in_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;one&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">count_word_occurrence_in_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;three&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">count_word_occurrence_in_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;six&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="w">  </span><span class="n">fs</span><span class="o">::</span><span class="n">remove</span><span class="p">(</span><span class="w"> </span><span class="n">fpath</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-6-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-6-Ug==" name="Ug==" role="tabpanel" tabindex="0"><div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">test_that</span><span class="p">(</span><span class="s">&quot;Test count word occurrence in file&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">fname</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tempfile</span><span class="p">()</span>
<span class="w">  </span><span class="nf">write</span><span class="p">(</span><span class="s">&quot;one two one two three four&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fname</span><span class="p">)</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">count_word_occurrence_in_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;one&quot;</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">count_word_occurrence_in_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;three&quot;</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">count_word_occurrence_in_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;six&quot;</span><span class="p">),</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
<span class="w">  </span><span class="nf">unlink</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-6-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-6-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@testset</span><span class="w"> </span><span class="s">&quot;Test count word occurrence in file&quot;</span><span class="w"> </span><span class="k">begin</span>
<span class="w">    </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;one two one two three four&quot;</span>
<span class="w">    </span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="w"> </span><span class="n">testio</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mktemp</span><span class="p">()</span>
<span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">testio</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span>
<span class="w">    </span><span class="n">close</span><span class="p">(</span><span class="n">testio</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">count_word_occurrence_in_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;one&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">count_word_occurrence_in_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;three&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">count_word_occurrence_in_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;six&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
<span class="k">end</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-6-Rm9ydHJhbg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-6-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tabpanel" tabindex="0"><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! missing - please submit an example</span>
</pre></div>
</div>
</div></div>
</div>
</div>
<div class="admonition-design-4-design-a-test-for-a-function-with-an-external-dependency exercise important admonition" id="exercise-3">
<p class="admonition-title">Design-4: Design a test for a function with an external dependency</p>
<p>This one is not easy to test because the function has an external dependency.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-7-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-7-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-7-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-7-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button><button aria-controls="panel-7-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-7-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-7-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-7-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button><button aria-controls="panel-7-Rm9ydHJhbg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-7-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tab" tabindex="-1">Fortran</button></div><div aria-labelledby="tab-7-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-7-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">check_reactor_temperature</span><span class="p">(</span><span class="n">temperature_celsius</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks whether temperature is above max_temperature</span>
<span class="sd">    and returns a status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">reactor</span><span class="w"> </span><span class="kn">import</span> <span class="n">max_temperature</span>
    <span class="k">if</span> <span class="n">temperature_celsius</span> <span class="o">&gt;</span> <span class="n">max_temperature</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-7-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-7-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;constants.hpp&quot;</span>
<span class="cm">/* ^--- Defines the max_temperature constant as:</span>
<span class="cm">* namespace constants {</span>
<span class="cm">* constexpr double max_temperature = 100.0;</span>
<span class="cm">* }</span>
<span class="cm">*/</span>

<span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ReactorState</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">FINE</span><span class="p">,</span><span class="w"> </span><span class="n">CRITICAL</span><span class="w"> </span><span class="p">};</span>

<span class="cm">/* Checks whether temperature is above max_temperature and returns a status. */</span>
<span class="n">ReactorState</span><span class="w"> </span><span class="nf">check_reactor_temperature</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">temperature_celsius</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">temperature_celsius</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">constants</span><span class="o">::</span><span class="n">max_temperature</span>
<span class="w">	     </span><span class="o">?</span><span class="w"> </span><span class="n">ReactorState</span><span class="o">::</span><span class="n">CRITICAL</span>
<span class="w">	     </span><span class="o">:</span><span class="w"> </span><span class="n">ReactorState</span><span class="o">::</span><span class="n">FINE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-7-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-7-Ug==" name="Ug==" role="tabpanel" tabindex="0"><div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># reactor &lt;- namespace::makeNamespace(&quot;reactor&quot;)</span>
<span class="c1"># assign(&quot;max_temperature&quot;, 100, env = reactor)</span>
<span class="c1"># namespaceExport(reactor, &quot;max_temperature&quot;)</span>

<span class="c1">#&#39; Checks whether the temperature is above max_temperature</span>
<span class="c1">#&#39; and returns the status.</span>
<span class="c1">#&#39;</span>
<span class="c1">#&#39; @param temperature_celsius The temperature of the core</span>
<span class="c1">#&#39; @return 1 if the temperature is in range, otherwise 0</span>
<span class="n">check_reactor_temperature</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">temperature_celsius</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="n">temperature_celsius</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">reactor</span><span class="o">::</span><span class="n">max_temperature</span><span class="p">)</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span>
<span class="w">  </span><span class="kr">else</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span>
<span class="w">  </span><span class="n">status</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-7-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-7-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Importing modules inside functions is not allowed in Julia and must be done at top-level</span>
<span class="k">using</span><span class="w"> </span><span class="n">reactor</span><span class="o">:</span><span class="w"> </span><span class="n">max_temperature</span>

<span class="s">&quot;&quot;&quot;</span>
<span class="s">    check_reactor_temperature(temperature_celsius)</span>

<span class="s">Checks whether temperature is above max_temperature</span>
<span class="s">and returns a status.</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="k">function</span><span class="w"> </span><span class="n">check_reactor_temperature</span><span class="p">(</span><span class="n">temperature_celsius</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">temperature_celsius</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">max_temperature</span>
<span class="w">        </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-7-Rm9ydHJhbg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-7-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tabpanel" tabindex="0"><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! missing - please submit an example</span>
</pre></div>
</div>
</div></div>
<div class="admonition-solution solution important dropdown admonition" id="solution-3">
<p class="admonition-title">Solution</p>
<p>This function depends on the value of
<code class="docutils literal notranslate"><span class="pre">reactor.max_temperature</span></code> so the function is not pure, so testing gets
harder. You could use monkey patching to override the value of
<code class="docutils literal notranslate"><span class="pre">max_temperature</span></code>, and test it with different values.  <a class="reference external" href="https://en.wikipedia.org/wiki/Monkey_patch">Monkey
patching</a> is the concept
of artificially changing some other value.</p>
<p>A better solution would probably be to rewrite the function.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-8-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-8-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-8-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-8-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button><button aria-controls="panel-8-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-8-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-8-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-8-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button><button aria-controls="panel-8-Rm9ydHJhbg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-8-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tab" tabindex="-1">Fortran</button></div><div aria-labelledby="tab-8-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-8-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_set_temp</span><span class="p">(</span><span class="n">monkeypatch</span><span class="p">):</span>
    <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">reactor</span><span class="p">,</span> <span class="s2">&quot;max_temperature&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">check_reactor_temperature</span><span class="p">(</span><span class="mi">99</span><span class="p">)</span>  <span class="o">==</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">check_reactor_temperature</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>   <span class="c1"># boundary cases easily go wrong</span>
    <span class="k">assert</span> <span class="n">check_reactor_temperature</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-8-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-8-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Changing variables included from headers (monkey patching) is not possible in C++.</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;catch2/catch.hpp&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;reactor.hpp&quot;</span>

<span class="n">TEST_CASE</span><span class="p">(</span><span class="s">&quot;Check reactor state&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[reactor_state]&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">check_reactor_temperature</span><span class="p">(</span><span class="mi">99</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ReactorState</span><span class="o">::</span><span class="n">FINE</span><span class="p">);</span>
<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">check_reactor_temperature</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ReactorState</span><span class="o">::</span><span class="n">FINE</span><span class="p">);</span>
<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">check_reactor_temperature</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ReactorState</span><span class="o">::</span><span class="n">CRITICAL</span><span class="p">);</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-8-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-8-Ug==" name="Ug==" role="tabpanel" tabindex="0"><div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># Changing variables imported from modules (monkey patching) is not possible in R.</span>
<span class="c1"># To be able to test this function properly it needs to be made pure:</span>
<span class="n">check_reactor_temperature</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">max_temperature</span><span class="p">,</span><span class="w"> </span><span class="n">temperature_celsius</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="n">temperature_celsius</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">max_temperature</span><span class="p">)</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span>
<span class="w">  </span><span class="kr">else</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span>
<span class="w">  </span><span class="n">status</span>
<span class="p">}</span>
<span class="nf">test_that</span><span class="p">(</span><span class="s">&quot;Test reactor temperature&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">check_reactor_temperature</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">99</span><span class="p">),</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">check_reactor_temperature</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">),</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">  </span><span class="c1"># boundary cases easily go wrong</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">check_reactor_temperature</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">101</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-8-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-8-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Changing variables imported from modules (monkey patching) is not possible in Julia.</span>
<span class="c"># To be able to test this function properly it needs to be made pure:</span>

<span class="k">function</span><span class="w"> </span><span class="n">check_reactor_temperature</span><span class="p">(</span><span class="n">temperature_celsius</span><span class="p">,</span><span class="w"> </span><span class="n">max_temperature</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">temperature_celsius</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">max_temperature</span>
<span class="w">        </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>

<span class="c"># normal invocation:</span>
<span class="k">using</span><span class="w"> </span><span class="n">reactor</span><span class="o">:</span><span class="w"> </span><span class="n">max_temperature</span>
<span class="n">check_reactor_temperature</span><span class="p">(</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="n">max_temperature</span><span class="p">)</span>

<span class="c"># tests</span>
<span class="nd">@testset</span><span class="w"> </span><span class="s">&quot;Test check_reactor_temperature function&quot;</span><span class="w"> </span><span class="k">begin</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">check_reactor_temperature</span><span class="p">(</span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">check_reactor_temperature</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w">   </span><span class="c"># boundary cases easily go wrong</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">check_reactor_temperature</span><span class="p">(</span><span class="mi">101</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span>
<span class="k">end</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-8-Rm9ydHJhbg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-8-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tabpanel" tabindex="0"><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! also here, not easy to test and better rewrite the function</span>
</pre></div>
</div>
</div></div>
</div>
</div>
<div class="admonition-design-5-design-a-test-for-a-method-of-a-mutable-class exercise important admonition" id="exercise-4">
<p class="admonition-title">Design-5: Design a test for a method of a mutable class</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-9-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-9-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-9-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-9-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button><button aria-controls="panel-9-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-9-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-9-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-9-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button><button aria-controls="panel-9-Rm9ydHJhbg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-9-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tab" tabindex="-1">Fortran</button></div><div aria-labelledby="tab-9-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-9-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Pet</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hunger</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">go_for_a_walk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># &lt;-- how would you test this function?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hunger</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-9-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-9-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Pet</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">private</span><span class="o">:</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">hunger_</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name_</span><span class="p">{};</span>

<span class="w"> </span><span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="k">explicit</span><span class="w"> </span><span class="n">Pet</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">name_</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">go_for_a_walk</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">hunger_</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="c1">// ^-- how would you test this function?</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">hunger</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">hunger_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-9-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-9-Ug==" name="Ug==" role="tabpanel" tabindex="0"><div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">Pet</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nf">structure</span><span class="p">(</span>
<span class="w">    </span><span class="nf">list</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">hunger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">),</span>
<span class="w">    </span><span class="n">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Pet&quot;</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># How would you test this function?</span>
<span class="n">take_for_a_walk</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">pet</span><span class="p">)</span><span class="w"> </span><span class="nf">UseMethod</span><span class="p">(</span><span class="s">&quot;take_for_a_walk&quot;</span><span class="p">)</span>
<span class="n">take_for_a_walk.Pet</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">pet</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">pet</span><span class="o">$</span><span class="n">hunger</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pet</span><span class="o">$</span><span class="n">hunger</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span>
<span class="w">  </span><span class="n">pet</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-9-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-9-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># the closest thing to a class in Julia is a `mutable struct`</span>
<span class="k">mutable</span><span class="w"> </span><span class="k">struct</span> <span class="kt">Pet</span>
<span class="w">    </span><span class="n">name</span><span class="o">::</span><span class="kt">String</span>
<span class="w">    </span><span class="n">hunger</span><span class="o">::</span><span class="kt">Int64</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">go_for_a_walk!</span><span class="p">(</span><span class="n">pet</span><span class="o">::</span><span class="kt">Pet</span><span class="p">)</span>
<span class="w">    </span><span class="n">pet</span><span class="o">.</span><span class="n">hunger</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<span class="k">end</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-9-Rm9ydHJhbg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-9-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tabpanel" tabindex="0"><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! missing - please submit an example</span>
</pre></div>
</div>
</div></div>
<div class="admonition-solution solution important dropdown admonition" id="solution-4">
<p class="admonition-title">Solution</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-10-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-10-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-10-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-10-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button><button aria-controls="panel-10-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-10-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-10-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-10-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button><button aria-controls="panel-10-Rm9ydHJhbg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-10-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tab" tabindex="-1">Fortran</button></div><div aria-labelledby="tab-10-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-10-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_pet</span><span class="p">():</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Pet</span><span class="p">(</span><span class="s1">&#39;fido&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">hunger</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">p</span><span class="o">.</span><span class="n">go_for_a_walk</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">hunger</span> <span class="o">==</span> <span class="mi">1</span>

    <span class="n">p</span><span class="o">.</span><span class="n">hunger</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">p</span><span class="o">.</span><span class="n">go_for_a_walk</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">hunger</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-10-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-10-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;catch2/catch.hpp&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;pet.hpp&quot;</span>

<span class="n">TEST_CASE</span><span class="p">(</span><span class="s">&quot;Check my pets&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[pets]&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">fido</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pet</span><span class="p">(</span><span class="s">&quot;fido&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">fido</span><span class="p">.</span><span class="n">hunger</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="w">  </span><span class="n">fido</span><span class="p">.</span><span class="n">go_for_a_walk</span><span class="p">();</span>
<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">fido</span><span class="p">.</span><span class="n">hunger</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-10-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-10-Ug==" name="Ug==" role="tabpanel" tabindex="0"><div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">test_that</span><span class="p">(</span><span class="s">&quot;Test Pet class&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">Pet</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;fido&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="n">p</span><span class="o">$</span><span class="n">hunger</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
<span class="w">  </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">take_for_a_walk</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="n">p</span><span class="o">$</span><span class="n">hunger</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>

<span class="w">  </span><span class="n">p</span><span class="o">$</span><span class="n">hunger</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">-1</span>
<span class="w">  </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">take_for_a_walk</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="n">p</span><span class="o">$</span><span class="n">hunger</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-10-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-10-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># create the mutable struct and test it</span>
<span class="nd">@testset</span><span class="w"> </span><span class="s">&quot;Test mutable struct&quot;</span><span class="w"> </span><span class="k">begin</span>
<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pet</span><span class="p">(</span><span class="s">&quot;fido&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">hunger</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">go_for_a_walk!</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">hunger</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">p</span><span class="o">.</span><span class="n">hunger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">    </span><span class="n">go_for_a_walk!</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">hunger</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
<span class="k">end</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-10-Rm9ydHJhbg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-10-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tabpanel" tabindex="0"><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">! missing - please submit an example</span>
</pre></div>
</div>
</div></div>
</div>
</div>
</section>
<section id="test-driven-development">
<h3>Test-driven development<a class="headerlink" href="#test-driven-development" title="Link to this heading"></a></h3>
<div class="admonition-design-6-experience-test-driven-development exercise important admonition" id="exercise-5">
<p class="admonition-title">Design-6: Experience test-driven development</p>
<p>Write a test before writing the function! You can decide yourself
what your unwritten function should do, but as a suggestion it can
be based on <a class="reference external" href="https://en.wikipedia.org/wiki/Fizz_buzz">FizzBuzz</a> - i.e.
a function that:</p>
<ul class="simple">
<li><p>takes an integer argument</p></li>
<li><p>for arguments that are multiples of three, returns “Fizz”</p></li>
<li><p>for arguments that are multiples of five, returns “Buzz”</p></li>
<li><p>for arguments that are multiples of both three and five, returns “FizzBuzz”</p></li>
<li><p>fails in case of non-integer arguments or integer arguments 0 or negative</p></li>
<li><p>otherwise returns the integer itself</p></li>
</ul>
<p>When writing the tests, consider the different ways that the function could
and should fail.</p>
<p>After you have written the tests, implement the function and run the tests
until they pass.</p>
<div class="admonition-solution solution important dropdown admonition" id="solution-5">
<p class="admonition-title">Solution</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-11-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-11-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-11-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-11-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button><button aria-controls="panel-11-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-11-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-11-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-11-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button><button aria-controls="panel-11-Rm9ydHJhbg==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-11-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tab" tabindex="-1">Fortran</button></div><div aria-labelledby="tab-11-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-11-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fizzbuzz</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span>
    <span class="k">if</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span>
    <span class="k">elif</span> <span class="n">number</span> <span class="o">%</span> <span class="mi">15</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;FizzBuzz&quot;</span>
    <span class="k">elif</span> <span class="n">number</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Fizz&quot;</span>
    <span class="k">elif</span> <span class="n">number</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Buzz&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">number</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_fizzbuzz</span><span class="p">():</span>
    <span class="n">expected_result</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Fizz&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Buzz&quot;</span><span class="p">,</span> <span class="s2">&quot;Fizz&quot;</span><span class="p">,</span>
                       <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;Fizz&quot;</span><span class="p">,</span> <span class="s2">&quot;Buzz&quot;</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="s2">&quot;Fizz&quot;</span><span class="p">,</span>
                       <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="s2">&quot;FizzBuzz&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="s2">&quot;Fizz&quot;</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="s2">&quot;Buzz&quot;</span><span class="p">]</span>
    <span class="n">obtained_result</span> <span class="o">=</span> <span class="p">[</span><span class="n">fizzbuzz</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">21</span><span class="p">)]</span>

    <span class="k">assert</span> <span class="n">obtained_result</span> <span class="o">==</span> <span class="n">expected_result</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
        <span class="n">fizzbuzz</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
        <span class="n">fizzbuzz</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">fizzbuzz</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
        <span class="n">fizzbuzz</span><span class="p">(</span><span class="s2">&quot;rabbit&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">fizzbuzz</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-11-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-11-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// in the fizzbuzz.hpp header file</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>

<span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">fizzbuzz</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;FizzBuzz&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Fizz&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Buzz&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// in the source file for the main executable</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdlib&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">fizzbuzz</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// in the source file for the test</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;catch2/catch.hpp&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;fizzbuzz.hpp&quot;</span>

<span class="n">TEST_CASE</span><span class="p">(</span><span class="s">&quot;FizzBuzz&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[fizzbuzz]&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">{</span>
<span class="w">	</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w">        </span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="w">    </span><span class="s">&quot;Fizz&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;4&quot;</span><span class="p">,</span><span class="w">    </span><span class="s">&quot;Buzz&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Fizz&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;7&quot;</span><span class="p">,</span>
<span class="w">	</span><span class="s">&quot;8&quot;</span><span class="p">,</span><span class="w">        </span><span class="s">&quot;Fizz&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Buzz&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;11&quot;</span><span class="p">,</span><span class="w">   </span><span class="s">&quot;Fizz&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;13&quot;</span><span class="p">,</span><span class="w">   </span><span class="s">&quot;14&quot;</span><span class="p">,</span>
<span class="w">	</span><span class="s">&quot;FizzBuzz&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;16&quot;</span><span class="p">,</span><span class="w">   </span><span class="s">&quot;17&quot;</span><span class="p">,</span><span class="w">   </span><span class="s">&quot;Fizz&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;19&quot;</span><span class="p">,</span><span class="w">   </span><span class="s">&quot;Buzz&quot;</span><span class="p">};</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">21</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">fizzbuzz</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">expected</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-11-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-11-Ug==" name="Ug==" role="tabpanel" tabindex="0"><div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the function</span>
<span class="n">fizz_buzz</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">number</span><span class="p">){</span>
<span class="w">  </span><span class="kr">if</span><span class="p">(</span><span class="o">!</span><span class="n">number</span><span class="o">%%</span><span class="m">1</span><span class="o">==</span><span class="m">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="nf">stop</span><span class="p">(</span><span class="s">&quot;non-integer or negative input not allowed!&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kr">if</span><span class="p">(</span><span class="n">number</span><span class="o">%%</span><span class="m">3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">number</span><span class="o">%%</span><span class="m">5</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">return</span><span class="p">(</span><span class="s">&#39;FizzBuzz&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kr">else</span><span class="w"> </span><span class="kr">if</span><span class="p">(</span><span class="n">number</span><span class="o">%%</span><span class="m">3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">return</span><span class="p">(</span><span class="s">&#39;Fizz&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kr">else</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="n">number</span><span class="o">%%</span><span class="m">5</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">){</span>
<span class="w">    </span><span class="kr">return</span><span class="p">(</span><span class="s">&#39;Buzz&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">return</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span>
<span class="p">}</span>

<span class="c1"># apply it to the numbers 1 to 50</span>
<span class="kr">for</span><span class="w"> </span><span class="p">(</span><span class="n">number</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">50</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nf">print</span><span class="p">(</span><span class="nf">fizz_buzz</span><span class="p">(</span><span class="n">number</span><span class="p">))</span>
<span class="p">}</span>


<span class="nf">library</span><span class="p">(</span><span class="n">testthat</span><span class="p">)</span>

<span class="nf">test_that</span><span class="p">(</span><span class="s">&quot;Test FizzBuzz&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">fizz_buzz</span><span class="p">(</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">fizz_buzz</span><span class="p">(</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">fizz_buzz</span><span class="p">(</span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;Fizz&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">fizz_buzz</span><span class="p">(</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="m">4</span><span class="p">)</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">fizz_buzz</span><span class="p">(</span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;Buzz&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">fizz_buzz</span><span class="p">(</span><span class="m">15</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;FizzBuzz&#39;</span><span class="p">)</span><span class="w">  </span>

<span class="w">  </span><span class="nf">expect_error</span><span class="p">(</span><span class="nf">fizz_buzz</span><span class="p">(</span><span class="m">-1</span><span class="p">))</span>
<span class="w">  </span><span class="nf">expect_error</span><span class="p">(</span><span class="nf">fizz_buzz</span><span class="p">(</span><span class="m">1.5</span><span class="p">))</span>
<span class="w">  </span><span class="nf">expect_error</span><span class="p">(</span><span class="nf">fizz_buzz</span><span class="p">(</span><span class="s">&#39;rabbit&#39;</span><span class="p">))</span><span class="w">    </span>
<span class="p">})</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-11-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-11-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Test</span>

<span class="k">function</span><span class="w"> </span><span class="n">fizzbuzz</span><span class="p">(</span><span class="n">number</span><span class="o">::</span><span class="kt">Int</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">throw</span><span class="p">(</span><span class="kt">DomainError</span><span class="p">(</span><span class="n">number</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;number needs to be 1 or higher&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="k">elseif</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;FizzBuzz&quot;</span>
<span class="w">    </span><span class="k">elseif</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Fizz&quot;</span>
<span class="w">    </span><span class="k">elseif</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Buzz&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">number</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>

<span class="nd">@testset</span><span class="w"> </span><span class="k">begin</span>
<span class="w">    </span><span class="n">expected_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Fizz&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Buzz&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Fizz&quot;</span><span class="p">,</span>
<span class="w">                       </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Fizz&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Buzz&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Fizz&quot;</span><span class="p">,</span>
<span class="w">                       </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;FizzBuzz&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Fizz&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Buzz&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">obtained_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">fizzbuzz</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">20</span><span class="p">]</span>

<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">obtained_result</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">expected_result</span>

<span class="w">    </span><span class="nd">@test_throws</span><span class="w"> </span><span class="kt">MethodError</span><span class="w"> </span><span class="n">fizzbuzz</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@test_throws</span><span class="w"> </span><span class="kt">DomainError</span><span class="w"> </span><span class="n">fizzbuzz</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@test_throws</span><span class="w"> </span><span class="kt">DomainError</span><span class="w"> </span><span class="n">fizzbuzz</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>

<span class="k">end</span>

<span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">20</span>
<span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">fizzbuzz</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="k">end</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-11-Rm9ydHJhbg==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-11-Rm9ydHJhbg==" name="Rm9ydHJhbg==" role="tabpanel" tabindex="0"><div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">module </span><span class="n">fizzbuzz_mod</span>
<span class="k">contains</span>
<span class="w">   </span><span class="c">! Evaluates the fizzbuzz of n</span>
<span class="w">   </span><span class="kt">character</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="k">function </span><span class="n">fizzbuzz</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="w">      </span><span class="k">implicit none</span>
<span class="k">      </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">n</span>
<span class="w">      </span><span class="kt">character</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="n">str1</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="nb">mod</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         </span><span class="n">str1</span><span class="o">=</span><span class="s1">&#39;FizzBuzz&#39;</span>
<span class="w">      </span><span class="k">else if</span><span class="p">(</span><span class="w"> </span><span class="nb">mod</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         </span><span class="n">str1</span><span class="o">=</span><span class="s1">&#39;Fizz&#39;</span>
<span class="w">         </span><span class="n">str1</span><span class="o">=</span><span class="n">str1</span>
<span class="w">      </span><span class="k">else if</span><span class="p">(</span><span class="w"> </span><span class="nb">mod</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         </span><span class="n">str1</span><span class="o">=</span><span class="s1">&#39;Buzz&#39;</span>
<span class="w">      </span><span class="k">else if</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         </span><span class="n">str1</span><span class="o">=</span><span class="s1">&#39;Err n&lt;0&#39;</span>
<span class="w">      </span><span class="k">else</span>
<span class="k">         </span><span class="n">str1</span><span class="o">=</span><span class="nb">char</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="w">      </span><span class="k">end if</span>
<span class="k">      </span><span class="n">fizzbuzz</span><span class="o">=</span><span class="n">str1</span>
<span class="w">   </span><span class="k">end function </span><span class="n">fizzbuzz</span>
<span class="k">end module </span><span class="n">fizzbuzz_mod</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@test</span>
<span class="n">subroutine</span> <span class="n">test_fizzbuzz</span><span class="p">()</span>
   <span class="n">use</span> <span class="n">fizzbuzz_mod</span>
   <span class="n">use</span> <span class="n">funit</span>
   <span class="nd">@assertEqual</span><span class="p">(</span><span class="s1">&#39;Fizz&#39;</span><span class="p">,</span> <span class="n">fizzbuzz</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span> <span class="s1">&#39;fizzbuzz(12)&#39;</span><span class="p">)</span>
   <span class="nd">@assertEqual</span><span class="p">(</span><span class="s1">&#39;Buzz&#39;</span><span class="p">,</span> <span class="n">fizzbuzz</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span> <span class="s1">&#39;fizzbuzz(25)&#39;</span><span class="p">)</span>
   <span class="nd">@assertEqual</span><span class="p">(</span><span class="s1">&#39;FizzBuzz&#39;</span><span class="p">,</span> <span class="n">fizzbuzz</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span> <span class="s1">&#39;fizzbuzz(60)&#39;</span><span class="p">)</span>
<span class="n">end</span> <span class="n">subroutine</span> <span class="n">test_fizzbuzz</span>
</pre></div>
</div>
</div></div>
</div>
</div>
</section>
<section id="testing-randomness">
<h3>Testing randomness<a class="headerlink" href="#testing-randomness" title="Link to this heading"></a></h3>
<p>How would you test functions which generate random numbers
according to some distribution/statistics?</p>
<p>Functions and modules which contain randomness are
more difficult to test than pure deterministic functions, but
many strategies exist:</p>
<ul class="simple">
<li><p>For unit tests we can use fixed random seeds.</p></li>
<li><p>Try to test whether your results follow the expected
distribution/statistics.</p></li>
<li><p>When you verify your code “by eye”, what are you looking at? Now try
to express that in a script.</p></li>
</ul>
<div class="admonition-design-7-write-two-different-types-of-tests-for-randomness exercise important admonition" id="exercise-6">
<p class="admonition-title">Design-7: Write two different types of tests for randomness</p>
<p>Consider the code below which simulates playing
<a class="reference external" href="https://en.wikipedia.org/wiki/Yahtzee">Yahtzee</a> by using
random numbers. How would you go about testing it?</p>
<p>Try to write two types of tests:</p>
<ul class="simple">
<li><p>a <em>unit test</em> for the <code class="docutils literal notranslate"><span class="pre">roll_dice</span></code> function. Since it uses
random numbers, you will need to <strong>set the random seed</strong>,
pre-calculate what sequence of dice throws you get with that seed,
and use that in your test.</p></li>
<li><p>a test of the <code class="docutils literal notranslate"><span class="pre">yahtzee</span></code> function which considers the statistical
probability of obtaining a “Yahtzee” (5 dice with the same value
after three throws), which is around 4.6%. This test will be
an <em>integration test</em> since it tests multiple functions including the
random number generator itself.</p></li>
</ul>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-12-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-12-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-12-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-12-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button><button aria-controls="panel-12-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-12-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-12-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-12-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button></div><div aria-labelledby="tab-12-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-12-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span>


<span class="k">def</span><span class="w"> </span><span class="nf">roll_dice</span><span class="p">(</span><span class="n">num_dice</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_dice</span><span class="p">)]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">yahtzee</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Play yahtzee with 5 6-sided dice and 3 throws.</span>
<span class="sd">    Collect as many of the same dice side as possible.</span>
<span class="sd">    Returns the number of same sides.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># first throw</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">roll_dice</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">most_common_side</span><span class="p">,</span> <span class="n">how_often</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># we keep the most common side</span>
    <span class="n">target_side</span> <span class="o">=</span> <span class="n">most_common_side</span>
    <span class="n">num_same_sides</span> <span class="o">=</span> <span class="n">how_often</span>
    <span class="k">if</span> <span class="n">num_same_sides</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">5</span>

    <span class="c1"># second and third throw</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
        <span class="n">throw</span> <span class="o">=</span> <span class="n">roll_dice</span><span class="p">(</span><span class="mi">5</span> <span class="o">-</span> <span class="n">num_same_sides</span><span class="p">)</span>
        <span class="n">num_same_sides</span> <span class="o">+=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">throw</span><span class="p">)[</span><span class="n">target_side</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">num_same_sides</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">5</span>

    <span class="k">return</span> <span class="n">num_same_sides</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">num_games</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="n">winning_games</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="nb">filter</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">5</span><span class="p">,</span>
            <span class="p">[</span><span class="n">yahtzee</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_games</span><span class="p">)],</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;out of the </span><span class="si">{</span><span class="n">num_games</span><span class="si">}</span><span class="s2"> games, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">winning_games</span><span class="p">)</span><span class="si">}</span><span class="s2"> got a yahtzee!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-12-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-12-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdlib&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;random&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;tuple&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>

<span class="cm">/* Roll a fair die n_dice times. The faces of the die can be set (default is 1 to 6).</span>
<span class="cm"> * The PRNG engine is moved in the function such that changes in its state are propagated back to the caller.</span>
<span class="cm"> */</span>
<span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">PRNGEngine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">decltype</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">default_random_engine</span><span class="p">())</span><span class="o">&gt;</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">roll_dice</span><span class="p">(</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n_dice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">faces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">},</span>
<span class="w">    </span><span class="n">PRNGEngine</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">gen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">default_random_engine</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">random_device</span><span class="p">()()))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// create a fair die</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">weights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">faces</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">fair_dice</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">discrete_distribution</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">weights</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">weights</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">rolls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">n_dice</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0u</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_dice</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">rolls</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">faces</span><span class="p">[</span><span class="n">fair_dice</span><span class="p">(</span><span class="n">gen</span><span class="p">)];</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">rolls</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* count how many times each face comes up */</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">count</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">toss</span><span class="p">,</span>
<span class="w">				</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">faces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">				    </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">face_counts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">faces</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">faces</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">face_counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">count</span><span class="p">(</span><span class="n">toss</span><span class="p">.</span><span class="n">cbegin</span><span class="p">(),</span><span class="w"> </span><span class="n">toss</span><span class="p">.</span><span class="n">cend</span><span class="p">(),</span><span class="w"> </span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">face_counts</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">std</span><span class="o">::</span><span class="n">tuple</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">yahtzee</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">n_dice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">faces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">};</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">toss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">faces</span><span class="p">](</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n_dice</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">roll_dice</span><span class="p">(</span><span class="n">n_dice</span><span class="p">,</span><span class="w"> </span><span class="n">faces</span><span class="p">);</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="c1">// throw all dice</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">first_toss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toss</span><span class="p">(</span><span class="n">n_dice</span><span class="p">);</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">face_counts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count</span><span class="p">(</span><span class="n">first_toss</span><span class="p">);</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">it_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">max_element</span><span class="p">(</span><span class="n">face_counts</span><span class="p">.</span><span class="n">cbegin</span><span class="p">(),</span><span class="w"> </span><span class="n">face_counts</span><span class="p">.</span><span class="n">cend</span><span class="p">());</span>
<span class="w">  </span><span class="c1">// number of faces that showed the most</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">n_collected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">it_max</span><span class="p">;</span>
<span class="w">  </span><span class="c1">// corresponding index in the array, will be used to get which face showed up</span>
<span class="w">  </span><span class="c1">// the most</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">idx_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">distance</span><span class="p">(</span><span class="n">face_counts</span><span class="p">.</span><span class="n">cbegin</span><span class="p">(),</span><span class="w"> </span><span class="n">it_max</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// all 5 dice showed the same face! YAHTZEE!</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n_collected</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">idx_max</span><span class="p">],</span><span class="w"> </span><span class="n">n_collected</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// no yahtzee :(</span>
<span class="w">  </span><span class="c1">// we throw (n_dice - n_collected) dice</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">second_toss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toss</span><span class="p">(</span><span class="n">n_dice</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">n_collected</span><span class="p">);</span>
<span class="w">  </span><span class="n">n_collected</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">count</span><span class="p">(</span><span class="n">second_toss</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">faces</span><span class="p">[</span><span class="n">idx_max</span><span class="p">]})[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">  </span><span class="c1">// YAHTZEE!</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n_collected</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">idx_max</span><span class="p">],</span><span class="w"> </span><span class="n">n_collected</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// final chance</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">third_toss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toss</span><span class="p">(</span><span class="n">n_dice</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">n_collected</span><span class="p">);</span>
<span class="w">  </span><span class="n">n_collected</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">count</span><span class="p">(</span><span class="n">third_toss</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">faces</span><span class="p">[</span><span class="n">idx_max</span><span class="p">]})[</span><span class="mi">0</span><span class="p">];</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">idx_max</span><span class="p">],</span><span class="w"> </span><span class="n">n_collected</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">tie</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">times</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yahtzee</span><span class="p">();</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;We got &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; times in round &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span>
<span class="w">	      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">times</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;YAHTZEE in round &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-12-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-12-Ug==" name="Ug==" role="tabpanel" tabindex="0"><div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1">#&#39; Roll a fair die num_dice times.</span>
<span class="c1">#&#39; Collect as many of the same dice side as possible.</span>
<span class="c1">#&#39;</span>
<span class="c1">#&#39; @return A vector of die throw results</span>
<span class="n">roll_dice</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">num_dice</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nf">ceiling</span><span class="p">(</span><span class="nf">runif</span><span class="p">(</span><span class="n">num_dice</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">))</span>
<span class="p">}</span>

<span class="c1">#&#39; Play yahtzee with 5 6-sided dice and 3 throws.</span>
<span class="c1">#&#39; Collect as many of the same dice side as possible.</span>
<span class="c1">#&#39;</span>
<span class="c1">#&#39; @return The number of same sides</span>
<span class="n">yahtzee</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">roll_dice</span><span class="p">(</span><span class="m">5</span><span class="p">)</span>
<span class="w">  </span><span class="n">most_common_side</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="nf">table</span><span class="p">(</span><span class="n">res</span><span class="p">)[</span><span class="nf">which.max</span><span class="p">(</span><span class="nf">table</span><span class="p">(</span><span class="n">res</span><span class="p">))]))[</span><span class="m">1</span><span class="p">]</span>
<span class="w">  </span><span class="n">how_often</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.vector</span><span class="p">(</span><span class="nf">table</span><span class="p">(</span><span class="n">res</span><span class="p">)[</span><span class="nf">which.max</span><span class="p">(</span><span class="nf">table</span><span class="p">(</span><span class="n">res</span><span class="p">))])[</span><span class="m">1</span><span class="p">]</span>

<span class="w">  </span><span class="c1"># we keep the most common side</span>
<span class="w">  </span><span class="n">target_side</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">most_common_side</span>
<span class="w">  </span><span class="n">num_same_sides</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">how_often</span>
<span class="w">  </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="n">num_same_sides</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">return</span><span class="p">(</span><span class="m">5</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1"># second and third throw</span>
<span class="w">  </span><span class="kr">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">throw</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">roll_dice</span><span class="p">(</span><span class="m">5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">num_same_sides</span><span class="p">)</span>
<span class="w">    </span><span class="n">num_same_sides</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">num_same_sides</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">throw</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">target_side</span><span class="p">)</span>

<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="n">num_same_sides</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kr">return</span><span class="p">(</span><span class="m">5</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kr">return</span><span class="p">(</span><span class="n">num_same_sides</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-12-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-12-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Random</span>

<span class="s">&quot;&quot;&quot;</span>
<span class="s">    roll_dice(n_dice::Int=5, sides=(1,2,3,4,5,6))</span>

<span class="s">Returns array of n_dice random integers corresponding to the sides of dice</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="k">function</span><span class="w"> </span><span class="n">roll_dice</span><span class="p">(</span><span class="n">n_dice</span><span class="o">::</span><span class="kt">Int</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">sides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="n">rand</span><span class="p">(</span><span class="n">sides</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">n_dice</span><span class="p">]</span>
<span class="k">end</span>

<span class="s">&quot;&quot;&quot;</span>
<span class="s">    yahtzee()</span>

<span class="s">Play Yahtzee with 5 6-sided dice and 3 throws.</span>
<span class="s">Collect as many of the same dice side as possible.</span>
<span class="s">Returns a tuple with the collected side (e.g. 4&#39;s) and</span>
<span class="s">how many of that side (between 1 and 5).</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="k">function</span><span class="w"> </span><span class="n">yahtzee</span><span class="p">()</span>
<span class="w">    </span><span class="n">sides</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="w">    </span><span class="n">n_dice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="w">    </span><span class="c"># we first throw all dice</span>
<span class="w">    </span><span class="n">first_throw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">roll_dice</span><span class="p">(</span><span class="n">n_dice</span><span class="p">,</span><span class="w"> </span><span class="n">sides</span><span class="p">)</span>
<span class="w">    </span><span class="c"># count how many times each side comes up</span>
<span class="w">    </span><span class="n">side_counts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">count</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">x</span><span class="o">==</span><span class="n">i</span><span class="p">,</span><span class="n">first_throw</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">sides</span><span class="p">]</span>
<span class="w">    </span><span class="c"># collected_side is the dice side we will start collecting</span>
<span class="w">    </span><span class="n">n_collected</span><span class="p">,</span><span class="w"> </span><span class="n">collected_side</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findmax</span><span class="p">(</span><span class="n">side_counts</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">n_collected</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">collected_side</span><span class="p">,</span><span class="w"> </span><span class="n">n_collected</span>
<span class="w">    </span><span class="k">end</span>

<span class="w">    </span><span class="c"># now we throw n_dice-n_collected dice and hope to get more collected_side</span>
<span class="w">    </span><span class="n">second_throw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">roll_dice</span><span class="p">(</span><span class="n">n_dice</span><span class="o">-</span><span class="n">n_collected</span><span class="p">,</span><span class="w"> </span><span class="n">sides</span><span class="p">)</span>
<span class="w">    </span><span class="n">n_new_matches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">x</span><span class="o">==</span><span class="n">collected_side</span><span class="p">,</span><span class="n">second_throw</span><span class="p">)</span>
<span class="w">    </span><span class="n">n_collected</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">n_new_matches</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">n_collected</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">collected_side</span><span class="p">,</span><span class="w"> </span><span class="n">n_collected</span>
<span class="w">    </span><span class="k">end</span>

<span class="w">    </span><span class="c"># final throw...</span>
<span class="w">    </span><span class="n">third_throw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">roll_dice</span><span class="p">(</span><span class="n">n_dice</span><span class="o">-</span><span class="n">n_collected</span><span class="p">,</span><span class="w"> </span><span class="n">sides</span><span class="p">)</span>
<span class="w">    </span><span class="n">n_new_matches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">x</span><span class="o">==</span><span class="n">collected_side</span><span class="p">,</span><span class="n">third_throw</span><span class="p">)</span>
<span class="w">    </span><span class="n">n_collected</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">n_new_matches</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">collected_side</span><span class="p">,</span><span class="w"> </span><span class="n">n_collected</span>
<span class="k">end</span>


<span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">10</span>
<span class="w">    </span><span class="n">collected_side</span><span class="p">,</span><span class="w"> </span><span class="n">n_collected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yahtzee</span><span class="p">()</span>
<span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;We got </span><span class="si">$n_collected</span><span class="s"> </span><span class="si">$collected_side</span><span class="s">&#39;s in this round&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">n_collected</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span>
<span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Yay, it&#39;s a Yahtzee!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div></div>
<div class="admonition-solution solution important dropdown admonition" id="solution-6">
<p class="admonition-title">Solution</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-13-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-13-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-13-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-13-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button><button aria-controls="panel-13-Ug==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-13-Ug==" name="Ug==" role="tab" tabindex="-1">R</button><button aria-controls="panel-13-SnVsaWE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-13-SnVsaWE=" name="SnVsaWE=" role="tab" tabindex="-1">Julia</button></div><div aria-labelledby="tab-13-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-13-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_roll_dice</span><span class="p">():</span>
    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">roll_dice</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">roll_dice</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">roll_dice</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>


<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_yahtzee</span><span class="p">():</span>
    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">n_tests</span> <span class="o">=</span> <span class="mi">1_000_000</span>

    <span class="n">winning_games</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="nb">filter</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">5</span><span class="p">,</span>
            <span class="p">[</span><span class="n">yahtzee</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_tests</span><span class="p">)],</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">winning_games</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_tests</span> <span class="o">==</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span><span class="mf">0.046</span><span class="p">,</span> <span class="nb">abs</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-13-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-13-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;random&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;catch2/catch.hpp&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;yahtzee.hpp&quot;</span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Catch</span><span class="o">::</span><span class="nn">literals</span><span class="p">;</span>

<span class="n">TEST_CASE</span><span class="p">(</span><span class="s">&quot;Tossing 5 dice&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[toss]&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">n_dice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">faces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">};</span>

<span class="w">  </span><span class="c1">// we fix both the random device and the random engine.</span>
<span class="w">  </span><span class="c1">// the latter is necessary since the default random engine is implementation-dependent</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">mt19937</span><span class="w"> </span><span class="n">prng</span><span class="p">;</span>
<span class="w">  </span><span class="n">prng</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">);</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">expected_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">};</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">toss_1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">roll_dice</span><span class="p">(</span><span class="n">n_dice</span><span class="p">,</span><span class="w"> </span><span class="n">faces</span><span class="p">,</span><span class="w"> </span><span class="n">prng</span><span class="p">);</span>
<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">toss_1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">expected_1</span><span class="p">);</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">expected_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">};</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">toss_2</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">roll_dice</span><span class="p">(</span><span class="n">n_dice</span><span class="p">,</span><span class="w"> </span><span class="n">faces</span><span class="p">,</span><span class="w"> </span><span class="n">prng</span><span class="p">);</span>
<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">toss_2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">expected_2</span><span class="p">);</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">expected_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">};</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">toss_3</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">roll_dice</span><span class="p">(</span><span class="n">n_dice</span><span class="p">,</span><span class="w"> </span><span class="n">faces</span><span class="p">,</span><span class="w"> </span><span class="n">prng</span><span class="p">);</span>
<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">toss_3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">expected_3</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">TEST_CASE</span><span class="p">(</span><span class="s">&quot;Distribution of Yahtzee&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[yahtzee]&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// try a million throws and see if we get close</span>
<span class="w">  </span><span class="c1">// to the statistical average of 4.6%</span>
<span class="w">  </span><span class="c1">// (https://en.wikipedia.org/wiki/Yahtzee#Probabilities)</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">n_yahtzees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">n_trials</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e6</span><span class="p">;</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_trials</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">tie</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">times</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yahtzee</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">times</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="o">++</span><span class="n">n_yahtzees</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="w"> </span><span class="n">n_yahtzees</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">n_tests</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.046</span><span class="n">_a</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-13-Ug==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-13-Ug==" name="Ug==" role="tabpanel" tabindex="0"><div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">require</span><span class="p">(</span><span class="n">testthat</span><span class="p">))</span><span class="w"> </span><span class="nf">install.packages</span><span class="p">(</span><span class="n">testthat</span><span class="p">)</span>

<span class="nf">test_that</span><span class="p">(</span><span class="s">&quot;dice is working&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nf">set.seed</span><span class="p">(</span><span class="m">42</span><span class="p">)</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">roll_dice</span><span class="p">(</span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">))</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">roll_dice</span><span class="p">(</span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">))</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">roll_dice</span><span class="p">(</span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">))</span>
<span class="p">})</span>


<span class="nf">test_that</span><span class="p">(</span><span class="s">&quot;yahtzee is working&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">n_games</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1e6</span><span class="w"> </span><span class="c1">#could be very slow, when in doubt change to 1e4</span>

<span class="w">  </span><span class="n">n_winning</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="nf">replicate</span><span class="p">(</span><span class="n">n_games</span><span class="p">,</span><span class="w"> </span><span class="nf">yahtzee</span><span class="p">())</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">5</span><span class="p">)</span>
<span class="w">  </span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">n_winning</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">n_games</span><span class="p">)</span>
<span class="w">  </span><span class="n">expected</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.046</span>
<span class="w">  </span><span class="nf">expect_lt</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">expected</span><span class="p">),</span><span class="w"> </span><span class="m">0.003</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-13-SnVsaWE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-13-SnVsaWE=" name="SnVsaWE=" role="tabpanel" tabindex="0"><div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Test</span>
<span class="k">using</span><span class="w"> </span><span class="n">Random</span>

<span class="n">include</span><span class="p">(</span><span class="s">&quot;yahtzee.jl&quot;</span><span class="p">)</span>

<span class="nd">@testset</span><span class="w"> </span><span class="s">&quot;test roll_dice&quot;</span><span class="w"> </span><span class="k">begin</span>
<span class="w">    </span><span class="c"># fix random seed</span>
<span class="w">    </span><span class="n">Random</span><span class="o">.</span><span class="n">seed!</span><span class="p">(</span><span class="mi">1234</span><span class="p">);</span>
<span class="w">    </span><span class="c"># known sequence for given seed</span>
<span class="w">    </span><span class="n">exp_first_throw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">]</span>
<span class="w">    </span><span class="n">exp_second_throw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">]</span>
<span class="w">    </span><span class="n">exp_third_throw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span>

<span class="w">    </span><span class="n">n_dice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="w">    </span><span class="n">sides</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="w">    </span><span class="n">throw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">roll_dice</span><span class="p">(</span><span class="n">n_dice</span><span class="p">,</span><span class="w"> </span><span class="n">sides</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">exp_first_throw</span>
<span class="w">    </span><span class="n">throw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">roll_dice</span><span class="p">(</span><span class="n">n_dice</span><span class="p">,</span><span class="w"> </span><span class="n">sides</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">exp_second_throw</span>
<span class="w">    </span><span class="n">throw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">roll_dice</span><span class="p">(</span><span class="n">n_dice</span><span class="p">,</span><span class="w"> </span><span class="n">sides</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">exp_third_throw</span>
<span class="k">end</span>

<span class="nd">@testset</span><span class="w"> </span><span class="s">&quot;testing yahtzee&quot;</span><span class="w"> </span><span class="k">begin</span>
<span class="w">    </span><span class="c"># try a million throws and see if we get close</span>
<span class="w">    </span><span class="c"># to the statistical average of 4.6%</span>
<span class="w">    </span><span class="c"># (https://en.wikipedia.org/wiki/Yahtzee#Probabilities)</span>
<span class="w">    </span><span class="n">n_yahtzees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">n_tests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1_000_000</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">n_tests</span>
<span class="w">        </span><span class="n">collected_side</span><span class="p">,</span><span class="w"> </span><span class="n">n_collected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yahtzee</span><span class="p">()</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">n_collected</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span>
<span class="w">            </span><span class="n">n_yahtzees</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">n_yahtzees</span><span class="o">/</span><span class="n">n_tests</span><span class="w"> </span><span class="o">≈</span><span class="w"> </span><span class="mf">0.046</span><span class="w"> </span><span class="n">atol</span><span class="o">=</span><span class="mf">0.001</span>
<span class="k">end</span>
</pre></div>
</div>
</div></div>
</div>
</div>
</section>
<section id="designing-an-end-to-end-test">
<h3>Designing an end-to-end test<a class="headerlink" href="#designing-an-end-to-end-test" title="Link to this heading"></a></h3>
<p>In this exercise we will practice designing an end-to-end test.
In an end-to-end test (or integration test), the unit is the entire program.
We typically feed the program with some well defined input and verify
that it still produces the expected output by comparing it to some reference.</p>
<div class="admonition-design-8-design-but-not-write-an-end-to-end-test-for-the-uniq-program exercise important admonition" id="exercise-7">
<p class="admonition-title">Design-8: Design (but not write) an end-to-end test for the uniq program</p>
<p>To have a tangible example, let us consider the <code class="docutils literal notranslate"><span class="pre">uniq</span></code> command. This command
can read a file or an input stream and remove consecutive repetition.
The program behind <code class="docutils literal notranslate"><span class="pre">uniq</span></code> has been written by somebody else, it probably contains
some functions, but we will not look into it but regard it as “black box”.</p>
<p>If we have a file called <code class="docutils literal notranslate"><span class="pre">repetitive-text.txt</span></code> containing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">all</span> <span class="n">together</span> <span class="n">now</span><span class="p">)</span> <span class="nb">all</span> <span class="n">together</span> <span class="n">now</span>
<span class="p">(</span><span class="nb">all</span> <span class="n">together</span> <span class="n">now</span><span class="p">)</span> <span class="nb">all</span> <span class="n">together</span> <span class="n">now</span>
<span class="p">(</span><span class="nb">all</span> <span class="n">together</span> <span class="n">now</span><span class="p">)</span> <span class="nb">all</span> <span class="n">together</span> <span class="n">now</span>
<span class="p">(</span><span class="nb">all</span> <span class="n">together</span> <span class="n">now</span><span class="p">)</span> <span class="nb">all</span> <span class="n">together</span> <span class="n">now</span>
<span class="p">(</span><span class="nb">all</span> <span class="n">together</span> <span class="n">now</span><span class="p">)</span> <span class="nb">all</span> <span class="n">together</span> <span class="n">now</span>
<span class="n">another</span> <span class="n">line</span>
<span class="n">another</span> <span class="n">line</span>
<span class="n">another</span> <span class="n">line</span>
<span class="n">another</span> <span class="n">line</span>
<span class="n">intermission</span>
<span class="n">more</span> <span class="n">repetition</span>
<span class="n">more</span> <span class="n">repetition</span>
<span class="n">more</span> <span class="n">repetition</span>
<span class="n">more</span> <span class="n">repetition</span>
<span class="n">more</span> <span class="n">repetition</span>
<span class="p">(</span><span class="nb">all</span> <span class="n">together</span> <span class="n">now</span><span class="p">)</span> <span class="nb">all</span> <span class="n">together</span> <span class="n">now</span>
<span class="p">(</span><span class="nb">all</span> <span class="n">together</span> <span class="n">now</span><span class="p">)</span> <span class="nb">all</span> <span class="n">together</span> <span class="n">now</span>
</pre></div>
</div>
<p>… then feeding this input file to <code class="docutils literal notranslate"><span class="pre">uniq</span></code> like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ uniq &lt; repetitive-text.txt
</pre></div>
</div>
<p>… will produce the following output with repetitions removed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">all</span> <span class="n">together</span> <span class="n">now</span><span class="p">)</span> <span class="nb">all</span> <span class="n">together</span> <span class="n">now</span>
<span class="n">another</span> <span class="n">line</span>
<span class="n">intermission</span>
<span class="n">more</span> <span class="n">repetition</span>
<span class="p">(</span><span class="nb">all</span> <span class="n">together</span> <span class="n">now</span><span class="p">)</span> <span class="nb">all</span> <span class="n">together</span> <span class="n">now</span>
</pre></div>
</div>
<p>How would you write an end-to-end test for <code class="docutils literal notranslate"><span class="pre">uniq</span></code>?</p>
</div>
<div class="admonition-design-9-more-end-to-end-testing exercise important admonition" id="exercise-8">
<p class="admonition-title">Design-9: More end-to-end testing</p>
<ul class="simple">
<li><p>Now imagine a code which reads numbers and produces some (floating
point) numbers. How would you test that?</p></li>
<li><p>How would you test a code end-to-end which produces images?</p></li>
</ul>
</div>
<div class="admonition-design-10-create-an-actual-end-to-end-test exercise important admonition" id="exercise-9">
<p class="admonition-title">Design-10: Create an actual end-to-end test</p>
<p>Often, you can include tests that run your whole workflow or program.
For example, you might include sample data and check the output
against what you expect.  (including sample data is a great idea
anyway, so this helps a lot!)</p>
<p>We’ll use the word-count example repository
<a class="reference external" href="https://github.com/coderefinery/word-count">https://github.com/coderefinery/word-count</a>.</p>
<p>As a reminder, you can run the script like this to get some output,
which prints to standard output (the terminal):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python3<span class="w"> </span>code/count.py<span class="w"> </span>data/abyss.txt
</pre></div>
</div>
<p>Your goal is to make a test that can run this and let you know if it’s
successful or not.  You could use Python, or you could use shell
scripting.  You can test if these two lines are in the output: <code class="docutils literal notranslate"><span class="pre">the</span> <span class="pre">4044</span></code> and <code class="docutils literal notranslate"><span class="pre">and</span> <span class="pre">2807</span></code>.</p>
<p>Python hint:
<a class="reference external" href="https://docs.python.org/3/library/subprocess.html#subprocess.check_output">subprocess.check_output</a>
will run a command and return its output as a string.</p>
<p>Bash hint: <code class="docutils literal notranslate"><span class="pre">COMMAND</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">&quot;PATTERN&quot;</span></code> (“pipe to grep”) will be true if
the pattern is in the command.</p>
<div class="admonition-solution solution important dropdown admonition" id="solution-7">
<p class="admonition-title">Solution</p>
<p>There are two solutions in the repository already, in the <code class="docutils literal notranslate"><span class="pre">tests/</span></code>
dierectory <a class="reference external" href="https://github.com/coderefinery/word-count">https://github.com/coderefinery/word-count</a>, one in Python
and one in bash shell.  Neither of these are a very advanced or
perfect solution, and you could integrate them with pytest or whatever
other test framework you use.</p>
<p>The shell one works with shell and prints a bit more output:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sh<span class="w"> </span>tests/end-to-end-shell.sh
<span class="go">the 4044</span>
<span class="go">Success: &#39;the&#39; found correct number of times</span>
<span class="go">and 2807</span>
<span class="go">Success: &#39;and&#39; found correct number of times</span>
<span class="go">Success</span>
</pre></div>
</div>
<p>The Python one:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python3<span class="w"> </span>tests/end-to-end-python.py
<span class="go">Success</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>Pure functions (these are functions without side-effects) are easiest to test.
And also easiest to reuse in another code project since they don’t depend on
any side-effects.</p></li>
<li><p>Classes can be tested but it’s somewhat more elaborate.</p></li>
</ul>
</div>
</section>
</section>
<span id="document-conclusions"></span><section id="conclusions-and-recommendations">
<h2>Conclusions and recommendations<a class="headerlink" href="#conclusions-and-recommendations" title="Link to this heading"></a></h2>
<section id="the-basics">
<h3>The basics<a class="headerlink" href="#the-basics" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Learn one test framework well enough for basics</p>
<ul>
<li><p>Explore and use the good tools that exist out there</p></li>
<li><p>An incomplete list of testing frameworks can be found in the <a class="reference internal" href="#document-quick-reference"><span class="doc std std-doc">Quick Reference</span></a></p></li>
</ul>
</li>
<li><p>Start with some basics</p>
<ul>
<li><p>Some simple thing that test all parts</p></li>
</ul>
</li>
<li><p>Automate tests</p>
<ul>
<li><p>Faster feedback and reduce the number of surprises</p></li>
</ul>
</li>
</ul>
</section>
<section id="going-more-in-depth">
<h3>Going more in-depth<a class="headerlink" href="#going-more-in-depth" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Strike a healthy balance between unit tests and integration tests</p></li>
<li><p>As the code gets larger and the chance of undetected bugs
increases, tests should increase</p></li>
<li><p>When adding new functionality, also add tests</p></li>
<li><p>When you discover and fix a bug, also commit a test against this bug</p></li>
<li><p>Use code coverage analysis to identify untested or unused code</p></li>
<li><p>If you make your code easier to test, it becomes more modular</p></li>
</ul>
</section>
<section id="ways-to-get-started">
<h3>Ways to get started<a class="headerlink" href="#ways-to-get-started" title="Link to this heading"></a></h3>
<p>You probably won’t do everything perfectly when you start off… But
what are some of the easy starting points?</p>
<ul class="simple">
<li><p>Do you have some single functions that are easy to test, but hard to
verify just by looking at them?  Add unit tests.</p></li>
<li><p>Do you have data analysis or simulation of some sort?  Make an
end-to-end test with sample data, or sample parameters.  This is
useful as an example anyway.</p></li>
<li><p>A local testing framework + GitHub actions is very easy!  And works
well in the background - you do whatever you want and get an email
if you break things.  It’s actually pretty freeing.</p></li>
</ul>
</section>
</section>
<span id="document-full-cycle-ci"></span><section id="optional-full-cycle-collaborative-workflow">
<h2>(Optional) Full-cycle collaborative workflow<a class="headerlink" href="#optional-full-cycle-collaborative-workflow" title="Link to this heading"></a></h2>
<div class="admonition-questions questions admonition" id="questions-0">
<p class="admonition-title">Questions</p>
<ul class="simple">
<li><p>How can we implement automatic testing each time we push changes to the repository?</p></li>
<li><p>Why is it good to autoclose issues with commit messages?</p></li>
</ul>
</div>
<section id="exercise-a-full-cycle-collaborative-workflow">
<h3>Exercise a full-cycle collaborative workflow<a class="headerlink" href="#exercise-a-full-cycle-collaborative-workflow" title="Link to this heading"></a></h3>
<p>This exercise is a collaborative version of the <a class="reference internal" href="#document-continuous-integration"><span class="doc std std-doc">Automated testing exercise</span></a>.</p>
<div class="admonition-fullci-1-create-and-use-a-continuous-integration-workflow-on-github-or-gitlab-with-pull-requests-and-issues exercise important admonition" id="exercise-0">
<p class="admonition-title">FullCI-1: Create and use a continuous integration workflow on GitHub or GitLab with pull requests and issues</p>
<p>This is an expanded version of the <a class="reference internal" href="#document-continuous-integration"><span class="doc">automated testing demonstration</span></a>.
The exercise is performed in a collaborative circle within the exercise group
(breakout room).</p>
<p>The exercise takes 20-30 minutes.</p>
<p>In this exercise, everybody will:</p>
<p><strong>A.</strong> Create a repository on GitHub/GitLab (everybody should use a <strong>different repository name</strong> for their repository)
<strong>B.</strong> Commit code to the repository and set up tests with GitHub Actions/ GitLab CI
<strong>C.</strong> Everybody will find a bug in their repository and open an issue in their repository
<strong>D.</strong> Then each one will clone the repo of one of their exercise partners, fix the bug,
and open a pull request (GitHub)/ merge request (GitLab)
<strong>E.</strong> Everybody then merges their co-worker’s change</p>
</div>
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="_images/testing_group_work.png"><img alt="Graph with exercise steps" src="_images/testing_group_work.png" style="width: 300px;" />
</a>
<figcaption>
<p><span class="caption-text">Overview of this exercise. Below we detail the steps.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<section id="prerequisites">
<h4>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading"></a></h4>
<p>If you are new to Git, you can find a step-by-step guide to
setting up repositories and making commits in
<a class="reference external" href="https://coderefinery.github.io/git-refresher/">this git-refresher material</a>.</p>
</section>
<section id="step-1-create-a-new-repository-on-github-gitlab">
<h4>Step 1: Create a new repository on GitHub/GitLab<a class="headerlink" href="#step-1-create-a-new-repository-on-github-gitlab" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Select a <strong>different repository name</strong> than your colleagues (otherwise forking the same name will be strange)</p></li>
<li><p><strong>Before</strong> you create the repository, select <strong>“Initialize this repository
with a README”</strong> (otherwise you try to clone an empty repo).</p></li>
<li><p>Share the repository URL with your exercise group via shared document or chat</p></li>
</ul>
</section>
<section id="step-2-clone-your-own-repository-add-code-commit-and-push">
<h4>Step 2: Clone your own repository, add code, commit, and push<a class="headerlink" href="#step-2-clone-your-own-repository-add-code-commit-and-push" title="Link to this heading"></a></h4>
<p>Clone the repository.</p>
<p>Add a file <code class="docutils literal notranslate"><span class="pre">example.py</span></code> containing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_add</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
    <span class="k">assert</span> <span class="n">add</span><span class="p">(</span><span class="s1">&#39;space&#39;</span><span class="p">,</span> <span class="s1">&#39;ship&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;spaceship&#39;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">subtract</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>  <span class="c1"># &lt;--- fix this in step 8</span>


<span class="c1"># uncomment the following test in step 5</span>
<span class="c1">#def test_subtract():</span>
<span class="c1">#    assert subtract(2, 3) == -1</span>
</pre></div>
</div>
<p>Test <code class="docutils literal notranslate"><span class="pre">example.py</span></code> with <code class="docutils literal notranslate"><span class="pre">pytest</span></code>.</p>
<p>Then stage the file (<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">&lt;filename&gt;</span></code>), commit (<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">-m</span> <span class="pre">&quot;some</span> <span class="pre">commit</span> <span class="pre">message&quot;</span></code>),
and push the changes (<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span> <span class="pre">origin</span> <span class="pre">main</span></code>).</p>
</section>
<section id="step-3-enable-automated-testing">
<h4>Step 3: Enable automated testing<a class="headerlink" href="#step-3-enable-automated-testing" title="Link to this heading"></a></h4>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-R2l0SHVi" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-R2l0SHVi" name="R2l0SHVi" role="tab" tabindex="0">GitHub</button><button aria-controls="panel-0-R2l0TGFi" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-R2l0TGFi" name="R2l0TGFi" role="tab" tabindex="-1">GitLab</button></div><div aria-labelledby="tab-0-R2l0SHVi" class="sphinx-tabs-panel group-tab" id="panel-0-R2l0SHVi" name="R2l0SHVi" role="tabpanel" tabindex="0"><p>In this step we will enable GitHub Actions.
Select “Actions” from your GitHub repository page. You get to a page
“Get started with GitHub Actions”. Select the button for “Set up
this workflow” under Python Application:</p>
<figure class="align-default" id="id2">
<img alt="Selecting a Python workflow" src="_images/python_application.png" />
<figcaption>
<p><span class="caption-text">Select “Python application” as the starter workflow.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>GitHub creates the following file for you in the subfolder <code class="docutils literal notranslate"><span class="pre">.github/workflows</span></code>.
Add <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">example.py</span></code> to the last line (highlighted):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># This workflow will install Python dependencies, run tests and lint with a single version of Python</span>
<span class="c1"># For more information see: https://help.github.com/actions/language-and-framework-guides/using-python-with-github-actions</span>

<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Python application</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">main</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">main</span><span class="w"> </span><span class="p p-Indicator">]</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span>

<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v2</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python 3.8</span>
<span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v2</span>
<span class="w">      </span><span class="nt">with</span><span class="p">:</span>
<span class="w">        </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.8</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">python -m pip install --upgrade pip</span>
<span class="w">        </span><span class="no">pip install flake8 pytest</span>
<span class="w">        </span><span class="no">if [ -f requirements.txt ]; then pip install -r requirements.txt; fi</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Lint with flake8</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no"># stop the build if there are Python syntax errors or undefined names</span>
<span class="w">        </span><span class="no">flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics</span>
<span class="w">        </span><span class="no"># exit-zero treats all errors as warnings. The GitHub editor is 127 chars wide</span>
<span class="w">        </span><span class="no">flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics</span>
<span class="hll"><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test with pytest</span>
</span><span class="hll"><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span class="hll"><span class="w">        </span><span class="no">pytest example.py</span>
</span></pre></div>
</div>
<p>Commit the change by pressing the “Start Commit” button:</p>
<figure class="align-default" id="id3">
<a class="reference internal image-reference" href="_images/gh_action_commit.png"><img alt="Committing the change" src="_images/gh_action_commit.png" style="width: 400px;" />
</a>
<figcaption>
<p><span class="caption-text">Committing the file via the GitHub web interface: follow the flow, give it some commit name. You can commit directly to master.</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
</div><div aria-labelledby="tab-0-R2l0TGFi" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-R2l0TGFi" name="R2l0TGFi" role="tabpanel" tabindex="0"><p>In this step we will enable GitLab CI.
Select “CI/CD” from your Gitlab sidebar of the project. You get to a page
“Editor”. (Instead you can also click on “Add CI/CD” on the main page or just add a <code class="docutils literal notranslate"><span class="pre">.gitlab-ci.yml</span></code> file the result is identical.</p>
<p>Copy the following code snippet into the file. Gitlab will save it as <code class="docutils literal notranslate"><span class="pre">.gitlab-ci.yml</span></code>.
Add <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">example.py</span></code> to the last line (highlighted):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># This workflow will install Python dependencies, run tests and lint with a single version of Python</span>
<span class="c1"># For more information see: https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Python.gitlab-ci.yml</span>

<span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python:latest</span>
<span class="nt">stages</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linting</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="nt">before_script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /proc/version</span><span class="w"> </span><span class="c1">#print out operations system</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python -V</span><span class="w">  </span><span class="c1"># Print out python version for debugging</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install pytest flake8</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">if [ -f requirements.txt ]; then pip install -r requirements.txt;fi</span>

<span class="nt">linting</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linting</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics</span>

<span class="nt">test</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="hll"><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pytest example.py</span>
</pre></div>
</div>
<p>Commit the change by pressing the “Commit changes” button:</p>
<figure class="align-default" id="id4">
<a class="reference internal image-reference" href="_images/gl_action_commit.png"><img alt="Committing the change" src="_images/gl_action_commit.png" style="width: 400px;" />
</a>
<figcaption>
<p><span class="caption-text">Committing the file via the GitLab web interface: follow the flow, give it some commit name. You can commit directly to master.</span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
</div></div>
</section>
<section id="step-4-verify-that-tests-have-been-automatically-run">
<h4>Step 4: Verify that tests have been automatically run<a class="headerlink" href="#step-4-verify-that-tests-have-been-automatically-run" title="Link to this heading"></a></h4>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-R2l0SHVi" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-R2l0SHVi" name="R2l0SHVi" role="tab" tabindex="0">GitHub</button><button aria-controls="panel-1-R2l0TGFi" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-R2l0TGFi" name="R2l0TGFi" role="tab" tabindex="-1">GitLab</button></div><div aria-labelledby="tab-1-R2l0SHVi" class="sphinx-tabs-panel group-tab" id="panel-1-R2l0SHVi" name="R2l0SHVi" role="tabpanel" tabindex="0"><p>Observe in the repository how the test succeeds. While the test is
executing, the repository has a yellow marker. This is replaced with a green
check mark, once the test succeeds:</p>
<figure class="align-default" id="id5">
<img alt="Verify that the test passed" src="_images/green_check_mark.png" />
<figcaption>
<p><span class="caption-text">Green check means passed.</span><a class="headerlink" href="#id5" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Also browse the “Actions” tab and look at the steps there and their output.</p>
</div><div aria-labelledby="tab-1-R2l0TGFi" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-R2l0TGFi" name="R2l0TGFi" role="tabpanel" tabindex="0"><p>Observe in the repository how the test succeeds. While the test is
executing, the repository has a blue marker. This is replaced with a green
check mark, once the test succeeds:</p>
<figure class="align-default" id="id6">
<img alt="Verify that the test passed" src="_images/gl_green_check_mark.png" />
<figcaption>
<p><span class="caption-text">Green check means passed.</span><a class="headerlink" href="#id6" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Also browse the “Pipelines” tab and look at the steps there and their output.</p>
</div></div>
</section>
<section id="step-5-add-a-test-which-reveals-a-problem">
<h4>Step 5: Add a test which reveals a problem<a class="headerlink" href="#step-5-add-a-test-which-reveals-a-problem" title="Link to this heading"></a></h4>
<p>After you committed the workflow file, your GitHub/GitLab repository will be ahead of
your local cloned repository.  Update your local cloned repository:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git<span class="w"> </span>pull<span class="w"> </span>origin<span class="w"> </span>main
</pre></div>
</div>
<p>Hint for helpers: if the above command fails, check whether the branch name on the GitHub/GitLab
repository is called <code class="docutils literal notranslate"><span class="pre">main</span></code> and not perhaps <code class="docutils literal notranslate"><span class="pre">master</span></code>.</p>
<p>Next uncomment the code in <code class="docutils literal notranslate"><span class="pre">example.py</span></code> under “step 5”, commit, and push.
Verify that the test suite now fails on the “Actions” tab (GitHub)
or the “CI/CD-&gt;Pipelines” tab (GitLab).</p>
</section>
<section id="step-6-open-an-issue-on-github-gitlab">
<h4>Step 6: Open an issue on GitHub/GitLab<a class="headerlink" href="#step-6-open-an-issue-on-github-gitlab" title="Link to this heading"></a></h4>
<p>Open a new issue in your repository about the broken test (click the “Issues” button on
GitHub or GitLab and write a title for the issue).
The plan is that your colleague will fix the issue through a pull/merge request.</p>
</section>
<section id="step-7-fork-and-clone-the-repository-of-your-colleague">
<h4>Step 7: Fork and clone the repository of your colleague<a class="headerlink" href="#step-7-fork-and-clone-the-repository-of-your-colleague" title="Link to this heading"></a></h4>
<p>Fork the repository using the GitHub/GitLab web interface.
(if you are unfamiliar with forking and pull requests, have a look at
<a class="reference external" href="https://coderefinery.github.io/git-collaborative/03-distributed/#forking-layout">this visual representation</a>).</p>
<p><strong>Make sure you clone the fork after you have forked it. Do not clone
your colleague’s repository directly.</strong></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-R2l0SHVi" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-2-R2l0SHVi" name="R2l0SHVi" role="tab" tabindex="0">GitHub</button><button aria-controls="panel-2-R2l0TGFi" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-R2l0TGFi" name="R2l0TGFi" role="tab" tabindex="-1">GitLab</button></div><div aria-labelledby="tab-2-R2l0SHVi" class="sphinx-tabs-panel group-tab" id="panel-2-R2l0SHVi" name="R2l0SHVi" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/your-username/the-repository.git
</pre></div>
</div>
</div><div aria-labelledby="tab-2-R2l0TGFi" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-R2l0TGFi" name="R2l0TGFi" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git<span class="w"> </span>clone<span class="w"> </span>https://gitlab.com/your-username/the-repository.git
</pre></div>
</div>
</div></div>
</section>
<section id="step-8-fix-the-broken-test">
<h4>Step 8: Fix the broken test<a class="headerlink" href="#step-8-fix-the-broken-test" title="Link to this heading"></a></h4>
<p>After you have fixed the code, commit the following commit message
<code class="docutils literal notranslate"><span class="pre">&quot;restore</span> <span class="pre">function</span> <span class="pre">subtract;</span> <span class="pre">fixes</span> <span class="pre">#1&quot;</span></code> (assuming that you try to fix
issue number 1).</p>
<p>Then push to your fork.</p>
</section>
<section id="step-9-open-a-pull-request-github-merge-request-gitlab">
<h4>Step 9: Open a pull request (GitHub)/ merge request (GitLab)<a class="headerlink" href="#step-9-open-a-pull-request-github-merge-request-gitlab" title="Link to this heading"></a></h4>
<p>Then before accepting the pull request/ merge request from your colleague, observe
how GitHub Actions/ Gitlab CI automatically tested the code.</p>
<p>If you forgot to reference the issue number in the commit message, you can still add it to
the pull request/ merge request: <code class="docutils literal notranslate"><span class="pre">my</span> <span class="pre">pull/merge</span> <span class="pre">request</span> <span class="pre">title,</span> <span class="pre">closes</span> <span class="pre">#NUMBEROFTHEISSUE</span></code></p>
</section>
<section id="step-10-accept-the-pull-request-merge-request">
<h4>Step 10: Accept the pull request/ merge request<a class="headerlink" href="#step-10-accept-the-pull-request-merge-request" title="Link to this heading"></a></h4>
<p>Observe how accepting the pull request/ merge request automatically closes the issue (provided
the commit message or the pull request/ merge request contained the correct issue number).</p>
<p>See also:</p>
<ul class="simple">
<li><p>GitHub: <a class="reference external" href="https://help.github.com/articles/closing-issues-using-keywords/">closing issues using keywords</a></p></li>
<li><p>GitLab: <a class="reference external" href="https://docs.gitlab.com/ee/user/project/issues/managing_issues.html#closing-issues">closing issues using keywords</a></p></li>
</ul>
<p>Discuss whether this is a useful feature. And if it is, why do you think is it useful?</p>
</section>
<section id="discussion">
<h4>Discussion<a class="headerlink" href="#discussion" title="Link to this heading"></a></h4>
<p>Finally, we discuss together about our experiences with this exercise.</p>
<div class="admonition-optional-fullci-2-add-a-license-file-to-the-previous-exercise-s-repository exercise important admonition" id="exercise-1">
<p class="admonition-title">(optional) FullCI-2: Add a license file to the previous exercise’s repository</p>
<p>In the <a class="reference external" href="https://cicero.xyz/v3/remark/0.14.0/github.com/coderefinery/social-coding/master/talk.md/">Social coding and open software</a>
lesson we learn how important it is to add a LICENSE file.</p>
<p>Your goal:</p>
<ul class="simple">
<li><p>You discover that your coworker’s repository does not have a LICENSE file.</p></li>
<li><p>Open an issue and suggest a LICENSE.</p></li>
<li><p>Then add a LICENSE via a pull/merge request, referencing the issue number.</p></li>
</ul>
</div>
</section>
</section>
<hr class="docutils" />
<section id="where-to-go-from-here">
<h3>Where to go from here<a class="headerlink" href="#where-to-go-from-here" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>This example was using Python but you can achieve the same automation for R or Fortran or C/C++ or other languages</p></li>
<li><p>GitHub Actions has a <a class="reference external" href="https://github.com/marketplace?type=actions">Marketpace</a> which offer wide range of automatic workflows</p></li>
<li><p>On GitLab use <a class="reference external" href="https://about.gitlab.com/product/continuous-integration/">GitLab CI</a></p></li>
<li><p>For Windows builds you can also use <a class="reference external" href="https://www.appveyor.com">Appveyor</a></p></li>
</ul>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>When fixing bugs or other problems reported in issues, use the issue
autoclosing mechanism when you send the pull/merge request.</p></li>
</ul>
</div>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-exercises"></span><section id="list-of-exercises">
<h2>List of exercises<a class="headerlink" href="#list-of-exercises" title="Link to this heading"></a></h2>
<section id="full-list">
<h3>Full list<a class="headerlink" href="#full-list" title="Link to this heading"></a></h3>
<p>This is a list of all exercises and solutions in this lesson, mainly
as a reference for helpers and instructors.  This list is
automatically generated from all of the other pages in the lesson.
Any single teaching event will probably cover only a subset of these,
depending on their interests.</p>
</section>
</section>
<span id="document-quick-reference"></span><section id="quick-reference">
<h2>Quick Reference<a class="headerlink" href="#quick-reference" title="Link to this heading"></a></h2>
<section id="available-tools">
<h3>Available tools<a class="headerlink" href="#available-tools" title="Link to this heading"></a></h3>
<section id="unit-test-frameworks">
<h4>Unit test frameworks<a class="headerlink" href="#unit-test-frameworks" title="Link to this heading"></a></h4>
<p>A <strong>test framework</strong> makes it easy to run tests across large amounts
of code automatically.  They provide more control than one single
script which does some tests.</p>
<ul class="simple">
<li><p>Python</p>
<ul>
<li><p><a class="reference internal" href="#pytest-ref"><span class="std std-ref">pytest</span></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/doctest.html">doctest</a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/unittest.html">unittest</a></p></li>
</ul>
</li>
<li><p>R</p>
<ul>
<li><p><a class="reference internal" href="#testthat"><span class="std std-ref">testthat</span></a></p></li>
</ul>
</li>
<li><p>Julia</p>
<ul>
<li><p><a class="reference internal" href="#test"><span class="std std-ref">Test</span></a></p></li>
</ul>
</li>
<li><p>Matlab</p>
<ul>
<li><p><a class="reference external" href="https://www.mathworks.com/help/matlab/class-based-unit-tests.html">Class-Based Unit Tests</a></p></li>
</ul>
</li>
<li><p>C(++)</p>
<ul>
<li><p><a class="reference internal" href="#google-test"><span class="std std-ref">Google Test</span></a></p></li>
<li><p><a class="reference internal" href="#catch2"><span class="std std-ref">Catch2</span></a></p></li>
<li><p><a class="reference external" href="https://freedesktop.org/wiki/Software/cppunit/">cppunit</a></p></li>
<li><p><a class="reference internal" href="#boost-test"><span class="std std-ref">Boost.Test</span></a></p></li>
</ul>
</li>
<li><p>Fortran</p>
<ul>
<li><p><a class="reference internal" href="#pfunit"><span class="std std-ref">pFUnit</span></a></p></li>
<li><p><a class="reference external" href="https://sourceforge.net/projects/fortranxunit/">FRUIT</a></p></li>
<li><p><a class="reference external" href="http://flibs.sourceforge.net/ftnunit.html">Ftunit</a></p></li>
</ul>
</li>
</ul>
<hr class="docutils" />
</section>
<section id="pytest">
<span id="pytest-ref"></span><h4>pytest<a class="headerlink" href="#pytest" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Python</p></li>
<li><p><a class="reference external" href="https://docs.pytest.org/">https://docs.pytest.org/</a></p></li>
<li><p>Installable via Conda or pip.</p></li>
<li><p>Easy to use: Prefix a function with <code class="docutils literal notranslate"><span class="pre">test_</span></code> and the test runner will execute it.
No need to subclass anything.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_word_lengths</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of integers representing</span>
<span class="sd">    the word lengths in string s.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_get_word_lengths</span><span class="p">():</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Three tomatoes are walking down the street&quot;</span>
    <span class="k">assert</span> <span class="n">get_word_lengths</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/bast/pytest-demo">Example project</a></p></li>
</ul>
<hr class="docutils" />
</section>
<section id="testthat">
<span id="id1"></span><h4>testthat<a class="headerlink" href="#testthat" title="Link to this heading"></a></h4>
<ul>
<li><p>R</p></li>
<li><p><a class="reference external" href="https://github.com/r-lib/testthat">https://github.com/r-lib/testthat</a></p></li>
<li><p>Easily installed from CRAN with <code class="docutils literal notranslate"><span class="pre">install.packages(&quot;testthat&quot;)</span></code>, or from GitHub with <code class="docutils literal notranslate"><span class="pre">devtools::install_github(&quot;r-lib/testthat&quot;)</span></code></p></li>
<li><p>Use in package development with <code class="docutils literal notranslate"><span class="pre">usethis::use_testthat()</span></code></p></li>
<li><p>Add a new test file with <code class="docutils literal notranslate"><span class="pre">usethis::use_test(&quot;test-name&quot;)</span></code>, e.g.:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># tests/testthat/test_example.R</span>
<span class="c1"># file added by running `usethis::use_test(&quot;example&quot;)`</span>

<span class="nf">context</span><span class="p">(</span><span class="s">&quot;Arithmetics&quot;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&quot;mypackage&quot;</span><span class="p">)</span>

<span class="nf">test_that</span><span class="p">(</span><span class="s">&quot;square root function works&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nf">expect_equal</span><span class="p">(</span><span class="nf">my_sqrt</span><span class="p">(</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="w">  </span><span class="nf">expect_warning</span><span class="p">(</span><span class="nf">my_sqrt</span><span class="p">(</span><span class="m">-4</span><span class="p">))</span>
<span class="p">})</span>
</pre></div>
</div>
<p>Tests consist of one or more <em>expectations</em>, and multiple tests can be grouped together in one test file.
Test files are put in the directory <code class="docutils literal notranslate"><span class="pre">tests/testthat/</span></code>, and their file names are prefixed with <code class="docutils literal notranslate"><span class="pre">test_</span></code>.</p>
</li>
<li><p>Run all tests in package with <code class="docutils literal notranslate"><span class="pre">devtools::test()</span></code> (if you use RStudio, press <kbd>Ctrl+Shift+T</kbd>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt; devtools::test()
Loading mypackage
Testing mypackage
✔ |  OK F W S | Context
✔ |   2       | Arithmetics

══ Results ═════════════════════════════════════════════════════════════════════
OK:       2
Failed:   0
Warnings: 0
Skipped:  0
</pre></div>
</div>
</li>
</ul>
<p>More information in the <a class="reference external" href="http://r-pkgs.had.co.nz/tests.html">Testing chapter</a> of the book <a class="reference external" href="http://r-pkgs.had.co.nz">R Packages</a> by Hadley Wickham.</p>
<hr class="docutils" />
</section>
<section id="test">
<span id="id2"></span><h4>Test<a class="headerlink" href="#test" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Julia</p></li>
<li><ul>
<li><p><a class="reference external" href="https://docs.julialang.org/en/v1/stdlib/Test/">Documentation</a></p></li>
</ul>
</li>
<li><p>Part of the standard library</p></li>
<li><p>Provides simple unit testing functionality with
<code class="docutils literal notranslate"><span class="pre">&#64;test</span></code> and <code class="docutils literal notranslate"><span class="pre">&#64;test_throws</span></code> macros:</p></li>
</ul>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">julia</span><span class="o">&gt;</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">Test</span>

<span class="n">julia</span><span class="o">&gt;</span><span class="w"> </span><span class="nd">@test</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span>
<span class="n">Test</span><span class="w"> </span><span class="n">Passed</span>

<span class="c"># approximate comparisons:</span>
<span class="n">julia</span><span class="o">&gt;</span><span class="w"> </span><span class="nd">@test</span><span class="w"> </span><span class="nb">π</span><span class="w"> </span><span class="o">≈</span><span class="w"> </span><span class="mf">3.14</span><span class="w"> </span><span class="n">atol</span><span class="o">=</span><span class="mf">0.01</span>
<span class="n">Test</span><span class="w"> </span><span class="n">Passed</span>

<span class="c"># Tests that an expression throws exception:</span>
<span class="n">julia</span><span class="o">&gt;</span><span class="w"> </span><span class="nd">@test_throws</span><span class="w"> </span><span class="kt">BoundsError</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="n">Test</span><span class="w"> </span><span class="n">Passed</span>
<span class="w">      </span><span class="n">Thrown</span><span class="o">:</span><span class="w"> </span><span class="kt">BoundsError</span>

<span class="n">julia</span><span class="o">&gt;</span><span class="w"> </span><span class="nd">@test_throws</span><span class="w"> </span><span class="kt">DimensionMismatch</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span>
<span class="n">Test</span><span class="w"> </span><span class="n">Passed</span>
<span class="w">      </span><span class="n">Thrown</span><span class="o">:</span><span class="w"> </span><span class="kt">DimensionMismatch</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Grouping related tests with the <code class="docutils literal notranslate"><span class="pre">&#64;testset</span></code> macro:</p></li>
</ul>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Test</span>

<span class="k">function</span><span class="w"> </span><span class="n">get_word_lengths</span><span class="p">(</span><span class="n">s</span><span class="o">::</span><span class="kt">String</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="n">length</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">split</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>
<span class="k">end</span>

<span class="nd">@testset</span><span class="w"> </span><span class="s">&quot;Testing get_word_length()&quot;</span><span class="w"> </span><span class="k">begin</span>
<span class="w">    </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Three tomatoes are walking down the street&quot;</span>
<span class="w">    </span><span class="nd">@test</span><span class="w"> </span><span class="n">get_word_lengths</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">]</span>
<span class="w">    </span><span class="n">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">123</span>
<span class="w">    </span><span class="nd">@test_throws</span><span class="w"> </span><span class="kt">MethodError</span><span class="w"> </span><span class="n">get_word_lengths</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<hr class="docutils" />
</section>
<section id="catch2">
<span id="id3"></span><h4>Catch2<a class="headerlink" href="#catch2" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>C++</p></li>
<li><p><a class="reference external" href="https://github.com/catchorg/Catch2">Project page with installation instructions</a></p></li>
<li><p>Widely used</p></li>
<li><p>Header-only</p></li>
<li><p>Very rich in functionality</p></li>
<li><p>Well-integrated with CMake</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;catch2/catch.hpp&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;example.h&quot;</span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Catch</span><span class="o">::</span><span class="nn">literals</span><span class="p">;</span>

<span class="n">TEST_CASE</span><span class="p">(</span><span class="s">&quot;Use the example library to add numbers&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[add]&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add_numbers</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">);</span>
<span class="w">  </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">3.0</span><span class="n">_a</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<hr class="docutils" />
</section>
<section id="google-test">
<span id="id4"></span><h4>Google Test<a class="headerlink" href="#google-test" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>C++</p></li>
<li><p><a class="reference external" href="https://google.github.io/googletest/">Documentation</a></p></li>
<li><p>Widely used</p></li>
<li><p>Very rich in functionality</p></li>
<li><p>Well-integrated with CMake</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gtest/gtest.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;example.h&quot;</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">example</span><span class="p">,</span><span class="w"> </span><span class="n">add</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">  </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add_numbers</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">);</span>
<span class="w">  </span><span class="n">ASSERT_NEAR</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0e-11</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/bast/gtest-demo">Example project</a></p></li>
</ul>
<hr class="docutils" />
</section>
<section id="boost-test">
<span id="id5"></span><h4>Boost.Test<a class="headerlink" href="#boost-test" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>C++</p></li>
<li><p><a class="reference external" href="https://www.boost.org/doc/libs/1_86_0/libs/test/doc/html/index.html">Documentation</a></p></li>
<li><p>Very rich in functionality</p></li>
<li><p>Header-only use possible</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;boost/test/unit_test.hpp&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;example.h&quot;</span>

<span class="n">BOOST_AUTO_TEST_CASE</span><span class="p">(</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add_numbers</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="p">);</span>
<span class="w">  </span><span class="n">BOOST_TEST</span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">3.0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<hr class="docutils" />
</section>
<section id="pfunit">
<span id="id6"></span><h4>pFUnit<a class="headerlink" href="#pfunit" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Fortran</p></li>
<li><p><a class="reference external" href="https://github.com/Goddard-Fortran-Ecosystem/pFUnit">Documentation and installation</a></p></li>
<li><p>Very rich in functionality</p></li>
<li><p>Requires modern Fortran compilers (uses F2003 standard)</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@test</span>
<span class="n">subroutine</span> <span class="n">test_add_numbers</span><span class="p">()</span>

   <span class="n">use</span> <span class="n">hello</span>
   <span class="n">use</span> <span class="n">pfunit_mod</span>

   <span class="n">implicit</span> <span class="n">none</span>

   <span class="n">real</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="p">::</span> <span class="n">res</span>

   <span class="n">call</span> <span class="n">add_numbers</span><span class="p">(</span><span class="mf">1.0</span><span class="n">d0</span><span class="p">,</span> <span class="mf">2.0</span><span class="n">d0</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
   <span class="nd">@assertEqual</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mf">3.0</span><span class="n">d0</span><span class="p">)</span>

<span class="n">end</span> <span class="n">subroutine</span>
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference internal" href="#document-code/fortran/build_pFUnit"><span class="doc std std-doc">Example installation instructions</span></a></p></li>
</ul>
<p>To test the <code class="docutils literal notranslate"><span class="pre">factorial</span></code> and <code class="docutils literal notranslate"><span class="pre">fizzbuzz</span></code> functions from the <a class="reference internal" href="#document-test-design"><span class="doc std std-doc">test-design
exercises</span></a>, use this <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.12</span><span class="p">)</span>

<span class="nb">project</span><span class="w"> </span><span class="p">(</span><span class="s">PFUNIT_DEMO_CR</span>
<span class="w">  </span><span class="s">VERSION</span><span class="w"> </span><span class="s">1.0.0</span>
<span class="w">  </span><span class="s">LANGUAGES</span><span class="w"> </span><span class="s">Fortran</span><span class="p">)</span>

<span class="nb">find_package</span><span class="p">(</span><span class="s">PFUNIT</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">enable_testing</span><span class="p">()</span>

<span class="c"># system under test</span>
<span class="nb">add_library</span><span class="w"> </span><span class="p">(</span><span class="s">sut</span>
<span class="w">  </span><span class="s">factorial.f90</span>
<span class="w">  </span><span class="s">fizzbuzz.f90</span>
<span class="w">  </span><span class="p">)</span>

<span class="nb">target_include_directories</span><span class="p">(</span><span class="s">sut</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="o">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="o">}</span><span class="p">)</span>

<span class="c"># tests</span>
<span class="nb">set</span><span class="w"> </span><span class="p">(</span><span class="s">test_srcs</span><span class="w"> </span><span class="s">test_factorial.pf</span><span class="w"> </span><span class="s">test_fizzbuzz.pf</span><span class="p">)</span>
<span class="nb">add_pfunit_ctest</span><span class="w"> </span><span class="p">(</span><span class="s">my_tests</span>
<span class="w">  </span><span class="s">TEST_SOURCES</span><span class="w"> </span><span class="o">${</span><span class="nv">test_srcs</span><span class="o">}</span>
<span class="w">  </span><span class="s">LINK_LIBRARIES</span><span class="w"> </span><span class="s">sut</span>
<span class="w">  </span><span class="p">)</span>
</pre></div>
</div>
<p>You can then compile using this script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -f</span>

<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-d<span class="w"> </span>build<span class="w"> </span><span class="o">]]</span>
<span class="k">then</span>
<span class="w">    </span>rm<span class="w"> </span>-rf<span class="w"> </span>build
<span class="k">fi</span>

mkdir<span class="w"> </span>-p<span class="w"> </span>build
<span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>..<span class="w"> </span>-DCMAKE_PREFIX_PATH<span class="o">=</span><span class="nv">$PFUNIT_DIR</span>
make
./my_tests

<span class="c1"># or</span>
<span class="c1"># ctest --verbose</span>
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/bast/pfunit-demo">Example project</a></p></li>
</ul>
</section>
<hr class="docutils" />
<section id="services-to-deploy-testing-and-coverage">
<h4>Services to deploy testing and coverage<a class="headerlink" href="#services-to-deploy-testing-and-coverage" title="Link to this heading"></a></h4>
<p>Each of these are web services to handle testing, free for open source
projects.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/features/actions">GitHub Actions</a> (we will
demonstrate this in the next episode)</p></li>
<li><p><a class="reference external" href="https://about.gitlab.com/features/gitlab-ci-cd/">GitLab CI</a>
(we will demonstrate this in the next episode)</p></li>
<li><p><a class="reference external" href="https://azure.microsoft.com/en-us/services/devops/pipelines/">Azure Pipelines</a></p></li>
<li><p><a class="reference external" href="https://coveralls.io">Coveralls</a></p></li>
<li><p><a class="reference external" href="https://codecov.io">Codecov</a></p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="good-resources">
<h3>Good resources<a class="headerlink" href="#good-resources" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://realpython.com/python-testing/">Getting Started With Testing in Python</a></p></li>
</ul>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>Testing is a basic requirement of any possible language</p></li>
<li><p>There are various tools for any language you may use</p></li>
<li><p>There are free web services for open source</p></li>
</ul>
</div>
</section>
</section>
<span id="document-guide"></span><section id="instructor-guide">
<h2>Instructor guide<a class="headerlink" href="#instructor-guide" title="Link to this heading"></a></h2>
<section id="detailed-schedule">
<h3>Detailed schedule<a class="headerlink" href="#detailed-schedule" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>9:00-9:15 <a class="reference external" href="https://coderefinery.github.io/testing/motivation/">Motivation</a></p></li>
<li><p>9:15-9:40 <a class="reference external" href="https://coderefinery.github.io/testing/locally/">Testing locally</a></p>
<ul>
<li><p>explain the exercise: 5 min</p></li>
<li><p><strong>20 min exercise</strong></p></li>
</ul>
</li>
<li><p>9:40-10:00 <a class="reference external" href="https://coderefinery.github.io/testing/continuous-integration/">Automated testing</a></p>
<ul>
<li><p>demo</p></li>
</ul>
</li>
<li><p>10:00-10:10 Break</p></li>
<li><p>10:10-10:50 <a class="reference external" href="https://coderefinery.github.io/testing/test-design/">Test design</a></p>
<ul>
<li><p>explain the exercise: 10 min</p></li>
<li><p><strong>20 min exercise</strong></p></li>
<li><p>discussion and type-along of advanced exercises: 10 minutes</p></li>
</ul>
</li>
<li><p>10:50-11:00 Discussion and summary</p></li>
</ul>
</section>
<section id="why-we-teach-this-lesson">
<h3>Why we teach this lesson<a class="headerlink" href="#why-we-teach-this-lesson" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Because writing tests and using automated testing is often part
of the development process, especially for codes that are larger than
a simple script.</p></li>
<li><p>We wish to give learners the tools so that they can rewrite codes and
collaborate on a code projects with more confidence.</p></li>
<li><p>Testing can help detecting regressions during development instead of later
(when using the code) or too late (after having published results).</p></li>
<li><p>Can simplify collaboration since contributors can be more confident that
their changes preserve expected functionality.</p></li>
<li><p>Tests document the intent of the function/module/library/code.</p></li>
<li><p>Tests can guide the code towards more modular and reusable code style with
fewer side effects.</p></li>
</ul>
</section>
<section id="intended-learning-outcomes">
<h3>Intended learning outcomes<a class="headerlink" href="#intended-learning-outcomes" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Know that in each language tools exist that can execute a series of test functions
and report success or failure.</p></li>
<li><p>Know that services like GitHub Actions, Azure pipelines, GitLab CI, Appveyor, and others
allow us to automatically run tests on every Git push or every pull request or merge request.</p></li>
<li><p>Be able to approach a function or module or library and design a test for it “in words”
or pseudo-code.</p></li>
<li><p>Know what test coverage means and how it can help to detect untested/unused code.</p></li>
<li><p>Know where in a larger and untested project to start introducing tests since it is beyond
reach and also probably not reasonable to test everything.</p></li>
</ul>
</section>
<section id="how-we-teach-this-lesson">
<h3>How we teach this lesson<a class="headerlink" href="#how-we-teach-this-lesson" title="Link to this heading"></a></h3>
<section id="how-to-start">
<h4>How to start<a class="headerlink" href="#how-to-start" title="Link to this heading"></a></h4>
<p>The quote from another testing lesson by Kathryn Huff can be discussed
to get participants to reflect on the role of software testing in
science and its parallels to calibrating measurement devices. The second half
of the quote is left out because it goes so far as to say that untested software
does not constitute science, and this can be offending to learners.</p>
</section>
<section id="questions-to-involve-participants">
<h4>Questions to involve participants<a class="headerlink" href="#questions-to-involve-participants" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Do you agree that testing software is similar to calibrating detectors?</p></li>
<li><p>Do you test your code?</p></li>
<li><p>How and when do you test?</p></li>
<li><p>Where would you start adding a test in an existing project?</p></li>
<li><p>In which situations would you recommend not to add any tests?</p></li>
</ul>
</section>
<section id="structure-of-the-lesson">
<h4>Structure of the lesson<a class="headerlink" href="#structure-of-the-lesson" title="Link to this heading"></a></h4>
<section id="motivation-and-concepts">
<h5>Motivation and concepts<a class="headerlink" href="#motivation-and-concepts" title="Link to this heading"></a></h5>
<p>The former “motivation” and “concepts” episodes have been combined
into one.  Previously, the lesson was described as quite dogmagtic and
without enough time for exercises.  When teaching, try to give some of
the benefits, but without being too long about it.  The quick
reference has more details on language-specific things.</p>
</section>
<section id="testing-locally">
<h5>Testing locally<a class="headerlink" href="#testing-locally" title="Link to this heading"></a></h5>
<p>After introducing the concepts the lesson becomes hands-on in the
Testing Locally episode. The pytest example there can be done as
type-along and the optional exercise “Testing with numerical
tolerance” can be left as homework.  The end-to-end test may be hard
for many people who can’t script other programs, but it provides
something that can keep advanced people interested for longer.</p>
</section>
<section id="automated-testing-or-full-cycle-collaborative-workflow">
<h5>Automated testing (or full-cycle collaborative workflow)<a class="headerlink" href="#automated-testing-or-full-cycle-collaborative-workflow" title="Link to this heading"></a></h5>
<p>After learning how to run tests locally, the lesson goes into
automated testing using GitHub Actions or GitLab CI in the Automated
Testing episode. This episode is a simplified version of the
collaborative exercise in the optional episode “Full-cycle
collaborative workflow”, and the instructor has a choice which one to
teach (with the latter requiring around double the time). The
exercise in Automated Testing can either be done as a type-along
demonstration by the instructor or as an exercise in breakout rooms.</p>
<p><strong>If run as an exercise, this episode requires that learners know how
to set up Git repositories locally and online and how to work with
pull/merge requests!</strong></p>
<p>If the optional Full-cycle episode is covered, it is useful during the
wrap up of the exercise to have a co-instructor doing the exercise in
parallel with you. As your partner makes a pull requests with “fixes
#1” (or whatever PR number) you can show that the PR links to a issue,
and the issue pointing to a commit.</p>
</section>
<section id="test-design">
<h5>Test design<a class="headerlink" href="#test-design" title="Link to this heading"></a></h5>
<p>This episode now has exercises in different languages covering
different testing approaches (unit tests, integration tests, testing
randomness, TDD). In normal workshops there are far too many
exercises for the available time so the instructor has freedom to
recommend specific exercises, to let learners choose themselves, or to
recommend learners to discuss rather than implement the tests.</p>
</section>
<section id="order-of-continuous-integration-and-test-design">
<h5>Order of Continuous Integration and Test Design<a class="headerlink" href="#order-of-continuous-integration-and-test-design" title="Link to this heading"></a></h5>
<p>When this lesson is taught standalone in a software testing workshop
or hackathon, it might be better to go through the Test Design episode
before the Continuous Integration episode.</p>
</section>
</section>
<section id="timing">
<h4>Timing<a class="headerlink" href="#timing" title="Link to this heading"></a></h4>
<p>The lesson is stipulated to take around 2 hours, but if more time is
available you can replace the Automated Testing episode with “Full-cycle
collaborative workflow”, or give more time to the Test Design episode.</p>
<p>Splitting the lesson in two halves with a lunch break in the middle
works well. Before lunch you have on hour introduction and the two
first exercises. After lunch you continue with the automated testing
exercise and test design.</p>
</section>
<section id="room-for-improvement">
<h4>Room for improvement<a class="headerlink" href="#room-for-improvement" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>The lesson is still too Python centric in the “Testing locally” and “Automated testing” episodes.
It would be nice to offer alternatives for learners who write in different languages.</p></li>
<li><p>Currently the lesson is in the “discipline” domain. Testing is
something you do to control behavior (your own as well as the code).
Testing is also something you can do to improve productivity, but this
is less visible/detectable.</p></li>
</ul>
</section>
</section>
<section id="field-reports">
<h3>Field reports<a class="headerlink" href="#field-reports" title="Link to this heading"></a></h3>
<section id="march-first-time-with-no-exercises">
<h4>2024 March (first time with no exercises)<a class="headerlink" href="#march-first-time-with-no-exercises" title="Link to this heading"></a></h4>
<p>This was the first year we did the “all demo” mode with no exercises,
and it worked well enough.  Our rough plan can be seen <a class="reference external" href="https://hackmd.io/cMowYt5nQOqZj0n1wsIlyw">at this
hackmd</a> (not pasted here
because it’s kind of long).</p>
<p>We tried to be fast with motivation, and not go to details. In
“testing locally”, we basically did the exercise as a demo.  There
wasn’t much of note, it worked and there was plenty of
discussion. “Automated testing” worked fine also, except: a) we had to
choose how to push to Github, we used vscode, but not all learners did
that method.  Nothing to change here, but be aware you should explain
what and why you are doing for people who didn’t use your chosen
method of linking, and b) code coverage didn’t work from a PR from a
fork.  We had one person set up the automated tests, then swapped
instructors and showed the second making the fork and contributing.</p>
<p>The biggest thing to think about is how, when demoing testing
locally/automated testing, people ask “how to tests work?”, which then
comes later.  I don’t know if I would change the order,
though… because showing how to design tests without knowing how to
use them would make the same kind of questions, but reversed.  I think
it’s just a “decide how it is and prepare for the questions” - maybe
in “motivation” or some other summary episode at the start.</p>
<p>“Test design” didn’t have any major problems, but many of the tests
were relatively simple to discuss: the earlier tests would be trivial
to understand if someone shows you the code (should we demonstrate
typing two lines that’s the same as in motivation? - but interesting
to do as an exercise).  Some of the later ones were interesting to
build up and demonstrate.  It would be good to think which exercises
one wants to demo, and which one wants to only talk about.  And think
which comes out of each demo/telling.</p>
<p>Overall, no major issues in doing this demo-based with good
familiarity but limited preparation time.</p>
</section>
<section id="september">
<h4>2023 September<a class="headerlink" href="#september" title="Link to this heading"></a></h4>
<p>For this lesson, “Motivation” and “Concepts” were combined.  An extra
end-to-end test was added under “testing locally”.</p>
</section>
<section id="march">
<h4>2023 March<a class="headerlink" href="#march" title="Link to this heading"></a></h4>
<p>Due to a mix-up with instructors, we changed the plan at the last
minute and it didn’t go so well (we should have known).  The original
plan had pytest as a demo, with exercises for Github CI and test
design.  We did pytest as an exercise, Github CI as an exercise, and
had almost no time for test design.  One complaint was that there
wasn’t enough time for practical things, so I think a plan like last
time could have been good.  As usual, we should have found a way to
talk less and do more.</p>
<p>This was the schedule from March 2023:</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span class="k">*</span><span class="w"> </span>8:50 - 9:00 Getting started
<span class="k">*</span><span class="w"> </span>9:00 - 10:45 [<span class="nt">Software testing</span>](<span class="na">https://coderefinery.github.io/testing/</span>)
<span class="w">  </span><span class="k">-</span><span class="w"> </span>9:00-9:05 Short info about today&#39;s exercise sessions and possible questions from yesterday
<span class="w">  </span><span class="k">-</span><span class="w"> </span>9:05-9:10 [<span class="nt">Motivation</span>](<span class="na">https://coderefinery.github.io/testing/motivation/</span>)
<span class="w">  </span><span class="k">-</span><span class="w"> </span>9:10-9:20 [<span class="nt">Concepts</span>](<span class="na">https://coderefinery.github.io/testing/concepts/</span>)
<span class="w">  </span><span class="k">-</span><span class="w"> </span>9:20-9:45 [<span class="nt">Testing locally</span>](<span class="na">https://coderefinery.github.io/testing/pytest/</span>)
<span class="w">      </span><span class="k">-</span><span class="w"> </span>5 minutes talking
<span class="w">      </span><span class="k">-</span><span class="w"> </span>15 minute exercises
<span class="w">      </span><span class="k">-</span><span class="w"> </span>5 going over exercises and discussion
<span class="w">  </span><span class="k">-</span><span class="w"> </span>9:45-9:55 Break
<span class="w">  </span><span class="k">-</span><span class="w"> </span>9:55-10:20 [<span class="nt">Automated testing</span>](<span class="na">https://coderefinery.github.io/testing/continuous-integration/</span>)
<span class="w">      </span><span class="k">-</span><span class="w"> </span>type-along session
<span class="w">  </span><span class="k">-</span><span class="w"> </span>10:20-10:45 [<span class="nt">Test design</span>](<span class="na">https://coderefinery.github.io/testing/test-design/</span>)
<span class="w">      </span><span class="k">-</span><span class="w"> </span>discussion: 5 minutes
<span class="w">      </span><span class="k">-</span><span class="w"> </span>Exercises: 10 minutes.  Any of exercises Design-1 to Design-8 that learners want to do.
<span class="w">      </span><span class="k">-</span><span class="w"> </span>discussion and type-along of advanced exercises: 10 minutes
<span class="w">  </span><span class="k">-</span><span class="w"> </span>10:45-11:00 Break
</pre></div>
</div>
</section>
<section id="id1">
<h4>2022 September<a class="headerlink" href="#id1" title="Link to this heading"></a></h4>
<p>Overall, it went well with the schedule below.  We had to be
efficient, but it seemed like it wasn’t too hard.  The only complaint
was that there was a lot of time for the first exercise (pytest
locally), which I would agree with.  I think for next time, we should
add in parts of that exercise so that there are more advanced things
to do, since there are more nice features of pytest, such as <code class="docutils literal notranslate"><span class="pre">--pdb</span></code>,
running single tests, etc.  Other than that, there wasn’t really much
to report.</p>
<p>The way extra long breaks and a 5-minute starting point were included
is quite good for the schedule.  Not because we needed them, but it
allowed us to go over time and not be under so much time pressure.</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span class="gs">**Day 6**</span>
<span class="k">*</span><span class="w"> </span>8:50 - 9:00 Getting started
<span class="k">*</span><span class="w"> </span>9:00 - 10:45 Software testing
<span class="w">  </span><span class="k">-</span><span class="w"> </span>9:00-9:05 Short info about today&#39;s exercise sessions and possible questions from yesterday
<span class="w">  </span><span class="k">-</span><span class="w"> </span>9:05-9:10 [<span class="nt">Motivation</span>](<span class="na">https://coderefinery.github.io/testing/motivation/</span>)
<span class="w">  </span><span class="k">-</span><span class="w"> </span>9:10-9:20 [<span class="nt">Concepts</span>](<span class="na">https://coderefinery.github.io/testing/concepts/</span>)
<span class="w">  </span><span class="k">-</span><span class="w"> </span>9:20-9:45 [<span class="nt">Testing locally</span>](<span class="na">https://coderefinery.github.io/testing/pytest/</span>)
<span class="w">      </span><span class="k">-</span><span class="w"> </span>5 minutes talking
<span class="w">      </span><span class="k">-</span><span class="w"> </span>15 minute exercises
<span class="w">      </span><span class="k">-</span><span class="w"> </span>5 going over exercises and discussion
<span class="w">  </span><span class="k">-</span><span class="w"> </span>9:45-9:55 Break
<span class="w">  </span><span class="k">-</span><span class="w"> </span>9:55-10:20 [<span class="nt">Automated testing</span>](<span class="na">https://coderefinery.github.io/testing/continuous-integration/</span>)
<span class="w">      </span><span class="k">-</span><span class="w"> </span>type-along session
<span class="w">  </span><span class="k">-</span><span class="w"> </span>10:20-10:45 [<span class="nt">Test design</span>](<span class="na">https://coderefinery.github.io/testing/test-design/</span>)
<span class="w">      </span><span class="k">-</span><span class="w"> </span>discussion: 5 minutes
<span class="w">      </span><span class="k">-</span><span class="w"> </span>Exercises: 10 minutes.  Any of exercises Design-1 to Design-8 that learners want to do.
<span class="w">      </span><span class="k">-</span><span class="w"> </span>discussion and type-along of advanced exercises: 10 minutes
<span class="w">  </span><span class="k">-</span><span class="w"> </span>10:45-11:00 Break
</pre></div>
</div>
</section>
<section id="november-instructor-training-workshop">
<h4>2019 November instructor training workshop<a class="headerlink" href="#november-instructor-training-workshop" title="Link to this heading"></a></h4>
<p>Some notes about teaching are here:
<a class="reference external" href="https://github.com/coderefinery/testing/issues/42">https://github.com/coderefinery/testing/issues/42</a></p>
</section>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright CodeRefinery contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>